define("pat-mockup-parser",["jquery"],function(n){"use strict";return{getOptions:function e(t,a,o){o=o||{},0===t.length||n.nodeName(t[0],"body")||(o=e(t.parent(),a,o));var i,s={};return 0!==t.length&&(s=t.data("pat-"+a))&&"string"==typeof s&&(i={},n.each(s.split(";"),function(e,t){(t=t.split(":")).reverse();var a=(a=t.pop()).replace(/^\s+|\s+$/g,"");t.reverse();t=(t=t.join(":")).replace(/^\s+|\s+$/g,"");i[a]=t}),s=i),n.extend(!0,{},o,s)}}}),define("pat-base",["jquery","pat-registry","pat-mockup-parser","pat-logger"],function(i,n,c,l){"use strict";function s(e,t,a){var o=this.prototype.name,i=l.getLogger("pat."+o),s=e.data("pattern-"+o);if(void 0===s&&n.patterns[o]){try{t="mockup"===this.prototype.parser?c.getOptions(e,o,t):t,s=new n.patterns[o](e,t,a)}catch(e){i.error("Failed while initializing '"+o+"' pattern.",e)}e.data("pattern-"+o,s)}return s}function r(e,t,a){this.$el=e,this.options=i.extend(!0,{},this.defaults||{},t||{}),this.init(e,t,a),this.emit("init")}var d=l.getLogger("Patternslib Base");return r.prototype={constructor:r,on:function(e,t){this.$el.on(e+"."+this.name+".patterns",t)},emit:function(e,t){void 0===t&&(t=[]),this.$el.trigger(e+"."+this.name+".patterns",t)}},r.extend=function(e){var t,a=this;if(!e)throw new Error("Pattern configuration properties required when calling Base.extend");(t=e.hasOwnProperty("constructor")?e.constructor:function(){a.apply(this,arguments)}).extend=r.extend,t.init=s,t.jquery_plugin=!0,t.trigger=e.trigger;function o(){this.constructor=t}return o.prototype=a.prototype,t.prototype=new o,i.extend(!0,t.prototype,e),t.__super__=a.prototype,e.name?e.trigger?n.register(t,e.name):d.warn("The pattern '"+e.name+"' does not have a trigger attribute, it will not be registered."):d.warn("This pattern without a name attribute will not be registered!"),t},r}),define("mosaic-url/mosaic.tile",["jquery","pat-logger","underscore","mockup-utils","pat-registry","mockup-patterns-tinymce","tinymce","mockup-patterns-modal"],function(g,e,n,s,t,v,c,a){"use strict";function y(){clearTimeout(o),o=setTimeout(i,50)}var l=[],d=e.getLogger("pat-mosaic"),o=0,i=function(){var e,t,a,o=g(".mosaic-selected-tile .mosaic-rich-text-toolbar").filter(":visible");0!==o.length&&0!==o.find(".mce-first").length&&(e=o.parent(),o.removeClass("right"),e.offset().left>=g(window).width()/2&&o.addClass("right"),t=g(window),a=g(".mosaic-toolbar").height(),e.offset().top-o.height()<t.scrollTop()+a?o.hasClass("sticky")||(g("body").addClass("mce-sticky"),o.addClass("sticky"),a={top:g(".mosaic-toolbar").height()+o.height()},o.hasClass("right")?a.right=o.offset().right:a.left=o.offset().left,o.css(a)):(o.removeClass("sticky"),o.removeAttr("style"),g("body").removeClass("mce-sticky")))};g(window).off("scroll",y).on("scroll",y);function b(e){var i=this;i.tinymce=null,i.$el=g(e),i.$el.is(".mosaic-tile")||(i.$el=i.$el.parents(".mosaic-tile")),i.focusCheckCount=0,i.$el.children(".mosaic-tile-content").off("blur").on("blur",function(){var t,a,o,e=i.getConfig();e&&"textapp"===e.tile_type&&(!(t=i.getEditUrl())||(a=i.getHtmlContent())!==i.$el.data("lastSavedData")&&(i.$el.data("activeSave")||(i.$el.data("activeSave",!0),(o={_authenticator:s.getAuthenticator(),"buttons.save":"Save"})[e.name+".content"]=a,g.mosaic.queue(function(e){g.ajax({url:t,method:"POST",data:o}).always(function(){i.$el.data("lastSavedData",a),i.$el.data("activeSave",!1),e()})}))))})}return b.prototype.getDataTileEl=function(e,t){return this.$el.find("[data-tile]")},b.prototype.getContentEl=function(e,t){return this.$el.children(".mosaic-tile-content")},b.prototype.getHtmlContent=function(){return this.getContentEl().html()},b.prototype.getEditUrl=function(){var e=this.getUrl();if(e=e&&e.replace(/@@/,"@@edit-tile/"))return e=e.match(/^\.\/.*/)?g.mosaic.options.context_url+e.replace(/^\./,""):e},b.prototype.getDeleteUrl=function(){var e=this.getUrl().split("?")[0],t=(e=e.split("@@"))[1].split("/");return e=(e=e[0]+"@@delete-tile/"+t[0]+"/"+t[1]).match(/^\.\/.*/)?g.mosaic.options.context_url+e.replace(/^\./,""):e},b.prototype.getUrl=function(){var e,t=this.$el.find(".tileUrl").html();if(t||0<(e=this.$el.find("[data-tileUrl]")).length&&(t=e.attr("data-tileUrl")),t=t||this.$el.find("[data-tile]").attr("data-tile"))for(t=(t=t.replace(g.mosaic.options.context_url,"./")).replace(/^\.\/\//,"./"),g.mosaic.hasContentLayout?-1===t.indexOf("X-Tile-Persistent")&&(-1===t.indexOf("?")?t+="?":t+="&",t+="X-Tile-Persistent=yes"):-1!==t.indexOf("X-Tile-Persistent")&&(t=t.replace("X-Tile-Persistent=yes","").replace("&&","&"));-1!==t.indexOf("&_layouteditor=true");)t=t.replace("&_layouteditor=true","");return t},b.prototype.getType=function(){var t="",e=this.$el,a=[];return e.attr("class")&&(a=e.attr("class").split(" "),g(a).each(function(){var e=this.match(/^mosaic-([\w.\-]+)-tile$/);null!==e&&"selected"!==e[1]&&"new"!==e[1]&&"read-only"!==e[1]&&"helper"!==e[1]&&"original"!==e[1]&&"edited"!==e[1]&&(t=e[1])})),t||d.error("Could not find tile type on element with classes: "+a.join(", ")),t},b.prototype.deprecatedHTMLTiles=["table","numbers","bullets","text","subheading","heading"],b.prototype.getConfig=function(){for(var e,t=this.getType(),a=0;a<g.mosaic.options.tiles.length;a+=1){for(var o=!1,i=g.mosaic.options.tiles[a],s=0;s<i.tiles.length;s+=1){if("field"===i.tiles[s].tile_type){var n=i.tiles[s].widget.split(".");switch(n=n[n.length-1]){case"TextWidget":case"TextFieldWidget":case"TextAreaWidget":case"TextAreaFieldWidget":case"TextLinesWidget":case"TextLinesFieldWidget":case"WysiwygWidget":case"WysiwygFieldWidget":case"RichTextWidget":case"RichTextFieldWidget":i.tiles[s].settings=!1;break;default:i.tiles[s].settings=!0}}if(i.tiles[s].name===t){e=i.tiles[s],o=!0;break}}if(o)break}return e||(-1===l.indexOf(t)&&(d.error("Could not load tile config for tile type: "+t+" falling back to b/w compatible tile type."),l.push(t)),e={tile_type:"app",name:t,label:"Unknown",read_only:!0,favorite:!1,settings:!1,weight:0,rich_text:!1},-1!==this.deprecatedHTMLTiles.indexOf(t)&&(e.category="structure",e.read_only=!1,e.label=t,e.tile_type="text",e.rich_text=!0)),e},b.prototype.getHtmlBody=function(e){var t,a="",o=this.$el.attr("class").split(" "),i=this.getType(),o=g(o).filter(function(){switch(this){case"mosaic-new-tile":case"mosaic-helper-tile":case"mosaic-original-tile":case"mosaic-selected-tile":case"mosaic-edited-tile":return!1;default:return!0}}).toArray();switch(this.getConfig().tile_type){case"text":t=c.get(this.$el.children(".mosaic-tile-content").attr("id")),a+='          <div class="'+o.join(" ")+'">\n',a+='          <div class="mosaic-tile-content">\n',a+=(t?t.getContent():this.$el.children(".mosaic-tile-content").html()).replace(/^\s+|\s+$/g,"")+"\n",a+="          </div>\n",a+="          </div>\n";break;case"app":case"textapp":var s=this.getUrl();e&&(n=((t=c.get(this.$el.children(".mosaic-tile-content").attr("id")))?t.getContent():this.$el.children(".mosaic-tile-content").html()).replace(/^\s+|\s+$/g,"")+"\n",-1===s.indexOf("?")?s+="?":s+="&",s+="content="+encodeURI(n)),a+='          <div class="'+o.join(" ")+'">\n',a+='          <div class="mosaic-tile-content">\n',a+='          <div data-tile="'+s+'"></div>\n',a+="          </div>\n",a+="          </div>\n";break;case"field":a+='          <div class="'+o.join(" ")+'">\n',a+='          <div class="mosaic-tile-content">\n';var n="./@@plone.app.standardtiles.field?field="+i,s=this.getValueFromClasses(o,"mosaic-subfield-");s&&(n+="&subfield="+s);s=this.getValueFromClasses(o,"mosaic-format-");s&&(n+="&format="+s),a+='          <div data-tile="'+n+'"></div>\n',a+="          </div>\n",a+="          </div>\n",this.saveForm()}return a},b.prototype.isRichText=function(e){return!(!(e=void 0===e?this.getConfig():e)||!1!==this.$el.hasClass("mosaic-read-only-tile")||!("text"===e.tile_type&&e.rich_text||"textapp"===e.tile_type&&e.rich_text||"app"===e.tile_type&&e.rich_text||"field"===e.tile_type&&!1===e.read_only&&("z3c.form.browser.text.TextWidget"===e.widget||"z3c.form.browser.text.TextFieldWidget"===e.widget||"z3c.form.browser.textarea.TextAreaWidget"===e.widget||"z3c.form.browser.textarea.TextAreaFieldWidget"===e.widget||"z3c.form.browser.textlines.TextLinesWidget"===e.widget||"z3c.form.browser.textlines.TextLinesFieldWidget"===e.widget||"plone.app.z3cform.widget.RichTextFieldWidget"===e.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"===e.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"===e.widget||"plone.app.widgets.dx.RichTextWidget"===e.widget)))},b.prototype.initialize=function(){var e,t,a,o,i=this.getConfig();i&&i.read_only&&this.$el.addClass("mosaic-read-only-tile"),this.isRichText()&&this.setupWysiwyg(),this.$el.prepend(g(g.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(g(g.mosaic.document.createElement("div")).addClass("mosaic-tile-inner-border"))),i&&(e=g(g.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-tile-side-tools"),this.$el.prepend(e.append(g(g.mosaic.document.createElement("div")).addClass("mosaic-tile-label").append(g(g.mosaic.document.createElement("div")).addClass("mosaic-tile-label-content").html(i.label)).append(g(g.mosaic.document.createElement("div")).addClass("mosaic-tile-label-left")))),this.$el.parent().hasClass("col")||(i=this.$el.parent().attr("class").split(" "),i=this.getValueFromClasses(i,"col-"),t=void 0===i?"":" ("+i+")",e.append(g(g.mosaic.document.createElement("div")).addClass("mosaic-tile-label").append(g(g.mosaic.document.createElement("div")).addClass("mosaic-tile-label-reset").append((a=this.resetClicked.bind(this),(o=document.createElement("a")).href="javascript:",o.textContent="Reset"+t,g(o).on("click",a),o))).append(g(g.mosaic.document.createElement("div")).addClass("mosaic-tile-label-left"))))),this.makeMovable(),this.initializeButtons();var s=this;n.each(["top","bottom","right","left"],function(e){s.$el.prepend(g(g.mosaic.document.createElement("div")).addClass("mosaic-divider mosaic-divider-"+e).append(g(g.mosaic.document.createElement("div")).addClass("mosaic-divider-dot")))})},b.prototype.resetClicked=function(e){e.preventDefault();this.$el.parent().removeClass("col-1 col-2 col-3 col-4 col-5 col-6 col-7 col-8 col-9 col-10 col-11 col-12").addClass("col"),g(e.target).parent().parent().remove();e=this.$el.parent().parent();e.mosaicCleanupRow(),e.mosaicSetResizeHandles()},b.prototype.initializeButtons=function(){var i=[],e=this.getConfig();this.$el.find(".mosaic-tile-buttons").remove();var t,a=function(e,t,a){var o=document.createElement("button");return o.className="mosaic-btn-"+t,o.textContent=e,i.push(o),g(o).on("click",a),o};e&&e.settings&&!1===this.$el.hasClass("mosaic-read-only-tile")&&a("Edit","settings",this.settingsClicked.bind(this)),g.mosaic.hasContentLayout||(a("Delete","delete",this.deleteClicked.bind(this)),e=a("Confirm delete","confirm",this.confirmClicked.bind(this)),g(e).hide(),a=a("Cancel","cancel",this.cancelClicked.bind(this)),g(a).hide()),0<i.length&&(t=g(g.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-tile-buttons"),this.$el.prepend(t),i.forEach(function(e){t.append(e)}))},b.prototype.cancelClicked=function(e){e.preventDefault(),g(".mosaic-btn-settings,.mosaic-btn-delete",this.$el).show(),g(".mosaic-btn-cancel,.mosaic-btn-confirm",this.$el).hide()},b.prototype.deleteClicked=function(e){e.preventDefault(),g(".mosaic-btn-settings,.mosaic-btn-delete",this.$el).hide(),g(".mosaic-btn-cancel,.mosaic-btn-confirm",this.$el).show()},b.prototype.confirmClicked=function(e){e.preventDefault();var t=this,e=this.getConfig();"app"!==e.tile_type&&"textapp"!==e.tile_type||(a=this.getUrl())&&"undefined"!==a&&(g.mosaic.removeHeadTags(a),g.mosaic.queue(function(e){g.ajax({type:"POST",url:t.getDeleteUrl(),data:{"buttons.delete":"Delete",_authenticator:s.getAuthenticator()}}).always(function(){e()})})),g.mosaic.options.panels.find(".mosaic-empty-row").remove();var a=this.$el.parent().parent();this.saveForm(),this.$el.remove(),a.mosaicCleanupRow(),g.mosaic.options.panels.mosaicAddEmptyRows(),g.mosaic.options.toolbar.trigger("selectedtilechange")},b.prototype.settingsClicked=function(e){e.preventDefault();var s=this,t=s.getConfig();"app"===t.tile_type?(e=s.getEditUrl(),g.mosaic.overlay.app=new a(g(".mosaic-toolbar"),{ajaxUrl:e,loadLinksWithinModal:!0,buttons:'.formControls > button[type="submit"], .actionButtons > button[type="submit"]'}),g.mosaic.overlay.app.$el.off("after-render"),g.mosaic.overlay.app.on("after-render",function(e){g('input[name*="cancel"]',g.mosaic.overlay.app.$modal).off("click").on("click",function(){g.mosaic.overlay.app.hide(),g.mosaic.overlay.app=null}),g.mosaic.hasContentLayout&&g("form",g.mosaic.overlay.app.$modal).append(g('<input type="hidden" name="X-Tile-Persistent" value="yes" />'))}),g.mosaic.overlay.app.show(),g.mosaic.overlay.app.$el.off("formActionSuccess"),g.mosaic.overlay.app.on("formActionSuccess",function(e,t,a,o,i){o=o.getResponseHeader("X-Tile-Url"),t=g.mosaic.getDomTreeFromHtml(t);o&&(g.mosaic.removeHeadTags(o),g.mosaic.addHeadTags(o,t),t=t.find(".temp_body_tag").html(),s.fillContent(t,o),g.mosaic.overlay.app.hide(),g.mosaic.overlay.app=null)})):g.mosaic.overlay.open("field",t)},b.prototype.makeMovable=function(){this.$el.hasClass("movable")&&g.mosaic.options.canChangeLayout&&!g.mosaic.hasContentLayout&&this.$el.prepend(g(g.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-drag-handle"))},b.prototype.getValueFromClasses=function(e,t){var a;return e.forEach(function(e){-1!==e.indexOf(t)&&(a=e.replace(t,""))}),a},b.prototype.initializeContent=function(){var e,t,a,o,i,s=this,n=(n=g("body",g.mosaic.document).attr("data-base-url"))||g("head > base",g.mosaic.document).attr("href"),c=this.getUrl(),l=this.getConfig();if("field"===l.tile_type){switch(a="",t="IDublinCore-title"===l.name?(e='<h1 class="documentFirstHeading">',"</h1>"):"IDublinCore-description"===l.name?(e='<p class="documentDescription">',"</p>"):(e="<div>","</div>"),l.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":a=e+g("#"+l.id).find("input").attr("value")+t;break;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":o=g("#"+l.id).find("textarea").val().split("\n"),a+=e;for(var r=0;r<o.length;r+=1)a+=o[r]+"<br/>";a+=t;break;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":a=g("#"+l.id).find("textarea").val();break;default:a='<div class="discreet">Placeholder for field:<br/><b>'+l.label+"</b></div>"}s.fillContent(a)}else l&&(s.$el.addClass("mosaic-tile-loading"),i=n=n?[n,c].join("/").replace(/\/+\.\//g,"/"):c,-1===n.indexOf("?")?n+="?":n+="&",-1===n.indexOf("_layouteditor")&&(n+="_layouteditor=true"),g.ajax({type:"POST",url:n,success:function(e){s.$el.removeClass("mosaic-tile-loading"),e=g.mosaic.getDomTreeFromHtml(e),g.mosaic.addHeadTags(c,e);e=e.find(".temp_body_tag").html();s.fillContent(e,i),"plone.app.standardtiles.html"===s.getType()&&(s.$el.data("lastSavedData")||s.$el.data("lastSavedData",s.getHtmlContent()))},error:function(){s.$el.removeClass("mosaic-tile-loading"),d.error("Error getting data for the tile "+l.label+"("+l.name+"). Please read documentation on how to correctly register tiles: https://pypi.python.org/pypi/plone.tiles")}}))},b.prototype.fillContent=function(e,t){var a,o=this.getDataTileEl();if(0<o.length?(o.parent().html(e),a=this.getContentEl()):(a=this.getContentEl()).html(e),t&&0<a.length){for(t=t.replace(/&/gim,"&amp;");-1!==t.indexOf("&amp;&amp;");)t=t.replace("&amp;&amp;","&amp;");a.attr("data-tileUrl",t)}this.cacheHtml(e),this.scanRegistry()},b.prototype.cacheHtml=function(e){var t;this.isRichText()||0!==(t=this.$el.children(".mosaic-tile-content")).length&&(void 0===e&&(e=t.html()),t[0]._preScanHTML=e)},b.prototype.scanRegistry=function(){var e;this.isRichText()||0!==(e=this.$el.find(".mosaic-tile-content")).length&&(e[0]._preScanHTML&&e.html(e[0]._preScanHTML),t.scan(e),g("a",e).on("click",function(e){e.preventDefault(),e.stopPropagation()}))},b.prototype.select=function(){var e;!1===this.$el.hasClass("mosaic-selected-tile")&&!1===this.$el.hasClass("mosaic-read-only-tile")&&(1===(e=g(".mosaic-selected-tile",g.mosaic.document)).length&&new b(e).blur(),this.focus())},b.prototype._change=function(){g.mosaic.options.toolbar.trigger("selectedtilechange"),this.saveForm()},b.prototype.blur=function(){this.$el.removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),this.$el.find(".mce-edit-focus").removeClass("mce-edit-focus"),this._change()},b.prototype._focus=function(){var e=this;this.$el.addClass("mosaic-selected-tile"),this.$el.children(".mosaic-tile-content").focus(),this._change(),this.initializeButtons();console.log("focusCheckCount",e.focusCheckCount),e.isRichText()&&e.focusCheckCount<30&&(e.focusCheckTimeout&&clearTimeout(e.focusCheckTimeout),e.focusCheckTimeout=setTimeout(function(){e.focusCheckCount+=1,e.$el.hasClass("mosaic-selected-tile")&&(e.$el.find(".mosaic-rich-text").hasClass("mce-edit-focus")||(e.$el.removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),e.$el.find(".mce-edit-focus").removeClass("mce-edit-focus"),e._focus()))},150))},b.prototype.focus=function(){this.isRichText()&&!0!==this.$el.data("tinymce-loaded")?this.$el.data("delayed-focus",!0):this._focus()},b.prototype.saveForm=function(){var e,t=this.getType(),a=this.getConfig();if(a&&"field"===a.tile_type&&!1===a.read_only&&("z3c.form.browser.text.TextWidget"===a.widget||"z3c.form.browser.text.TextFieldWidget"===a.widget||"z3c.form.browser.textarea.TextAreaWidget"===a.widget||"z3c.form.browser.textarea.TextAreaFieldWidget"===a.widget||"z3c.form.browser.textlines.TextLinesWidget"===a.widget||"z3c.form.browser.textlines.TextLinesFieldWidget"===a.widget||"plone.app.z3cform.widget.RichTextFieldWidget"===a.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"===a.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"===a.widget||"plone.app.widgets.dx.RichTextWidget"===a.widget))switch(a.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":var o=g(".mosaic-panel .mosaic-"+t+"-tile",g.mosaic.document),i=(o=1<o.length?o.filter(function(){return 0<g(".mosaic-tile-control",this).length}):o).find(".mosaic-tile-content > *").text();g("#"+a.id).find("input").val(i);break;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":e="",g(".mosaic-panel .mosaic-"+t+"-tile",g.mosaic.document).find(".mosaic-tile-content > *").each(function(){e+=g(this).text()}),e=e.replace(/^\s+|\s+$/g,""),g("#"+a.id).find("textarea").val(e);break;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":var s=g(document.getElementById(a.id)).find("textarea"),o=s.attr("id"),i=c.get(o),o=g(".mosaic-"+t+"-tile",g.mosaic.document).find(".mosaic-tile-content").html();s.val(o),i&&i.setContent(o)}},b.prototype.setupWysiwyg=function(){var t=this,a=t.$el.find(".mosaic-tile-content");t.$el.data("tinymce-loaded",!1);try{a.data("pattern-tinymce").destroy(),a.removeData("pattern-tinymce")}catch(e){}for(var e=1+Math.floor(1e5*Math.random());0<g("#mosaic-rich-text-init-"+e,g.mosaic.document).length;)e=1+Math.floor(1e5*Math.random());var o="mosaic-rich-text-init-"+e;a.attr("id",o),a.siblings(".mosaic-rich-text-toolbar").remove();var i,s,n,c,l,r,d=g('<div class="mosaic-rich-text-toolbar" />').attr("id",o+"-toolbar");a.before(d);var m=t.getType();for(-1!==this.deprecatedHTMLTiles.indexOf(m)&&(m="plone.app.standardtiles.html"),i=g.mosaic.options.default_available_actions,n=0;n<g.mosaic.options.tiles.length;n+=1)for(s=g.mosaic.options.tiles[n],c=0;c<s.tiles.length;c+=1)s.tiles[c].name===m&&(i=i.concat(s.tiles[c].available_actions));for(l=[],n=0;n<g.mosaic.options.richtext_toolbar.length;n+=1){for(s=g.mosaic.options.richtext_toolbar[n],c=0;c<s.actions.length;c+=1)-1<g.inArray(s.actions[c].name,i)&&l.push(s.actions[c].action);l.length&&"|"!=l[l.length-1]&&l.push("|")}for(l.length&&"|"==l[l.length-1]&&l.pop(),r=[],n=0;n<g.mosaic.options.richtext_contextmenu.length;n+=1){for(s=g.mosaic.options.richtext_contextmenu[n],c=0;c<s.actions.length;c+=1)-1<g.inArray(s.actions[c].name,i)&&r.push(s.actions[c].action);r.length&&"|"!=r[r.length-1]&&r.push("|")}r.length&&"|"==r[r.length-1]&&r.pop();function u(){var e=a.find("p > *");(0===e.length||1===e.length&&e.is("br"))&&0===a.text().replace(/^\s+|\s+$/g,"").length?(a.addClass("mosaic-tile-content-empty"),0===a.find("p").length&&a.empty().append("<p></p>")):a.removeClass("mosaic-tile-content-empty")}function p(){clearTimeout(h),h=setTimeout(u,100)}var h=0,f=g.mosaic.options.tinymce.tiny.paste_as_text||!1;0===l.length&&(f=!0),new v(a,g.extend(!0,{},g.mosaic.options.tinymce,{inline:!1,tiny:{body_id:o,selector:"#"+o,inline:!0,paste_as_text:f,fixed_toolbar_container:"#"+d.attr("id"),ui_container:"#"+d.attr("id"),theme_advanced_toolbar_align:"right",menubar:!1,toolbar:l.join(" ")||!1,statusbar:!1,contextmenu:r.join(" ")||!1,plugins:g.mosaic.options.tinymce.tiny.plugins.concat(r.length?["contextmenu"]:[]),setup:function(e){(t.tinymce=e).on("focus",function(e){e.target.id&&(0===g(".mosaic-helper-tile").length?(t.select(),y()):setTimeout(function(){g(".mce-edit-focus").each(function(){new b(g(this).parent()).blur();var e=window.tinyMCE.get(this.getAttribute("id"));e&&e.hide()})},10))}),0===l.length&&e.on("keydown",function(e){13===e.keyCode&&e.preventDefault()}),e.on("keyup change",p),p(),e.on("init",function(){console.log("editor.id",o),t.$el.data("tinymce-loaded",!0),!0===t.$el.data("delayed-focus")&&(t.$el.data("delayed-focus",!1),setTimeout(function(){t._focus()},50))})}}})),a.addClass("mosaic-rich-text")},b.validTile=function(e){e=g(e);return!!e.is(".mosaic-tile")||0<e.parents(".mosaic-tile").length},b}),define("mosaic-url/mosaic.panel",["jquery","pat-logger","underscore"],function(s,e,t){"use strict";var a=e.getLogger("pat-mosaic"),e=function(e){this.$el=s(e)};return e.prototype.initialize=function(e){var t,a=this.$el.data("panel"),o=s("[data-panel="+a+"]",s.mosaic.document),i=this.$el.data("max-columns")||6;"content"===a&&0===o.length&&s("#"+a,s.mosaic.document).each(function(){(o=s(this)).attr("data-panel",a)}),"content"===a?(t=o.attr("id"),0===s(".mosaic-original-content",s.mosaic.document).length?(o.before(s(document.createElement("div")).attr("id",t).attr("class",o.attr("class")).addClass("mosaic-panel").attr("data-panel","content").attr("data-max-columns",i).html(e.find("[data-panel="+a+"]").html())),o.removeAttr("data-panel").removeAttr("id").addClass("mosaic-original-content")):o.replaceWith(s(document.createElement("div")).attr("id",t).attr("class",o.attr("class")).addClass("mosaic-panel").attr("data-panel","content").attr("data-max-columns",i).html(e.find("[data-panel="+a+"]").html()))):(o.attr("class",e.find("[data-panel="+a+"]").attr("class")),o.addClass("mosaic-panel"),o.html(e.find("[data-panel="+a+"]").html()))},e.prototype.prefill=function(){this.$el.hasClass("mosaic-panel")||(a.info(s(this)),s(this).addClass("mosaic-panel"),s(this).children().wrap(s('<div class="mosaic-grid-row"><div class="mosaic-grid-cell mosaic-position-0 col-12"><div class="movable removable mosaic-tile mosaic-text-tile"><div class="mosaic-tile-content"></div></div></div></div>')))},e}),define("mosaic-url/mosaic.layout",["jquery","mosaic-url/mosaic.tile","pat-logger","underscore","pat-registry","mockup-patterns-modal"],function(g,c,e,l,t,a){"use strict";void 0===g.mosaic&&(g.mosaic={}),g.mosaic.layout={widthClasses:["col","col-1","col-2","col-3","col-4","col-5","col-6","col-7","col-8","col-9","col-10","col-11","col-12"],dataClasses:["mosaic-col","mosaic-col-1","mosaic-col-2","mosaic-col-3","mosaic-col-4","mosaic-col-5","mosaic-col-6","mosaic-col-7","mosaic-col-8","mosaic-col-9","mosaic-col-10","mosaic-col-11","mosaic-col-12"],positionClasses:["mosaic-position-0","mosaic-position-1","mosaic-position-2","mosaic-position-3","mosaic-position-4","mosaic-position-5","mosaic-position-6","mosaic-position-7","mosaic-position-8","mosaic-position-9","mosaic-position-10","mosaic-position-11","mosaic-position-12"],resizeHandleClasses:["mosaic-resize-handle-1","mosaic-resize-handle-2","mosaic-resize-handle-3","mosaic-resize-handle-4","mosaic-resize-handle-5","mosaic-resize-handle-6","mosaic-resize-handle-7","mosaic-resize-handle-8","mosaic-resize-handle-9","mosaic-resize-handle-10","mosaic-resize-handle-11","mosaic-resize-handle-12"]},g.fn.mosaicLayout=function(){g(g.mosaic.document).off("keydown").on("keydown",function(e){var t;18===e.keyCode&&(g(".mosaic-panel",g.mosaic.document).hasClass("mosaic-advanced")?g(".mosaic-panel",g.mosaic.document).removeClass("mosaic-advanced"):(t=new Date,g(".mosaic-panel",g.mosaic.document).addClass("mosaic-advanced"),g(".mosaic-panel",g.mosaic.document).data("advanced-enabled",t.getTime()))),17===e.keyCode&&g(".mosaic-panel",g.mosaic.document).addClass("inner-subcolumn"),27===e.keyCode&&(0<(e=g(".mosaic-original-tile",g.mosaic.document)).length?e.each(function(){g(this).addClass("mosaic-drag-cancel"),g(this).hasClass("mosaic-helper-tile-new")?g(document).trigger("mousedown"):g(document).trigger("mouseup")}):g(".mosaic-selected-tile",g.mosaic.document).each(function(){new c(this).blur()}),g(".mosaic-resize-handle-helper",g.mosaic.document).each(function(){g(this).parents("[data-panel]").removeClass("mosaic-panel-resizing"),g(this).parent().removeClass("mosaic-row-resizing"),g(this).parent().children(".mosaic-resize-placeholder").remove(),g(this).remove()}),g.mosaic.overlay.app&&g.mosaic.overlay.app.hide())}),g(g.mosaic.document).off("keyup").on("keyup",function(e){var t,a;18===e.keyCode&&(t=new Date,a=g(".mosaic-panel",g.mosaic.document).data("advanced-enabled"),400<t.getTime()-a&&g(".mosaic-panel",g.mosaic.document).removeClass("mosaic-advanced")),17===e.keyCode&&g(".mosaic-panel",g.mosaic.document).removeClass("inner-subcolumn")});g(g.mosaic.document).off("mousedown").on("mousedown",function(e){var t;e.target?t=e.target:e.srcElement&&(t=e.srcElement),0<g(t).parents(".mce-panel").length||(0===g(t).parents(".mosaic-tile").length&&0===g(t).parents(".mosaic-toolbar").length&&(g(".mosaic-selected-tile",g.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),g.mosaic.options.toolbar.trigger("selectedtilechange")),0<(t=g(".mosaic-helper-tile-new",g.mosaic.document)).length&&t.each(function(){g(this).mosaicHandleDragEnd()}))});var e=function(f){g(".mosaic-helper-tile-new",g.mosaic.document).each(function(){var e=g(this).parent().offset();g(this).css("top",f.pageY+3-e.top),g(this).css("left",f.pageX+3-e.left)}),g(".mosaic-resize-handle-helper",g.mosaic.document).each(function(){var e;console.log("===================");var t=g(this),a=t.parent(),s=t.data("resize_handle_index"),o=parseFloat(f.pageX-a.offset().left-4),i=Math.round(o/t.data("row_width")*100),n=8,c=8,l=v();g(l).each(function(){(e=Math.abs(this-i))<c&&(n=this,c=e)});var r=function(e){for(var t=v(),a=0;a<t.length;a++)if(e===t[a])return a+1;return 12}(n),d=[];a.children(".mosaic-resize-placeholder").each(function(e){var t=b(g(this).mosaicGetWidthClass());d.push(t)});for(var m=0,u=0,p=0;p<d.length;p++)p<s&&(m+=d[p]||2),p==s&&d[p],s<p&&(u+=d[p]||2);var h=r-m,o=12-m-u,l=m+(h=o<h?o:h<0?0:h);console.log("column_sizes",d),console.log("snap_size",r),console.log("col_size_before",m),console.log("col_size_after",u),console.log("col_size_max",o),console.log("col_size",h),console.log("col_size_handle",l),console.log("resize_handle_index",s),1<t.data("nr_of_columns")&&(a.children(".mosaic-resize-placeholder").each(function(e){if(e===s){d[e]=h;var t="mosaic-resize-0";if(1<d.length&&0<e){for(var a=0,o=0;o<e;o++)a+=d[o];t="mosaic-resize-"+a}var i=y(h);g(this).removeClass(g.mosaic.layout.widthClasses.join(" ")).removeClass(g.mosaic.layout.dataClasses.join(" ")).removeClass(g.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).addClass("mosaic-"+i+" "+i+" "+t).find(".info").html(h)}}),g(this).data("column_sizes",d))})};g(g.mosaic.document).off("mousemove").on("mousemove",e),g(g.mosaic.document).off("dragover").on("dragover",e);g(g.mosaic.document).off("mouseup").on("mouseup",function(e){g(".mosaic-resize-handle-helper",g.mosaic.document).each(function(){var t=g(this).data("resize_handle_index");g(this).parent().parent().mosaicCleanupRow();var e=g(this).parents("[data-panel]"),o=g(this).data("column_sizes");g(this).parent().children(".mosaic-grid-cell").each(function(a){for(var e=0;e<a;e++)o[e];g(this).removeClass(g.mosaic.layout.positionClasses.join(" ")).removeClass(g.mosaic.layout.widthClasses.join(" ")).addClass(y(o[a])),g(this).hasClass("col")||a!==t||g(this).children(".mosaic-tile").first().children(".mosaic-tile-side-tools").each(function(e){var t=g(this);t.children(".mosaic-tile-label").children(".mosaic-tile-label-reset").parent().remove(),t.append(g(g.mosaic.document.createElement("div")).addClass("mosaic-tile-label").append(g(g.mosaic.document.createElement("div")).addClass("mosaic-tile-label-reset").append(s(t,o[a]))).append(g(g.mosaic.document.createElement("div")).addClass("mosaic-tile-label-left")))})}),e.removeClass("mosaic-panel-resizing"),g(this).parent().removeClass("mosaic-row-resizing"),g(this).parent().children(".mosaic-resize-placeholder").remove(),g(this).parent().mosaicSetResizeHandles();e=e.find(".mosaic-selected-tile");0<e.length&&new c(e).select(),g(this).remove()})});e=function(e){if(g(this).parents("[data-panel]").hasClass("mosaic-panel-dragging")&&(g(".mosaic-selected-divider",g.mosaic.document).removeClass("mosaic-selected-divider"),!1===g(this).hasClass("mosaic-original-tile")&&!1===g(this).hasClass("mosaic-tile-align-left")&&!1===g(this).hasClass("mosaic-tile-align-right"))){var t=g(this).mosaicGetDirection(e),e=g(this).children(".mosaic-divider-"+t);if("left"===t||"right"===t){t=e.parent().parent().parent();if(t.children(".mosaic-grid-cell").length>=g(".mosaic-panel").data("max-columns"))return;1<t.children(".mosaic-grid-cell").length?(e.height(t.height()+5),e.css("top",t.offset().top-e.parent().offset().top-5)):(e.height(e.parent().height()+5),e.css("top",-5))}e.addClass("mosaic-selected-divider")}};g(g.mosaic.document).off("mousemove",".mosaic-tile").on("mousemove",".mosaic-tile",e),g(g.mosaic.document).off("dragover",".mosaic-tile").on("dragover",".mosaic-tile",e),g(g.mosaic.document).off("click",".mosaic-tile").on("click",".mosaic-tile",function(){0===g(".mosaic-helper-tile-new",g.mosaic.document).length&&new c(this).select()});g(g.mosaic.document).on("dblclick",".mosaic-grid-row",function(e){var t,a=g(e.target);a.parents("[data-panel]").hasClass("mosaic-advanced")&&a.hasClass("mosaic-grid-row")&&(0<g(a).find(".mosaic-set-custom-css").length||(t=[],g.each(a.attr("class").split(" "),function(){void 0!==this&&"mosaic-grid-row"!==this&&"mosaic-innergrid-row"!==this&&t.push(this)}),e=g("<input type='text' id='custom-css-input-box'></input>").val(t.join(" ")),e=g("<div></div>").addClass("mosaic-set-custom-css").append(g("<label>Custom CSS for this row:</label>")).append(e),a.append(e)))}),g(g.mosaic.document).on("click",function(e){"custom-css-input-box"!==g(e.target).attr("id")&&g.each(g("div.mosaic-set-custom-css"),function(){var e=g(this).parent(),t="mosaic-grid-row";e.hasClass("mosaic-innergrid-row")&&(t="mosaic-grid-row mosaic-innergrid-row"),t+=" "+g(this).find("input#custom-css-input-box").val(),e.attr("class",t),g(this).remove()})});var i=this.length;return this.each(function(e){var t,a,o=g(this);o.find(".mosaic-tile").each(function(){var e=new c(this);e.initialize(),e.scanRegistry()}),o.find(".mosaic-tile").mosaicAddDrag(),o.mosaicAddEmptyRows(),o.children(".mosaic-grid-row").mosaicSetResizeHandles(),e===i-1&&(a=t=0,g.mosaic.options.panels.each(function(e){g(this).width()>t&&(t=g(this).width(),a=e)}),0<(e=g.mosaic.options.panels.eq(a).find(".mosaic-tile:first")).length&&new c(e).select()),o.find(".mosaic-innergrid-row").each(function(){g(this).mosaicAddMouseMoveInnergridRow(),g(this).mosaicSetResizeHandles();var t=g(this);l.each(["top","bottom"],function(e){t.append(g(g.mosaic.document.createElement("div")).addClass("mosaic-divider mosaic-divider-"+e).append(g(g.mosaic.document.createElement("div")).addClass("mosaic-divider-dot")))})})})},g.fn.mosaicAddMouseMoveEmptyRow=function(){return this.each(function(){g(this).mousemove(function(){g(this).parents("[data-panel]").hasClass("mosaic-panel-dragging")&&(g(".mosaic-selected-divider",g.mosaic.document).removeClass("mosaic-selected-divider"),g(this).children("div").addClass("mosaic-selected-divider"))})})},g.fn.mosaicAddMouseMoveInnergridRow=function(){return this.each(function(){g(this).mousemove(function(e){g(this).parents("[data-panel]").hasClass("mosaic-panel-dragging")&&(g(".mosaic-selected-divider",g.mosaic.document).removeClass("mosaic-selected-divider"),e=g(this).mosaicGetDirection(e),g(this).children(".mosaic-divider-"+e).addClass("mosaic-selected-divider"))})})},g.fn.mosaicAddEmptyRows=function(){return this.each(function(){g(this).find(".mosaic-grid-row:not(.mosaic-innergrid-row)").each(function(e){g(this).before(g(g.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-empty-row").append(g(g.mosaic.document.createElement("div")).addClass("mosaic-grid-cell col").append(g(g.mosaic.document.createElement("div")).append(g(g.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(g(g.mosaic.document.createElement("div")).addClass("mosaic-divider-dot"))))).mosaicAddMouseMoveEmptyRow()),0===g(this).nextAll(".mosaic-grid-row").length&&g(this).after(g(g.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-empty-row").append(g(g.mosaic.document.createElement("div")).addClass("mosaic-grid-cell col").append(g(g.mosaic.document.createElement("div")).append(g(g.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(g(g.mosaic.document.createElement("div")).addClass("mosaic-divider-dot"))))).mosaicAddMouseMoveEmptyRow())}),0===g(this).find(".mosaic-grid-row:not(.mosaic-innergrid-row)").length&&g(this).append(g(g.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-empty-row").append(g(g.mosaic.document.createElement("div")).addClass("mosaic-grid-cell col").append(g(g.mosaic.document.createElement("div")).append(g(g.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(g(g.mosaic.document.createElement("div")).addClass("mosaic-divider-dot"))))).mosaicAddMouseMoveEmptyRow())})},g.fn.mosaicGetDataClass=function(){for(var e in g.mosaic.layout.dataClasses)if(g.mosaic.layout.dataClasses.hasOwnProperty(e)&&g(this).hasClass(g.mosaic.layout.dataClasses[e]))return g.mosaic.layout.dataClasses[e];return g.mosaic.layout.dataClasses[0]},g.fn.mosaicGetWidthClass=function(){for(var e in g.mosaic.layout.widthClasses)if(g.mosaic.layout.widthClasses.hasOwnProperty(e)&&g(this).hasClass(g.mosaic.layout.widthClasses[e]))return g.mosaic.layout.widthClasses[e];for(e in g.mosaic.layout.widthClasses)if(g.mosaic.layout.widthClasses.hasOwnProperty(e)&&g(this).hasClass(g.mosaic.layout.widthClasses[e].replace("position","resize")))return g.mosaic.layout.widthClasses[e];return g.mosaic.layout.widthClasses[0]},g.fn.mosaicGetPositionClass=function(){for(var e in g.mosaic.layout.positionClasses)if(g(this).hasClass(g.mosaic.layout.positionClasses[e]))return g.mosaic.layout.positionClasses[e];for(e in g.mosaic.layout.positionClasses)if(g(this).hasClass(g.mosaic.layout.positionClasses[e].replace("position","resize")))return g.mosaic.layout.positionClasses[e];return g.mosaic.layout.positionClasses[0]},g.fn.mosaicGetResizeHandleClassId=function(){for(var e=0;e<g.mosaic.layout.resizeHandleClasses.length;e++)if(g(this).hasClass(g.mosaic.layout.resizeHandleClasses[e]))return e;return 1},g.fn.mosaicAddDrag=function(){return this.each(function(){function s(e){var t=g(".mosaic-helper-tile",g.mosaic.document),a=t.parents("[data-panel]").offset();t.css("top",e.pageY+3-a.top),t.css("left",e.pageX+3-a.left)}var e=g(this),n=function(){var e=g(".mosaic-helper-tile",g.mosaic.document);g(g.mosaic.document).unbind("mousemove",s).unbind("mouseup",n),e.mosaicHandleDragEnd(),e.remove()};return e.each(function(){e.find("div.mosaic-drag-handle").unbind("mousedown").bind("mousedown",function(e){var a=e.pageX,o=e.pageY,i=function(e){var t;1<=Math.max(Math.abs(a-e.pageX),Math.abs(o-e.pageY))&&(g.mosaic.options.panels.addClass("mosaic-panel-dragging"),g(".mosaic-selected-tile",g.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),e=(t=g(e.target).parents(".mosaic-tile")).clone(!0),t.addClass("mosaic-original-tile"),t.parents("[data-panel]").append(e),e.css({width:t.width(),position:"absolute",opacity:.5}).addClass("mosaic-helper-tile"),g(g.mosaic.document).mousemove(s),g(g.mosaic.document).mouseup(n),g(g.mosaic.document).unbind("mousemove",i))};g(g.mosaic.document).bind("mousemove",i),g(g.mosaic.document).bind("mouseup",function(){g(g.mosaic.document).unbind("mousemove",i)})})})})},g.fn.mosaicHandleDragEnd=function(){var e=g(this).parents("[data-panel]");g.mosaic.options.panels.removeClass("mosaic-panel-dragging mosaic-panel-dragging-new");var t=g(".mosaic-selected-divider",g.mosaic.document),a=t.parent(),o="";l.each(["top","bottom","left","right"],function(e){t.hasClass("mosaic-divider-"+e)&&(o=e)}),t.removeClass("mosaic-selected-divider");var i,s=0<g(".mosaic-helper-tile-new",g.mosaic.document).length,n=g(".mosaic-original-tile",g.mosaic.document);0!==t.length&&!a.hasClass("mosaic-helper-tile")||n.addClass("mosaic-drag-cancel"),n.hasClass("mosaic-drag-cancel")?(n.removeClass("mosaic-drag-cancel"),s||n.removeClass("mosaic-original-tile").addClass("mosaic-new-tile")):a.hasClass("mosaic-empty-row")?(a.removeClass("mosaic-empty-row").attr("class",n.parents(".mosaic-grid-row").first().attr("class")).unbind("mousemove"),a.children(".mosaic-grid-cell").children("div").remove(),a.children(".mosaic-grid-cell").append(n.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))):!1===a.hasClass("mosaic-tile")&&!1===a.hasClass("mosaic-innergrid-row")||a.parent().parent().children(".mosaic-grid-cell").length>=e.data("max-columns")&&("left"===o||"right"===o)?s||n.removeClass("mosaic-original-tile").addClass("mosaic-new-tile"):(i=n.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"),e.hasClass("inner-subcolumn")&&(i=g(g.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-innergrid-row").append(g(g.mosaic.document.createElement("div")).addClass("mosaic-grid-cell col").append(g(g.mosaic.document.createElement("div")).append(g(g.mosaic.document.createElement("div")).addClass("mosaic-innergrid-outer-border"))).append(i)).mosaicAddMouseMoveInnergridRow(),l.each(["top","bottom"],function(e){i.append(g(g.mosaic.document.createElement("div")).addClass("mosaic-divider mosaic-divider-"+e).append(g(g.mosaic.document.createElement("div")).addClass("mosaic-divider-dot")))})),"top"===o?a.before(i):"bottom"===o?a.after(i):"left"!==o&&"right"!==o||(1===a.parent().parent().children(".mosaic-grid-cell").length?(0<(e=a.prevAll()).length&&(a.parent().parent().before(g(g.mosaic.document.createElement("div")).addClass("mosaic-grid-row").append(g(g.mosaic.document.createElement("div")).addClass("mosaic-grid-cell col").append(g(e.get().reverse()).clone(!0).mosaicAddDrag()))),e.remove()),0<(e=a.nextAll()).length&&(a.parent().parent().after(g(g.mosaic.document.createElement("div")).addClass("mosaic-grid-row").append(g(g.mosaic.document.createElement("div")).addClass("mosaic-grid-cell col").append(e.clone(!0).mosaicAddDrag()))),e.remove()),a.parent().removeClass(g.mosaic.layout.widthClasses.join(" ")).removeClass(g.mosaic.layout.positionClasses.join(" ")).addClass("col"),console.log("Now inside here left right"),"left"===o?a.parent().before(g(g.mosaic.document.createElement("div")).addClass("mosaic-grid-cell col").append(n.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))):a.parent().after(g(g.mosaic.document.createElement("div")).addClass("mosaic-grid-cell col").append(n.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile")))):("left"===o?a.parent().before(g(g.mosaic.document.createElement("div")).addClass("mosaic-grid-cell").append(n.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))):a.parent().after(g(g.mosaic.document.createElement("div")).addClass("mosaic-grid-cell").append(n.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))),a.parent().parent().mosaicSetColumnSizes()),a.parent().parent().mosaicSetResizeHandles()));a=n.parent().parent();g(".mosaic-original-tile",g.mosaic.document).remove(),g.mosaic.options.panels.find(".mosaic-grid-row:not(:has(.mosaic-tile))").remove(),g.mosaic.options.panels.find(".mosaic-empty-row").remove(),a.mosaicCleanupRow(),g.mosaic.options.panels.mosaicAddEmptyRows();a=g(".mosaic-new-tile",g.mosaic.document);a.removeClass("mosaic-new-tile");a=new c(a),n=n.find(".mosaic-tile-content");0<n.length&&n[0]._preScanHTML&&a.cacheHtml(n[0]._preScanHTML),a.isRichText()||a.scanRegistry(),g('.mosaic-tile:not(".mosaic-helper-tile") .mosaic-tile-content.mosaic-rich-text').each(function(){new c(g(this).parent()).setupWysiwyg()}),a.blur(),s&&a.focus()},g.fn.mosaicSetColumnSizes=function(){return this.each(function(){var s=[],n=g(this).children(".mosaic-grid-cell").length;g(this).children(".mosaic-grid-cell").each(function(e){g(this).removeClass(g.mosaic.layout.widthClasses.join(" ")).removeClass(g.mosaic.layout.positionClasses.join(" "));var t=0,a=Math.floor(12/n),o=12-a*(n-1);console.log("------"),console.log("position",t),console.log("col_size",a),console.log("col_size_last",o),console.log("nr_of_columns",n),console.log("------");for(var i=0;i<n;i++)0<i&&(t+=a),i===n-1&&(a=o),e===i&&(s.push(a),g(this).addClass("col"))}),g(this).data("column_sizes",s)})},g.fn.mosaicSetResizeHandles=function(){return this.each(function(){g(this).children(".mosaic-resize-handle").remove();var e=g(this).children(".mosaic-grid-cell").length;if(1<e&&e<=12){console.log("nr_of_columns > 1 && nr_of_columns <= 12");for(var t=[],a=0,o=0,i=0;i<e;i++){var s=b(g(g(this).children(".mosaic-grid-cell").get(i)).mosaicGetWidthClass());t.push(s),o+=s,0===s&&(a+=1)}var n=0;a&&(n=(12-o)/a);for(var c,l=0,s=0,i=0;i<e;i++)l+=s=t[i]||n,c=Math.round(l/12*1e4)/100,console.log("resize_col_size",l),g(this).append(g(g.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-"+(i+1)+" mosaic-resize-"+l).data("resize_handle_index",i).css({marginLeft:c+"%"}));console.log("$.fn.mosaicSetResizeHandles"),console.log("column_sizes",t),console.log("zero_count",a),console.log("col_size",s)}g(this).children(".mosaic-resize-handle").mousedown(function(){var e=g(this).parent().children(".mosaic-grid-cell"),t=e.length,c=[];if(1<t&&t<=12)for(var a=0;a<t;a++){var o=b(g(e.get(a)).mosaicGetWidthClass());c.push(o)}e.each(function(e){var t=g(this).mosaicGetWidthClass(),a=t.replace("col","mosaic-col"),o=b(t);0==o&&(o="0 (2)");var i="mosaic-resize-0";if(1<c.length&&0<e){for(var s=0,n=0;n<e;n++)s+=c[n];i="mosaic-resize-"+s}g(this).parent().append(g(g.mosaic.document.createElement("div")).addClass("mosaic-resize-placeholder "+t+" "+a+" "+i).append(g(g.mosaic.document.createElement("div")).addClass("mosaic-resize-placeholder-inner-border").append(g(g.mosaic.document.createElement("div")).addClass("info").html(o))))});var i=g(this).mosaicGetResizeHandleClassId();return g(this).parent().append(g(g.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-helper").addClass(g(this).mosaicGetPositionClass().replace("position","resize")).data("row_width",g(this).parent().width()).data("nr_of_columns",t).data("column_sizes",c).data("resize_handle_index",i)),g(this).parents("[data-panel]").addClass("mosaic-panel-resizing"),g(this).parent().addClass("mosaic-row-resizing"),g(".mosaic-selected-tile",g.mosaic.document).children(".mosaic-tile-content").blur(),!1})})},g.fn.mosaicCleanupRow=function(){return this.each(function(){var e=g(this);if(e.children(".mosaic-grid-cell").each(function(){0===g(this).children().length&&(g(this).remove(),e.mosaicSetColumnSizes())}),0===e.find(".mosaic-tile").length){var t=e;if(0<e.nextAll(".mosaic-grid-row").length)e=e.next(".mosaic-grid-row");else{if(!(0<e.prevAll(".mosaic-grid-row").length))return void e.remove();e=e.prev(".mosaic-grid-row")}t.remove()}e.mosaicSetResizeHandles()})},g.fn.mosaicGetDirection=function(e){var t=parseFloat(g(this).width()),a=parseFloat(g(this).height()),o=parseFloat(e.pageX-g(this).offset().left-t/2),e=parseFloat(e.pageY-g(this).offset().top-a/2),t=t/2,a=a/2;return o<0?e<0?o/e<-1*t/(-1*a)?"top":"left":o/e<-1*t/a?"left":"bottom":e<0?o/e<t/(-1*a)?"right":"top":o/e<t/a?"bottom":"right"},g.mosaic.disableEditHtmlSource=function(){g(".mosaic-rich-text-textarea",g.mosaic.document).each(function(){var e=g(this).val();g(this).parent().html(e),new c(g(this).parent()).setupWysiwyg()})},g.mosaic.addAppTile=function(t,a){g.mosaic.overlay.app&&g.mosaic.overlay.app.hide(),g.ajax({type:"GET",url:a,success:function(e){e=g.mosaic.getDomTreeFromHtml(e),g.mosaic.addHeadTags(a,e),g.mosaic.addTile(t,e.find(".temp_body_tag").html(),a)}})},g.mosaic.addAppTileHTML=function(e,t,a){t=g.mosaic.getDomTreeFromHtml(t);g.mosaic.addHeadTags(a,t),g.mosaic.addTile(e,t.find(".temp_body_tag").html(),a)},g.mosaic.editAppTile=function(a){g.mosaic.overlay.close(),window.parent.focus(),g.ajax({type:"GET",url:a,success:function(e){e=g.mosaic.getDomTreeFromHtml(e),g.mosaic.removeHeadTags(a),g.mosaic.addHeadTags(a,e);var t=g(".mosaic-selected-tile .mosaic-tile-content",g.mosaic.document);t.html(e.find(".temp_body_tag").html()),t.attr("data-tileUrl",a.replace(/&/gim,"&amp;"))}})},g.mosaic.addTile=function(e,t,a){g.mosaic.options.panels.addClass("mosaic-panel-dragging mosaic-panel-dragging-new"),g(g.mosaic.options.panels.get(0)).append(g(g.mosaic.document.createElement("div")).addClass("mosaic-grid-row").append(g(g.mosaic.document.createElement("div")).addClass("mosaic-grid-cell col").append(g(g.mosaic.document.createElement("div")).addClass("movable removable mosaic-tile mosaic-"+e+"-tile").append(g(g.mosaic.document.createElement("div")).addClass("mosaic-tile-content").attr("data-tileUrl",a&&a.replace(/&/gim,"&amp;")).html(t)).addClass("mosaic-helper-tile mosaic-helper-tile-new mosaic-original-tile"))));var t=g.mosaic.options.panels.find(".mosaic-helper-tile-new"),o=0;g.mosaic.options.panels.each(function(){g(this).width()>o&&(o=g(this).width())}),t.width()<o/4?t.width(o/4):t.width(t.width());t=new c(t);t.initialize(),t.cacheHtml(),t.scanRegistry()},g.mosaic.getDefaultValue=function(t){var e,a,o,i="IDublinCore-title"===t.name?(o='<h1 class="documentFirstHeading">',"</h1>"):"IDublinCore-description"===t.name?(o='<p class="documentDescription">',"</p>"):(o="<div>","</div>");if("field"!==t.tile_type)return t.default_value;switch(t.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":return o+g("#"+t.id,g.mosaic.document).find("input").attr("value")+i;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":for(var s=g("#"+t.id,g.mosaic.document).find("textarea").val().split("\n"),n="",c=0;c<s.length;c+=1)n+=s[c]+"<br/>";return o+n+i;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":if(e=g("#"+t.id).find("textarea").attr("id"),!(a=tinymce.get(e)))return"";try{return a.getContent()}catch(e){return'<div class="discreet">Placeholder for field:<br/><b>'+t.label+"</b></div>"}break;default:return'<div class="discreet">Placeholder for field:<br/><b>'+t.label+"</b></div>"}},g.mosaic.getPageContent=function(a){var e,o=function(e){var t="";return!1===g(e).hasClass("mosaic-empty-row")&&0<=g(e).find(".mosaic-tile").length&&(i=g(e).attr("class"),t+='      <div class="'+i+'">\n',g(e).children(".mosaic-grid-cell").each(function(){t+='        <div class="'+g(this).attr("class")+'">\n',g(this).children().each(function(){var e;g(this).hasClass("mosaic-tile")?(e=new c(this),t+=e.getHtmlBody(a)):g(this).hasClass("mosaic-innergrid-row")&&(t+=o(this))}),t+="        </div>\n"}),t+="      </div>\n"),t},t="",i="";return g.mosaic.disableEditHtmlSource(),t+="  <body>\n",g("[data-panel]",g.mosaic.document).each(function(){t+='    <div data-panel="'+g(this).data("panel")+'"',t+='         data-max-columns="'+g(this).data("max-columns")+'">\n',g(this).children().each(function(){g(this).hasClass("mosaic-grid-row")&&(t+=o(this))}),t+="    </div>\n"}),t+="  </body>\n",e='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" data-layout="'+g.mosaic.options.layout+'">\n',e+=t,e+="</html>\n"},g.mosaic.saveTileFormData=function(){g("[data-panel]",g.mosaic.document).each(function(){g(this).find(".mosaic-tile").each(function(){new c(this).saveForm()})})},g.mosaic.saveLayoutToForm=function(){g.mosaic.saveTileFormData();var e=g("#form-widgets-ILayoutAware-customContentLayout, [name='form.widgets.ILayoutAware.customContentLayout']");g.mosaic.hasContentLayout?e.val(""):e.val(g.mosaic.getPageContent())};var s=function(e,t){var a=document.createElement("a"),t=void 0===t?"":" ("+t+")";return a.href="javascript:",a.textContent="Reset"+t,g(a).on("click",{el:e},function(e){e.preventDefault(),e.data.el.parent().parent().removeClass("col-1 col-2 col-3 col-4 col-5 col-6 col-7 col-8 col-9 col-10 col-11 col-12").addClass("col"),e.data.el.parent().parent().parent().mosaicSetResizeHandles(),g(e.target).parent().parent().remove()}),a};function v(){for(var e=[],t=0;t<99;)e.push(Math.round(t+=100/12));return e}function y(e){return e?"col-"+e:"col"}function b(e,t){t=t||"col-";for(var a=0;a<12;a++)if(e===t+(a+1))return a+1;return 0}return{Tile:c}}),define("mosaic-url/mosaic.toolbar",["jquery","mosaic-url/mosaic.tile","mosaic-url/mosaic.layout"],function(d,m){"use strict";void 0===d.mosaic&&(d.mosaic={});var u=function(e){return e.replace(/(_|\.|\/)/g,"-").toLowerCase()};function p(e,o){var t;o.menu,o.menu?o.icon?(t=d(document.createElement("label")),e.append(t.addClass("mosaic-icon-menu mosaic-icon-menu-"+u(o.name)+" mosaic-icon").html(o.label).attr("title",o.label).append(d(document.createElement("select")).addClass("mosaic-menu-"+u(o.name)).data("action",o.action).change(function(){d(this).mosaicExecAction()}).each(function(){var e,t,a;for(e in o.items)if(void 0!==o.items[e].items)for(a in d(this).append(d(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+u(o.items[e].value)).attr("label",o.items[e].label)),t=d(this).find(".mosaic-option-group-"+u(o.items[e].value)),o.items[e].items)t.append(d(document.createElement("option")).attr("value",o.items[e].items[a].value).addClass("mosaic-option mosaic-option-"+u(o.items[e].items[a].value)).html(o.items[e].items[a].label));else d(this).append(d(document.createElement("option")).attr("value",o.items[e].value).addClass("mosaic-option mosaic-option-"+u(o.items[e].value)).html(o.items[e].label))})))):(t=d(document.createElement("select")),e.append(t.addClass("mosaic-menu mosaic-menu-"+o.name.replace(/_/g,"-")).data("action",o.action).change(function(){d(this).mosaicExecAction()}).each(function(){for(var e,t,a=0;a<o.items.length;a+=1)if(void 0!==o.items[a].items)for(t in d(this).append(d(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+u(o.items[a].value)).attr("label",o.items[a].label)),e=d(this).find(".mosaic-option-group-"+u(o.items[a].value)),o.items[a].items)e.append(d(document.createElement("option")).attr("value",o.items[a].items[t].value).addClass("mosaic-option mosaic-option-"+u(o.items[a].items[t].value)).html(o.items[a].items[t].label));else d(this).append(d(document.createElement("option")).attr("value",o.items[a].value).addClass("mosaic-option mosaic-option-"+u(o.items[a].value)).html(o.items[a].label))}))):"layout"==u(o.name)?(t=d(document.createElement("div")),e.append(t.addClass("ms-3 d-flex align-items-center me-2 text-secondary mosaic-button mosaic-button-"+u(o.name)+(o.icon?" mosaic-icon":"")).html(o.label))):(t=d(document.createElement("button")),e.append(t.addClass("btn btn-sm btn-secondary mosaic-button mosaic-button-"+u(o.name)+(o.icon?" mosaic-icon":"")).html(o.label).attr("title",o.label).attr("type","button").data("action",o.action).mousedown(function(){d(this).mosaicExecAction()}))),d.mosaic.actionManager.actions[o.name]&&(d.mosaic.actionManager.actions[o.name].visible()||t.hide())}d.fn._mosaicToolbarLayoutEditor=function(e){var t,a,o;if(d(".mosaic-toolbar-secondary-functions",this).removeClass("d-none"),void 0!==d.mosaic.options.formats)for(s=0;s<d.mosaic.options.formats.length;s+=1){for(a=d.mosaic.options.formats[s],e.primary_actions.append(d(document.createElement("fieldset")).addClass("d-flex d-grid gap-2 btn-group mosaic-button-group mosaic-button-group-"+u(a.name))),o=e.primary_actions.children(".mosaic-button-group-"+a.name.replace(/_/g,"-")),t=0;t<a.actions.length;t+=1)a.actions[t].favorite&&p(o,a.actions[t]);0===o.children().length&&o.remove()}if(void 0!==d.mosaic.options.tiles)for(var i=e.secondary_actions.find(".mosaic-menu-insert"),s=0;s<d.mosaic.options.tiles.length;s+=1){for(a=d.mosaic.options.tiles[s],i.append(d(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+u(a.name)).attr("label",a.label)),o=e.secondary_actions.find(".mosaic-option-group-"+u(a.name)),t=0;t<a.tiles.length;t+=1){var n=a.tiles[t];o.append(d(document.createElement("option")).addClass("mosaic-option mosaic-option-"+u(n.name)).attr("value",n.name).html(n.label))}0===o.children().length&&o.remove()}if(void 0!==d.mosaic.options.formats){var c=e.secondary_actions.find(".mosaic-menu-format");for(s=0;s<d.mosaic.options.formats.length;s+=1){for(a=d.mosaic.options.formats[s],c.append(d(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+u(a.name)).attr("label",a.label)),o=e.secondary_actions.find(".mosaic-option-group-"+u(a.name)),t=0;t<a.actions.length;t+=1){var l=a.actions[t];!1===l.favorite&&o.append(d(document.createElement("option")).addClass("mosaic-option mosaic-option-"+u(l.name)).attr("value",l.name).html(l.label).data("action",l.action))}0===o.children().length&&o.remove()}}},d.fn.mosaicToolbar=function(){return this.each(function(){var e,t,a,o,i,s,n=d(this);for(t in n.html(""),n.append(d(document.createElement("div")).addClass("mosaic-inline-toolbar w-100")),(n=n.children(".mosaic-inline-toolbar")).append(d(document.createElement("div")).addClass("mosaic-toolbar-content d-flex justify-content-between")),e={},(s=n.children(".mosaic-toolbar-content")).append(d(document.createElement("div")).addClass("mosaic-toolbar-primary-functions d-flex d-grid gap-2")),e.primary_actions=s.children(".mosaic-toolbar-primary-functions"),s.append(d(document.createElement("div")).addClass("mosaic-toolbar-secondary-functions d-flex d-grid gap-2")),e.secondary_actions=s.children(".mosaic-toolbar-secondary-functions"),e)for(a=0;a<d.mosaic.options[t].length;a+=1)if(void 0===d.mosaic.options[t][a].actions)p(e[t],d.mosaic.options[t][a]);else{o=d.mosaic.options[t][a];var c=u(d.mosaic.options[t][a].name),c=d(document.createElement("div")).addClass("d-flex mosaic-button-group mosaic-button-group-"+c);c.append(p(c,d.extend({},!0,o,{action:o.name.toLowerCase(),name:o.name.toLowerCase()})));var l=d(document.createElement("div")).addClass("btn-container d-flex d-grid gap-2");for(c.append(l),e[t].append(c),i=0;i<o.actions.length;i+=1)p(l,o.actions[i])}n._mosaicToolbarLayoutEditor(e),d.mosaic.hasContentLayout&&d(".mosaic-toolbar-secondary-functions",this).addClass("d-none"),s=function(){var e;parseInt(d(window).scrollTop(),10)>parseInt(n.parent().offset().top,10)?n.hasClass("mosaic-inline-toolbar")&&(e=n.offset().left,n.width(n.width()).css({left:e,"margin-left":"0px"}).removeClass("mosaic-inline-toolbar").addClass("mosaic-external-toolbar").parent().height(n.height())):n.hasClass("mosaic-external-toolbar")&&n.css({width:"",left:"","margin-left":""}).removeClass("mosaic-external-toolbar").addClass("mosaic-inline-toolbar").parent().css("height","")},d(window).bind("scroll",s),s=function(){var a,e,t,o,i;d.mosaic.disableEditHtmlSource(),a=d(this);var s,n=d(".mosaic-selected-tile",d.mosaic.document);for(0<n.length&&(s=new m(n).getType()),e=d.mosaic.options.default_available_actions,t=0;t<d.mosaic.options.tiles.length;t+=1)for(o=d.mosaic.options.tiles[t],i=0;i<o.tiles.length;i+=1)o.tiles[i].name===s&&(e=e.concat(o.tiles[i].available_actions));n.hasClass("removable")||(e=d(e).filter(function(){return"remove"!==this})),a.find(".mosaic-option-group").show(),a.find(".mosaic-button").hide(),a.find(".mosaic-menu-format").find(".mosaic-option").hide().attr("disabled","disabled"),d(a.find(".mosaic-menu-format").find(".mosaic-option").get(0)).show().removeAttr("disabled"),d(e).each(function(e,t){d.mosaic.actionManager.actions[t]&&!d.mosaic.actionManager.actions[t].visible()||(a.find(".mosaic-button-"+t).show(),a.find(".mosaic-icon-menu-"+t).show(),a.find(".select2-container.mosaic-menu-"+t).show(),a.find(".mosaic-option-"+t).show().removeAttr("disabled"))}),d.mosaic.actionManager.actions.layout.visible()&&d(".mosaic-button-layout").show(),a.find(".mosaic-menu-insert").children(".mosaic-option-group-fields").children().each(function(){0===d.mosaic.options.panels.find(".mosaic-"+d(this).attr("value")+"-tile").length?d(this).show().removeAttr("disabled"):d(this).hide().attr("disabled","disabled")}),a.find(".mosaic-option-group").each(function(){0===d(this).children(":enabled").length&&d(this).hide()}),!d.mosaic.hasContentLayout&&d.mosaic.options.canChangeLayout?d(".mosaic-button-savelayout").show():d(".mosaic-button-savelayout").hide()},d(this).bind("selectedtilechange",s),d(this).trigger("selectedtilechange"),d(".mosaic-menu").each(function(){d(this).select2({width:"style",dropdownCssClass:"mosaic-dropdown mosaic-dropdown-"+d(this).data("action"),dropdownAutoWidth:!0,minimumResultsForSearch:99})});var r=(new Date).getTime();d(this).on("selectedtilechange",function(){d.mosaic.overlay.app||d.mosaic.saving||d.mosaic.modal||6e3<(new Date).getTime()-r&&(d.mosaic.queue(function(e){d.mosaic.saveLayoutToForm(),d("#form-widgets-ILayoutAware-customContentLayout, [name='form.widgets.ILayoutAware.customContentLayout']").blur(),e()}),r=(new Date).getTime())})})}}),define("mosaic-url/mosaic.actions",["jquery","mosaic-url/mosaic.tile","mockup-utils","mockup-patterns-modal"],function(r,t,d,m){"use strict";void 0===r.mosaic&&(r.mosaic={}),r.mosaic.actionManager={actions:[],shortcuts:[]},r.mosaic.registerAction=function(e,t){t=r.extend({exec:function(){},shortcut:{ctrl:!1,alt:!1,shift:!1,key:""},visible:function(e){return!0}},t),""!==(r.mosaic.actionManager.actions[e]=t).shortcut.key&&(t.shortcut.charCode=t.shortcut.key.toUpperCase().charCodeAt(0),t.shortcut.action=e,r.mosaic.actionManager.shortcuts.push(t.shortcut))},r.fn.mosaicExecAction=function(){return this.each(function(){""!==r(this).data("action")&&r.mosaic.actionManager.actions[r(this).data("action")].exec(this)})},r.mosaic.fixWebkitSpan=function(){var e=r(".Apple-style-span",r.mosaic.document);e.after(e.html()),e.remove()},r.mosaic.getPrefixedClassName=function(e){return-1<e.indexOf("-")?"mosaic-"+e:"mosaic"+e.charAt(0).toUpperCase()+e.slice(1)},r.mosaic.initActions=function(){r.mosaic.registerAction("tile-toggle-class",{exec:function(){var e;0<arguments.length&&arguments[0].value&&(e=r.mosaic.getPrefixedClassName(arguments[0].value),r(".mosaic-selected-tile",r.mosaic.document).toggleClass(e))}}),r.mosaic.registerAction("tile-remove-format",{exec:function(){for(var e,t,a,o=0;o<r.mosaic.options.formats.length;o++)for(t=r.mosaic.options.formats[o],e=0;e<t.actions.length;e++)"tile"===(a=t.actions[e]).category&&(a=r.mosaic.getPrefixedClassName(a.name),r(".mosaic-selected-tile",r.mosaic.document).removeClass(a))}}),r.mosaic.registerAction("row-toggle-class",{exec:function(){var e;0<arguments.length&&arguments[0].value&&(e=r.mosaic.getPrefixedClassName(arguments[0].value),r(".mosaic-selected-tile",r.mosaic.document).parents(".mosaic-grid-row").first().toggleClass(e))}}),r.mosaic.registerAction("row-toggle-row-cols",{exec:function(){var e,t;0<arguments.length&&arguments[0].value&&("row-cols-2211"==(e=arguments[0].value)?t="row-cols-1 row-cols-sm-1 row-cols-md-2 row-cols-lg-2":"row-cols-3221"==e?t="row-cols-1 row-cols-sm-2 row-cols-md-2 row-cols-lg-3":"row-cols-3321"==e?t="row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-3":"row-cols-4221"==e?t="row-cols-1 row-cols-sm-2 row-cols-md-2 row-cols-lg-4":"row-cols-4421"==e?t="row-cols-1 row-cols-sm-2 row-cols-md-4 row-cols-lg-4":"row-cols-6321"==e&&(t="row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-6"),r(".mosaic-selected-tile",r.mosaic.document).parents(".mosaic-grid-row").first().toggleClass(t))}}),r.mosaic.registerAction("row-remove-format",{exec:function(){for(var e,t,a,o,i=0;i<r.mosaic.options.formats.length;i++)for(t=r.mosaic.options.formats[i],e=0;e<t.actions.length;e++)"row"===(a=t.actions[e]).category&&(o=r.mosaic.getPrefixedClassName(a.name),r(".mosaic-selected-tile",r.mosaic.document).parents(".mosaic-grid-row").first().removeClass(o).removeClass(a.name))}}),r.mosaic.registerAction("tile-align-block",{exec:function(){r(".mosaic-selected-tile",r.mosaic.document).removeClass("mosaic-tile-align-right").removeClass("mosaic-tile-align-left")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"b"}}),r.mosaic.registerAction("tile-align-left",{exec:function(){r(".mosaic-selected-tile",r.mosaic.document).removeClass("mosaic-tile-align-right").addClass("mosaic-tile-align-left")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"l"}}),r.mosaic.registerAction("tile-align-right",{exec:function(){r(".mosaic-selected-tile",r.mosaic.document).removeClass("mosaic-tile-align-left").addClass("mosaic-tile-align-right")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"r"}}),r.mosaic.registerAction("save",{exec:function(){r.mosaic.saving=!0,r(".mosaic-selected-tile",r.mosaic.document).each(function(){new t(this).blur()}),r.mosaic.options.toolbar.trigger("selectedtilechange"),r.mosaic.queue(function(e){r.mosaic.saveLayoutToForm(),r("#form-buttons-save").click(),r.mosaic.saving=!1,e()})},shortcut:{ctrl:!0,alt:!1,shift:!1,key:"s"}}),r.mosaic.registerAction("cancel",{exec:function(){r("#form-buttons-cancel").click()}}),r.mosaic.registerAction("preview",{exec:function(){r("#form-widgets-ILayoutAware-customContentLayout, [name='form.widgets.ILayoutAware.customContentLayout']").focus().blur(),setTimeout(function(){window.open(r.mosaic.options.context_url+"/@@layout_preview","_blank")},1e3)}}),r.mosaic.registerAction("html",{exec:function(){var e,t,a=r(".mosaic-selected-tile",r.mosaic.document).children(".mosaic-tile-content");0===a.find(".mosaic-rich-text-textarea").length&&(e=a.html(),t=a.height(),a.empty(),a.prepend(r(r.mosaic.document.createElement("textarea")).addClass("mosaic-rich-text-textarea").html(r.trim(e)).height(t)))}}),r.mosaic.registerAction("properties",{exec:function(){r.mosaic.overlay.open("all")}}),r.mosaic.registerAction("layout",{exec:function(){r(".mosaic-button-group-layout").toggleClass("active")},visible:function(){return!0}}),r.mosaic.registerAction("customizelayout",{exec:function(){r.mosaic.setSelectedContentLayout(""),r(".mosaic-toolbar-secondary-functions").removeClass("d-none"),r(".mosaic-button-customizelayout").hide(),r(".mosaic-button-savelayout").show(),r(".mosaic-panel .mosaic-tile",r.mosaic.document).each(function(){var e=new t(this);e.makeMovable(),e.$el.mosaicAddDrag()}),r(".mosaic-button-group-layout").removeClass("active")},visible:function(){return r.mosaic.hasContentLayout&&r.mosaic.options.canChangeLayout}}),r.mosaic.registerAction("changelayout",{exec:function(){(r.mosaic.hasContentLayout||confirm("Changing your layout will destroy all existing custom layout settings you have in place. Are you sure you want to continue?"))&&r.mosaic.selectLayout(),r(".mosaic-button-group-layout").removeClass("active")},visible:function(){return 0<r.mosaic.options.available_layouts.length}}),r.mosaic.registerAction("savelayout",{exec:function(){r.mosaic.saveLayout(),r(".mosaic-button-group-layout").removeClass("active")},visible:function(){return!0}}),r.mosaic.registerAction("add-tile",{exec:function(){new m(r(".mosaic-toolbar"),{ajaxUrl:r.mosaic.options.context_url+"/@@add-tile?form.button.Create=Create"}).show()}}),r.mosaic.registerAction("format",{exec:function(e){r(e).find("[value="+r(e).val()+"]").mosaicExecAction(),r(e).select2("val","none")}}),r.mosaic.registerAction("insert",{exec:function(e){var t,a,n,o,i,s,c,l;if("none"===r(e).val())return!1;for(n=r(e).val(),r(".mosaic-selected-tile",r.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),r.mosaic.options.panels.trigger("selectedtilechange"),o=0;o<r.mosaic.options.tiles.length;o+=1)for(a=r.mosaic.options.tiles[o],i=0;i<a.tiles.length;i+=1)a.tiles[i].name===n&&(t=a.tiles[i]);return"textapp"===t.tile_type?(c="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),s=r.mosaic.options.context_url+"/@@"+n+"/"+c,c="<html><body>"+r.mosaic.getDefaultValue(t)+"</body></html>",r.mosaic.addAppTileHTML(n,c,s)):"app"===t.tile_type?(l=!0,d.loading.show(),r.ajax({type:"GET",url:r.mosaic.options.context_url+"/@@add-tile?tiletype="+n+"&form.button.Create=Create",success:function(e,t){var a,o,i,s;d.loading.hide(),o=(a=r(e)).find("#add_tile").attr("action"),i=a.find('[name="_authenticator"]').val(),s=function(e){r.mosaic.overlay.app=new m(r(".mosaic-toolbar"),{html:e,loadLinksWithinModal:!0,buttons:'.formControls > button[type="submit"], .actionButtons > button[type="submit"]'}),r.mosaic.overlay.app.$el.off("after-render"),r.mosaic.overlay.app.on("after-render",function(e){l&&(r(".field.error",r.mosaic.overlay.app.$modal).removeClass("error"),r(".fieldErrorBox,.portalMessage",r.mosaic.overlay.app.$modal).remove(),l=!1),r('input[name*="cancel"]',r.mosaic.overlay.app.$modal).off("click").on("click",function(){r.mosaic.overlay.app.hide(),r.mosaic.overlay.app=null})}),r.mosaic.overlay.app.show(),r.mosaic.overlay.app.$el.off("formActionSuccess"),r.mosaic.overlay.app.on("formActionSuccess",function(e,t,a,o){o=o.getResponseHeader("X-Tile-Url");o&&(r.mosaic.addAppTileHTML(n,t,o),r.mosaic.overlay.app.hide(),r.mosaic.overlay.app=null)})},0<r("form .required",a).filter(function(){var e=r(this).parents(".field").first().find("input, select, textarea").not('[type="hidden"]').last().val();return null===e||0===e.length}).length?s(e):o&&r("form",a).ajaxSubmit({type:"POST",url:o,data:{"buttons.save":"Save",_authenticator:i},success:function(e,t,a){a=a.getResponseHeader("X-Tile-Url");a?r.mosaic.addAppTileHTML(n,e,a):s(e)}})}})):r.mosaic.addTile(n,r.mosaic.getDefaultValue(t)),r(e).select2("val","none"),!0}}),r(document).keypress(function(e){var t="";return r(r.mosaic.actionManager.shortcuts).each(function(){e.ctrlKey!==this.ctrl&&(-1===navigator.userAgent.toLowerCase().indexOf("macintosh")||e.metaKey!==this.ctrl)||e.altKey!==this.alt&&void 0!==e.altKey||e.shiftKey!==this.shift||!e.charCode||String.fromCharCode(e.charCode).toUpperCase().charCodeAt(0)!==this.charCode||(t=this.action)}),""===t||(r.mosaic.actionManager.actions[t].exec(),!1)})}}),define("mosaic-url/mosaic.core",["jquery","pat-logger","underscore","mosaic-url/mosaic.tile","mosaic-url/mosaic.panel","mockup-patterns-modal","mockup-utils","mosaic-url/mosaic.toolbar","mosaic-url/mosaic.layout","mosaic-url/mosaic.actions"],function(s,e,i,t,a,n,c){"use strict";e.getLogger("pat-mosaic");void 0===s.mosaic&&(s.mosaic={}),s.mosaic.loaded=!1,s.mosaic.saving=!1,s.mosaic.selectLayoutTemplate=i.template('<div><h1>Select Layout</h1><div class="mosaic-select-layout"><div class="global-layouts"><ul><% _.each(available_layouts, function(layout){ var screenshot = layout.preview || layout.screenshot;if(!screenshot){screenshot = "++plone++mosaic/img/default-layout-screenshot.png";} %><li><a href="#" data-value="<%- layout.path %>"><p><%- layout.title %></p><p class="mosaic-select-layout-description"><%- layout.description %></p><img src="<%- portal_url %>/<%- screenshot %>"></a></li><% }); %></ul></div><% if(user_layouts.length > 0){ %><div class="user-layouts"><h4>My Layouts</h4><ul><% _.each(user_layouts, function(layout){ var screenshot = layout.preview || layout.screenshot;if(!screenshot){screenshot = "++plone++mosaic/img/default-layout-screenshot.png";} %><li><a href="#" data-value="<%- layout.path %>"><p><%- layout.title %></p><img src="<%- portal_url %>/<%- screenshot %>"></a></li><% }); %></ul></div><% } %><% if(hasCustomLayouts && canChangeLayout) { %><p class="manage-custom-layouts"><a href="#" class="plone-btn plone-btn-default">Manage custom layouts</a></p><% } %></div><div class="buttons">\x3c!-- <button class="plone-btn plone-btn-default">Select</button> --\x3e</div></div>'),s.mosaic.saveLayoutTemplate=i.template('<div><h1>Save Layout</h1><div class="mosaic-save-layout"><p>This process takes a copy of the existing layout and saves it to a new, resuable layout.</p><div class="form-group field"><label for="layoutNameField">Name</label><input type="text" name="name" class="form-control" id="layoutNameField" /></div><% if(canManageLayouts){ %><div class="field form-group"><span class="option"><input id="globalLayout" type="checkbox"><label for="globalLayout"><span class="label">Global</span></label></span><div class="formHelp">Should this layout be available for all users on the site?</div></div><% } %></div><div class="buttons"><button class="plone-btn plone-btn-primary">Save</button></div></div>'),s.mosaic.manageLayoutsTemplate=i.template('<div><h1>Manage custom layouts</h1><div class="mosaic-manage-custom-layouts"><table><thead><tr><th>Name</th><th>Path</th><th>Actions</th></tr></thead><tbody><% _.each(available_layouts.concat(user_layouts), function(layout){ %><% if(layout.path.indexOf("custom/") !== -1){ %><% if(layout.path.split("/").length > 2 || canManageLayouts) { %><tr><td><%- layout.title %></td><td><%- layout.path %></td><td><a href="#" class="btn btn-danger delete-layout" data-layout="<%- layout.path %>">Delete</a></td></tr><% } %><% } %><% }); %></tbody></table></div></div>'),s.mosaic.deleteLayoutTemplate=i.template('<div><h1>Delete layout</h1><div class="mosaic-delete-layout"><% if(existing.length === 0 && !selected){  %><div class="portalMessage warning"><strong>Warning</strong>Are you certain you want to delete this layout? This can not be undone.</div><% } else { %><div class="portalMessage error"><strong>Warning</strong>Are you certain you want to delete this layout? This can not be undone. <% if(existing.length > 0) { %>There are currently <%- existing.length %> items assigned to this layout. <% } %>You need to provide a replacement layout for the existing items in order to delete this for items currently assigned to this.</div><div class="form-group field"><label for="layoutField">Replacement Layout</label><select name="layout" class="form-control" id="layoutField"><% _.each(available_layouts.concat(user_layouts), function(l){ %><% if(l.path !== layout_deleting.path){ %><option value="<%- l.path %>"><%- l.title %></option><% } %><% }); %></select></div><% } %></div><div class="buttons"><button class="plone-btn plone-btn-danger delete">Yes, delete</button><button class="plone-btn plone-btn-default cancel">No</button></div></div>'),s.mosaic.initialized=function(){s.mosaic.loaded||(s.mosaic.loaded=!0,c.loading.hide())},s.mosaic.init=function(e){var t;e=s.extend({url:window.document.location.href,type:"",ignore_context:!1},e),s.mosaic.document=window.document,s.mosaic.initActions(),(t=e.url.match(/^([\w#!:.?+=&%@!\-\/]+)\/edit$/))&&(e.url=t[1]),(t=e.url.match(/^([\w#:.?=%@!\-\/]+)\/\+\+add\+\+([\w#!:.?+=&%@!\-\/]+)$/))&&(e.url=t[1],e.type=t[2],e.ignore_context=!0),s.mosaic.options=e.data,s.mosaic.options.url=e.url,s.mosaic.options.ignore_context=e.ignore_context,s.mosaic.options.tileheadelements=[],s.mosaic.hasContentLayout=!0;e=s.mosaic.getSelectedContentLayout();e?s.mosaic.applyLayout(e):(e=s(s.mosaic.options.customContentLayout_field_selector).val())?("no-layout"===(e=s.mosaic.getDomTreeFromHtml(e)).attr("id")?s.mosaic.selectLayout(!0):(s("body").addClass("mosaic-layout-customized"),s.mosaic.hasContentLayout=!1,s.mosaic._init(e)),0<(e=s(".mosaic-helper-tile-new")).length&&e.parents(".mosaic-grid-row").remove()):s.mosaic.selectLayout(!0)},s.mosaic.getSelectedContentLayout=function(){return s(s.mosaic.options.contentLayout_field_selector).val()},s.mosaic.setSelectedContentLayout=function(e){return e?(s.mosaic.hasContentLayout=!0,s(".mosaic-toolbar-secondary-functions",s.mosaic.document).addClass("d-none"),s("body").removeClass("mosaic-layout-customized")):(s("body").addClass("mosaic-layout-customized"),s.mosaic.hasContentLayout=!1),s(s.mosaic.options.contentLayout_field_selector).attr("value",e)},s.mosaic._initPanels=function(e){s.mosaic.options.layout=e.attr("data-layout"),s("[data-panel] [data-panel]",s.mosaic.document).removeAttr("data-panel"),e.find("[data-panel]").each(function(){new a(this).initialize(e)}),s("[data-panel]",s.mosaic.document).each(function(){new a(this).prefill()}),s.mosaic.options.panels=s(".mosaic-panel",s.mosaic.document),s.mosaic.options.panels.find("[data-tile]").each(function(){t.validTile(this)&&new t(s(this).parent()).initializeContent()})},s.mosaic._init=function(e){s.mosaic._initPanels(e),s(".mosaic-original-content",s.mosaic.document).mosaicOverlay(),s("body").prepend(s(document.createElement("div")).addClass("mosaic-toolbar bg-light position-fixed top-0 start-0 end-0 p-2 border-bottom shadow-sm")),s.mosaic.options.toolbar=s(".mosaic-toolbar"),s.mosaic.options.toolbar.mosaicToolbar(),s.mosaic.options.panels.mosaicLayout(),s("*",s.mosaic.document).each(function(){var e=s(this);"block"!==e.css("display")&&"flex"!==e.css("display")||e.hasClass("mosaic-panel")||e.hasClass("mosaic-toolbar")||e.hasClass("mosaic-notifications")||e.hasClass("mosaic-modal-wrapper")||"edit-zone"===e.attr("id")||0===e.parents(".mosaic-panel, .mosaic-toolbar").length&&0===e.find(".mosaic-panel, .mosaic-toolbar").length&&0!==e.parent().find(".mosaic-panel, .mosaic-toolbar").length&&e.addClass("mosaic-blur")}),s(".pat-toolbar").hide();var t=s("body");t.addClass("mosaic-enabled"),t[0].className.split(" ").forEach(function(e){-1!==e.indexOf("plone-toolbar")&&t.removeClass(e)}),s.mosaic.initialized()},s.mosaic.applyLayout=function(t,e){void 0===e&&(e=function(){}),c.loading.show(),s.ajax({url:s("body").attr("data-portal-url")+"/"+t,cache:!1}).done(function(e){e=s.mosaic.getDomTreeFromHtml(e);s.mosaic.setSelectedContentLayout(t),s.mosaic.loaded?(s.mosaic._initPanels(e),s.mosaic.options.panels.mosaicLayout()):s.mosaic._init(e)}).fail(function(e,t,a){"Not Found"===a?window.alert("Specified layout can not be found. Loading default layout."):window.alert("Error loading layout specified for this content. Falling back to basic layout."),s.mosaic.applyLayout("++contentlayout++default/basic.html")}).always(function(){c.loading.hide()})};function l(){return 0<s.mosaic.options.user_layouts.length||0<i.filter(s.mosaic.options.available_layouts,function(e){return-1!==e.path.indexOf("custom/")}).length}s.mosaic._deleteLayout=function(a,e,o){var t=s("<div/>").appendTo("body"),i=new n(t,{html:s.mosaic.deleteLayoutTemplate(s.extend({},!0,{existing:e,layout_deleting:a,selected:s.mosaic.getSelectedContentLayout()==="++contentlayout++"+a.path},s.mosaic.options)),content:null,buttons:".plone-btn"});i.on("shown",function(){s("button.delete:visible",i.$modal).off("click").on("click",function(e){e.preventDefault(),c.loading.show();var t=s("#layoutField",i.$modal).val();s.ajax({url:s("body").attr("data-base-url")+"/@@manage-layouts-from-editor",data:{action:"deletelayout",layout:a.path,replacement:t,_authenticator:c.getAuthenticator()}}).done(function(e){i.hide(),o(e),t&&s.mosaic.getSelectedContentLayout()==="++contentlayout++"+a.path&&s.mosaic.applyLayout("++contentlayout++"+t)}).fail(function(){window.alert("Error deleting layout")}).always(function(){c.loading.hide()})}),s("button.cancel:visible",i.$modal).off("click").on("click",function(e){e.preventDefault(),i.hide()})}),i.show()},s.mosaic.deleteLayout=function(t,a){c.loading.show(),s.ajax({url:s("body").attr("data-base-url")+"/@@manage-layouts-from-editor",data:{action:"existing",layout:t.path}}).done(function(e){s.mosaic._deleteLayout(t,e.data,a)}).fail(function(){window.alert("Error loading data for existing assignments")}).always(function(){c.loading.hide()})},s.mosaic.manageCustomLayouts=function(){var e=s("<div/>").appendTo("body"),a=new n(e,{html:s.mosaic.manageLayoutsTemplate(s.extend({},!0,{},s.mosaic.options)),content:null,buttons:".plone-btn"});a.on("shown",function(){s(".delete-layout",a.$modal).off("click").on("click",function(e){e.preventDefault();var t=s(this).attr("data-layout");i.each(s.mosaic.options.available_layouts.concat(s.mosaic.options.user_layouts),function(e){if(e.path===t)return s.mosaic.deleteLayout(e,function(e){s.mosaic.options.available_layouts=e.available_layouts,s.mosaic.options.user_layouts=e.user_layouts,a.hide(),s.mosaic.manageCustomLayouts()})})})}),a.show()},s.mosaic.selectLayout=function(e){var t,o;void 0!==e&&e&&1===s.mosaic.options.available_layouts.length?(t="++contentlayout++"+(t=s.mosaic.options.available_layouts[0]).directory+"/"+t.file,s.mosaic.applyLayout(t)):0!==s.mosaic.options.available_layouts.length?(t=s("<div/>").appendTo("body"),(o=new n(t,{html:s.mosaic.selectLayoutTemplate(s.extend({},!0,{hasCustomLayouts:l(),portal_url:s("body").attr("data-portal-url")},s.mosaic.options)),content:null,buttons:".plone-btn"})).on("shown",function(){s(".manage-custom-layouts a",o.$modal).off("click").on("click",function(e){e.preventDefault(),o.hide(),s.mosaic.manageCustomLayouts()}),s("li a",o.$modal).off("click").on("click",function(e){var t;e.preventDefault();var a=s(this).attr("data-value");i.each(s.mosaic.options.available_layouts.concat(s.mosaic.options.user_layouts),function(e){e.path===a&&(t=e)});e="++contentlayout++"+t.path;o.hide(),s.mosaic.applyLayout(e)})}),o.show()):s.mosaic.applyLayout("++contentlayout++default/basic.html")},s.mosaic.saveLayout=function(e){var t=s("<div/>").appendTo("body"),o=new n(t,{html:s.mosaic.saveLayoutTemplate(s.extend({},!0,{hasCustomLayouts:l()},s.mosaic.options)),content:null,buttons:".plone-btn"});o.on("shown",function(){s(".plone-btn:visible",o.$modal).off("click").on("click",function(e){var t,a=s("#layoutNameField",o.$modal).val();a&&(c.loading.show(),e.preventDefault(),t="false",0<(e=s("#globalLayout",o.$modal)).length&&e[0].checked&&(t="true"),s.ajax({url:s("body").attr("data-base-url")+"/@@manage-layouts-from-editor",method:"POST",data:{action:"save",_authenticator:c.getAuthenticator(),global:t,name:a,layout:s.mosaic.getPageContent(!0)}}).done(function(e){e.success&&(s.mosaic.options.available_layouts=e.available_layouts,s.mosaic.options.user_layouts=e.user_layouts,s.mosaic.applyLayout(e.layout))}).fail(function(){window.alert("Error saving layout")}).always(function(){c.loading.hide(),o.hide()}))})}),o.show()},s.mosaic.getDomTreeFromHtml=function(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<!DOCTYPE[\w\s\- .\/\":]+>/,"")).replace(/<html>/,'<div class="temp_html_tag">')).replace(/<\/html>/,"</div>")).replace(/<html\s/,'<div class="temp_html_tag" ')).replace(/<\/html\s/,"</div ")).replace(/<head>/,'<div class="temp_head_tag">')).replace(/<\/head>/,"</div>")).replace(/<head\s/,'<div class="temp_head_tag" ')).replace(/<\/head\s/,"</div ")).replace(/<body>/,'<div class="temp_body_tag">')).replace(/<\/body>/,"</div>")).replace(/<body\s/,'<div class="temp_body_tag" ')).replace(/<\/body\s/,"</div "),s(s(e)[0])},s.mosaic.removeHeadTags=function(e){if(e&&"undefined"!==e){var t,a,o=(e=(e=e.split("?")[0]).split("@@"))[1].split("/");if(e=e[0]+"@@delete-tile?type="+o[0]+"&id="+o[1]+"&confirm=true",o=o[0].replace(/\./g,"-")+"-"+o[1],t=s.mosaic.options.tileheadelements[o])for(a=0;a<t.length;a+=1)s(t[a],s.mosaic.document).remove();s.mosaic.options.tileheadelements[o]=[]}},s.mosaic.addHeadTags=function(e,t){var e=(e=(e=e.split("?")[0]).split("@@"))[1].split("/"),a=e[0].replace(/\./g,"-")+"-"+e[1];s.mosaic.options.tileheadelements[a]=[],t.find(".temp_head_tag").children().each(function(){s.mosaic.options.tileheadelements[a].push(this),s("head",s.mosaic.document).append(this)})},s.mosaic.queue=function(e,t){void 0===t&&(t=e,e="fx"),s(window).queue(e,t)}}),define("mosaic-url/mosaic.editor",["jquery"],function(e){"use strict";void 0===e.mosaic&&(e.mosaic={}),e.mosaic.editor={},e.mosaic.execCommand=function(e,t,a){tinymce.activeEditor&&tinymce.activeEditor.execCommand(e,t,a)},e.mosaic.editor.applyFormat=function(e){tinymce.activeEditor&&tinyMCE.activeEditor.formatter.apply(e)},e.mosaic.editor.registerFormat=function(e,t){tinymce.activeEditor&&tinymce.activeEditor.formatter.register(e,t)}}),define("mosaic-url/mosaic.overlay",["jquery"],function(c){"use strict";void 0===c.mosaic&&(c.mosaic={}),c.mosaic.overlay={},c.fn.mosaicOverlay=function(){return void 0===c.mosaic.overlay_hide_fields&&(c.mosaic.overlay_hide_fields=!0),this.each(function(){var e=c(this),t=c("form",e),a=c("h1",e),o=c('<div class="plone-modal-wrapper mosaic-overlay"><div class="mosaic-modal" style="position: absolute; padding: 20px;"><div class="plone-modal-dialog"><div class="plone-modal-content"><div class="plone-modal-header"><a class="plone-modal-close">×</a></div><div class="plone-modal-body"></div><div class="plone-modal-footer"><div class="pattern-modal-buttons"></div></div></div></div></div></div>');c(".pat-tinymce",t).each(function(){if(c(this).data("pattern-tinymce"))try{c(this).data("pattern-tinymce").destroy()}catch(e){}}),c(".plone-modal-header",o).append("<h2>"+a.text()+"</h2>"),c(".plone-modal-body",o).append(t),c(document.body,c.mosaic.document).append(o),c(".pat-tinymce",t).each(function(){if(c(this).data("pattern-tinymce"))try{c(this).data("pattern-tinymce").init()}catch(e){}});try{c(".pat-textareamimetypeselector").change()}catch(e){}e.hide(),c(document.body,c.mosaic.document).prepend(c(document.createElement("div")).addClass("mosaic-overlay-blocker"))})},c.mosaic.overlay.open=function(e,t){var a,o,i,s;if(c(".mosaic-overlay").show().addClass("active"),c(".mosaic-overlay-blocker").show(),c("body").addClass("plone-modal-open"),a=c(".mosaic-overlay").find("form"),0===c(".mosaic-overlay-ok-button").length&&(c(".mosaic-overlay .formControls").children("input").hide(),c(".mosaic-overlay .pattern-modal-buttons").append(c(document.createElement("input")).attr({type:"button",value:"Done"}).addClass("mosaic-overlay-ok-button plone-btn plone-btn-primary").click(function(){c.mosaic.overlay.close()})),c(".mosaic-overlay .plone-modal-close").off("click").on("click",function(e){e.preventDefault(),c.mosaic.overlay.close()}),c(".mosaic-overlay .plone-modal-header h2").html("Properties")),"all"===e&&c.mosaic.overlay_hide_fields){for((n=a.find("nav")).removeClass("mosaic-hidden"),a.find("fieldset").children().removeClass("mosaic-hidden"),a.find("fieldset").removeClass("active"),n.find("a").removeClass("active"),a.find(c.mosaic.options.customContentLayout_selector).addClass("mosaic-hidden"),a.find(c.mosaic.options.contentLayout_selector).addClass("mosaic-hidden"),0<c(".mosaic-IDublinCore-title-tile").length?a.find("#formfield-form-widgets-IDublinCore-title").addClass("mosaic-hidden"):a.find("#formfield-form-widgets-IDublinCore-title").removeClass("mosaic-hidden"),0<c(".mosaic-IDublinCore-description-tile").length?a.find("#formfield-form-widgets-IDublinCore-description").addClass("mosaic-hidden"):a.find("#formfield-form-widgets-IDublinCore-description").removeClass("mosaic-hidden"),i=0;i<c.mosaic.options.tiles.length;i+=1)"fields"===c.mosaic.options.tiles[i].name&&(o=c.mosaic.options.tiles[i]);for(i=0;i<o.tiles.length;i+=1)s=o.tiles[i],0!==c.mosaic.options.panels.find(".mosaic-"+s.name+"-tile").length&&c(c.mosaic.document.getElementById(s.id)).addClass("mosaic-hidden");a.find("fieldset").each(function(){0===c(this).children("div:not(.mosaic-hidden)").length&&c("a[href=#fieldsetlegend-"+c(this).attr("id").split("-")[1]+"]").addClass("mosaic-hidden")}),(n=n.children(":not(.mosaic-hidden)")).eq(0).addClass("active");var n=a.find("#fieldset-"+n.eq(0).attr("href").split("-")[1]);(n=0===n.length?a.find("fieldset:not(.mosaic-hidden)").eq(0):n).addClass("active")}else"field"===e&&(t=(e=c("#"+t.id)).parents("fieldset"),a.find("fieldset").removeClass("active"),t.addClass("active"),t.children().addClass("mosaic-hidden"),e.removeClass("mosaic-hidden"),a.find("nav").addClass("mosaic-hidden"))},c.mosaic.overlay.close=function(){c(".mosaic-overlay").hide().removeClass("active"),c(".mosaic-overlay-blocker").hide(),c("body").removeClass("plone-modal-open")}}),window.DEBUG=!0,require(["jquery","pat-base","mosaic-url/mosaic.core","mosaic-url/mosaic.layout","mosaic-url/mosaic.toolbar","mosaic-url/mosaic.actions","mosaic-url/mosaic.editor","mosaic-url/mosaic.overlay"],function(e,t){"use strict";return t.extend({name:"layout",trigger:".pat-layout",parser:"mockup",defaults:{attribute:"class"},init:function(){this.options.data.$el=this.$el,e.mosaic.init({data:this.options.data})}})}),define("/Volumes/WORKSPACE2/kinderdorf_plone5/srcaddons/plone.app.mosaic/src/plone/app/mosaic/browser/static/js/mosaic.pattern.js",function(){});
//# sourceMappingURL=plone-mosaic.js.map