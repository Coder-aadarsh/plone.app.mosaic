"use strict";(self.webpackChunkplone_mosaic=self.webpackChunkplone_mosaic||[]).push([[27700],{27700:function(e,t,o){o.r(t);var a=o(65311),n=o.n(a),i=o(89867),r=o(83364),c=o(89799),s=o(84109);o(41973);function l(e,t,o,a,n,i,r){try{var c=e[i](r),s=c.value}catch(e){return void o(e)}c.done?t(s):Promise.resolve(s).then(a,n)}function u(e,t){for(var o=0;o<t.length;o++){var a=t[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var f=i.Z.getLogger("pat-mosaic/actions"),m=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mosaic=t,this.actions=[],this.shortcuts=[]}var t,o,a,i,m;return t=e,o=[{key:"registerAction",value:function(e,t){t=n().extend({exec:function(){},shortcut:{ctrl:!1,alt:!1,shift:!1,key:""},visible:function(e){return!0}},t),this.actions[e]=t,""!==t.shortcut.key&&(t.shortcut.charCode=t.shortcut.key.toUpperCase().charCodeAt(0),t.shortcut.action=e,this.shortcuts.push(t.shortcut))}},{key:"execAction",value:function(e,t){var o=this;if(e in o.actions)return o.actions[e].exec(t);f.error("Action ".concat(e," not in ").concat(o.actions))}},{key:"getPrefixedClassName",value:function(e){return e.indexOf("-")>-1?"mosaic-"+e:"mosaic"+e.charAt(0).toUpperCase()+e.slice(1)}},{key:"initActions",value:(i=regeneratorRuntime.mark((function e(){var t,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=(t=this).mosaic,t.registerAction("tile-toggle-class",{exec:function(){var e;arguments.length>0&&arguments[0].value&&(e=t.getPrefixedClassName(arguments[0].value),n()(".mosaic-selected-tile",o.document).toggleClass(e))}}),t.registerAction("tile-remove-format",{exec:function(){var e,a,i,r,c;for(e=0;e<o.options.formats.length;e++)for(i=o.options.formats[e],a=0;a<i.actions.length;a++)"tile"===(r=i.actions[a]).category&&(c=t.getPrefixedClassName(r.name),n()(".mosaic-selected-tile",o.document).removeClass(c))}}),t.registerAction("row-toggle-class",{exec:function(){var e;arguments.length>0&&arguments[0].value&&(e=t.getPrefixedClassName(arguments[0].value),n()(".mosaic-selected-tile",o.document).parents(".mosaic-grid-row").first().toggleClass(e))}}),t.registerAction("row-remove-format",{exec:function(){var e,a,i,r,c;for(e=0;e<o.options.formats.length;e++)for(i=o.options.formats[e],a=0;a<i.actions.length;a++)"row"===(r=i.actions[a]).category&&(c=t.getPrefixedClassName(r.name),n()(".mosaic-selected-tile",o.document).parents(".mosaic-grid-row").first().removeClass(c).removeClass(r.name))}}),t.registerAction("tile-align-block",{exec:function(){n()(".mosaic-selected-tile",o.document).removeClass("mosaic-tile-align-right").removeClass("mosaic-tile-align-left")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"b"}}),t.registerAction("tile-align-left",{exec:function(){n()(".mosaic-selected-tile",o.document).removeClass("mosaic-tile-align-right").addClass("mosaic-tile-align-left")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"l"}}),t.registerAction("tile-align-right",{exec:function(){n()(".mosaic-selected-tile",o.document).removeClass("mosaic-tile-align-left").addClass("mosaic-tile-align-right")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"r"}}),t.registerAction("save",{exec:function(){o.saving=!0,t.blurSelectedTile(),o.toolbar.SelectedTileChange(),o.queue((function(e){o.layoutManager.saveLayoutToForm(),n()("#form-buttons-save").trigger("click"),o.saving=!1,e()}))},shortcut:{ctrl:!0,alt:!1,shift:!1,key:"s"}}),t.registerAction("cancel",{exec:function(){n()("#form-buttons-cancel").trigger("click")}}),t.registerAction("preview",{exec:function(){n()("#form-widgets-ILayoutAware-customContentLayout, [name='form.widgets.ILayoutAware.customContentLayout']").trigger("focus").trigger("blur"),setTimeout((function(){window.open(o.options.context_url+"/@@layout_preview","_blank")}),1e3)}}),t.registerAction("html",{exec:function(){var e,t,a;0===(e=n()(".mosaic-selected-tile",o.document).children(".mosaic-tile-content")).find(".mosaic-rich-text-textarea").length&&(t=e.html(),a=e.height(),e.empty(),e.prepend(n()(o.document.createElement("textarea")).addClass("mosaic-rich-text-textarea").html(n().trim(t)).height(a)))}}),t.registerAction("properties",{exec:function(){o.overlay.open("all")}}),t.registerAction("layout",{exec:function(){n()(".mosaic-button-group-layout").toggleClass("active")},visible:function(){return!0}}),t.registerAction("customizelayout",{exec:function(){o.setSelectedContentLayout(""),n()(".mosaic-toolbar-secondary-functions").removeClass("d-none"),n()(".mosaic-button-customizelayout").hide(),n()(".mosaic-button-savelayout").show(),n()(".mosaic-panel .mosaic-tile",o.document).each((function(){var e=new r.default(o,this);e.makeMovable(),e.$el.mosaicAddDrag()})),n()(".mosaic-button-group-layout").removeClass("active")},visible:function(){return o.options.canChangeLayout}}),t.registerAction("changelayout",{exec:function(){var e=o.hasContentLayout;e||(e=confirm("Changing your layout will destroy all existing custom layout settings you have in place. Are you sure you want to continue?")),e&&o.selectLayout(),n()(".mosaic-button-group-layout").removeClass("active")},visible:function(){return o.options.available_layouts.length>0}}),t.registerAction("savelayout",{exec:function(){o.saveLayout(),n()(".mosaic-button-group-layout").removeClass("active")},visible:function(){return!0}}),t.registerAction("add-tile",{exec:function(){new c.Z(n()(".mosaic-toolbar"),{ajaxUrl:o.options.context_url+"/@@add-tile?form.button.Create=Create"}).show()}}),t.registerAction("format",{exec:function(e){t.execAction(n()(e).val()),n()(e).select2("val","none")}}),t.registerAction("insert",{exec:function(e){var a,i,r,l,u;if("none"===n()(e).val())return!1;for(r=n()(e).val(),t.blurSelectedTile(),o.toolbar.SelectedTileChange(),l=0;l<o.options.tiles.length;l+=1)for(i=o.options.tiles[l],u=0;u<i.tiles.length;u+=1)i.tiles[u].name===r&&(a=i.tiles[u]);if("textapp"===a.tile_type){var f="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),m=o.options.context_url+"/@@"+r+"/"+f,g="<html><body>"+o.layoutManager.getDefaultValue(a)+"</body></html>";o.layoutManager.addAppTileHTML(r,g,m)}else if("app"===a.tile_type){var d=!0;s.Z.loading.show(),n().ajax({type:"GET",url:o.options.context_url+"/@@add-tile?tiletype="+r+"&form.button.Create=Create",success:function(e,t){var a,i,l,u;s.Z.loading.hide(),i=(a=n()(e)).find("#add_tile").attr("action"),l=a.find('[name="_authenticator"]').val(),u=function(e){o.overlay.app=new c.Z(n()(".mosaic-toolbar"),{html:e,loadLinksWithinModal:!0,buttons:'.formControls > button[type="submit"], .actionButtons > button[type="submit"]'}),o.overlay.app.$el.off("after-render"),o.overlay.app.on("after-render",(function(e){d&&(n()(".field.error",o.overlay.app.$modal).removeClass("error"),n()(".fieldErrorBox,.portalMessage",o.overlay.app.$modal).remove(),d=!1),n()('input[name*="cancel"]',o.overlay.app.$modal).off("click").on("click",(function(){o.overlay.app.hide(),o.overlay.app=null}))})),o.overlay.app.show(),o.overlay.app.$el.off("formActionSuccess"),o.overlay.app.on("formActionSuccess",(function(e,t,a,n){var i=n.getResponseHeader("X-Tile-Url");i&&(o.layoutManager.addAppTileHTML(r,t,i),o.overlay.app.hide(),o.overlay.app=null)}))},n()("form .required",a).filter((function(){var e=n()(this).parents(".field").first().find("input, select, textarea").not('[type="hidden"]').last().val();return null===e||0===e.length})).length>0?u(e):i&&n()("form",a).ajaxSubmit({type:"POST",url:i,data:{"buttons.save":"Save",_authenticator:l},success:function(e,t,a){var n=a.getResponseHeader("X-Tile-Url");n?o.layoutManager.addAppTileHTML(r,e,n):u(e)}})}})}else o.layoutManager.addTile(r,o.layoutManager.getDefaultValue(a));return n()(e).select2("val","none"),!0}}),n()(document).on("keypress",(function(e){var t="";return n()(o.actionManager.shortcuts).each((function(){e.ctrlKey!==this.ctrl&&(-1===navigator.userAgent.toLowerCase().indexOf("macintosh")||e.metaKey!==this.ctrl)||e.altKey!==this.alt&&void 0!==e.altKey||e.shiftKey!==this.shift||!e.charCode||String.fromCharCode(e.charCode).toUpperCase().charCodeAt(0)!==this.charCode||(t=this.action)})),""===t||(o.actionManager.actions[t].exec(),!1)}));case 22:case"end":return e.stop()}}),e,this)})),m=function(){var e=this,t=arguments;return new Promise((function(o,a){var n=i.apply(e,t);function r(e){l(n,o,a,r,c,"next",e)}function c(e){l(n,o,a,r,c,"throw",e)}r(void 0)}))},function(){return m.apply(this,arguments)})},{key:"blurSelectedTile",value:function(){var e=this;n()(".mosaic-selected-tile",e.mosaic.document).each((function(){new r.default(e.mosaic,this).blur()}))}}],o&&u(t.prototype,o),a&&u(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.default=m}}]);
//# sourceMappingURL=27700.04ab0411a3dbdcffa7f0.min.js.map