"use strict";(self.webpackChunkplone_mosaic=self.webpackChunkplone_mosaic||[]).push([[83364,41973],{47874:function(e,t,i){var a=i(90365),n=null;t.Z=function(e,t){if(null===n){var i=new a.Z;i.loadCatalog("widgets"),n=i.MessageFactory("widgets")}return n(e,t)}},41973:function(e,t,i){i.r(t),i.d(t,{default:function(){return l}});var a=i(65311),n=i.n(a);function o(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var l=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,this.panels=i}var t,i,a;return t=e,(i=[{key:"initialize",value:function(){var e=n()(".mosaic-original-content"),t=n()("form",e),i=n()("h1",e),a=n()('<div class="plone-modal-wrapper mosaic-overlay"><div class="mosaic-modal" style="position: absolute; padding: 20px;"><div class="plone-modal-dialog"><div class="plone-modal-content"><div class="plone-modal-header"><a class="plone-modal-close">Ã—</a></div><div class="plone-modal-body"></div><div class="plone-modal-footer"><div class="pattern-modal-buttons"></div></div></div></div></div></div>');n()(".pat-tinymce",t).each((function(){if(n()(this).data("pattern-tinymce"))try{n()(this).data("pattern-tinymce").destroy()}catch(e){}})),n()(".plone-modal-header",a).append("<h2>"+i.text()+"</h2>"),n()(".plone-modal-body",a).append(t),n()(document.body).append(a),this.$overlay=a,n()(".pat-tinymce",t).each((function(){if(n()(this).data("pattern-tinymce"))try{n()(this).data("pattern-tinymce").init()}catch(e){}}));try{n()(".pat-textareamimetypeselector").trigger("change")}catch(e){}e.hide(),n()(document.body).prepend(n()(document.createElement("div")).addClass("mosaic-overlay-blocker"))}},{key:"open",value:function(e,t){var i,a,o,l,s,r,c,d,m=this;if(m.$overlay.show().addClass("active"),n()(".mosaic-overlay-blocker").show(),n()("body").addClass("plone-modal-open"),i=m.$overlay.find("form"),0===n()(".mosaic-overlay-ok-button").length&&(n()(".mosaic-overlay .formControls").children("input").hide(),n()(".mosaic-overlay .pattern-modal-buttons").append(n()(document.createElement("input")).attr({type:"button",value:"Done"}).addClass("mosaic-overlay-ok-button plone-btn plone-btn-primary").on("click",(function(){m.close()}))),n()(".mosaic-overlay .plone-modal-close").off("click").on("click",(function(e){e.preventDefault(),m.close()})),n()(".mosaic-overlay .plone-modal-header h2").html("Properties")),"all"===e&&m.options.overlay_hide_fields){for((a=i.find("nav")).removeClass("mosaic-hidden"),i.find("fieldset").children().removeClass("mosaic-hidden"),i.find("fieldset").removeClass("active"),a.find("a").removeClass("active"),i.find(m.options.customContentLayout_selector).addClass("mosaic-hidden"),i.find(m.options.contentLayout_selector).addClass("mosaic-hidden"),n()(".mosaic-IDublinCore-title-tile").length>0?i.find("#formfield-form-widgets-IDublinCore-title").addClass("mosaic-hidden"):i.find("#formfield-form-widgets-IDublinCore-title").removeClass("mosaic-hidden"),n()(".mosaic-IDublinCore-description-tile").length>0?i.find("#formfield-form-widgets-IDublinCore-description").addClass("mosaic-hidden"):i.find("#formfield-form-widgets-IDublinCore-description").removeClass("mosaic-hidden"),l=0;l<m.options.tiles.length;l+=1)"fields"===m.options.tiles[l].name&&(o=m.options.tiles[l]);for(l=0;l<o.tiles.length;l+=1)r=o.tiles[l],0!==m.panels.find(".mosaic-"+r.name+"-tile").length&&n()("#"+r.id).addClass("mosaic-hidden");i.find("fieldset").each((function(){0===n()(this).children("div:not(.mosaic-hidden)").length&&n()("a[href=#fieldsetlegend-"+n()(this).attr("id").split("-")[1]+"]").addClass("mosaic-hidden")})),(s=a.children(":not(.mosaic-hidden)")).eq(0).addClass("active");var h=i.find("#fieldset-"+s.eq(0).attr("href").split("-")[1]);0===h.length&&(h=i.find("fieldset:not(.mosaic-hidden)").eq(0)),h.addClass("active")}else"field"===e&&(d=(c=n()("#"+t.id)).parents("fieldset"),i.find("fieldset").removeClass("active"),d.addClass("active"),d.children().addClass("mosaic-hidden"),c.removeClass("mosaic-hidden"),i.find("nav").addClass("mosaic-hidden"))}},{key:"close",value:function(){this.$overlay.hide().removeClass("active"),n()(".mosaic-overlay-blocker").hide(),n()("body").removeClass("plone-modal-open")}}])&&o(t.prototype,i),a&&o(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}()},83364:function(e,t,i){i.r(t),i.d(t,{default:function(){return $}});i(35666);var a=i(65311),n=i.n(a),o=i(98860),l=i(84109),s=i(89867),r=i(47575),c=i.n(r),d=i(39191),m=(i(90365),i(47874));function h(e,t,i,a,n,o,l){try{var s=e[o](l),r=s.value}catch(e){return void i(e)}s.done?t(r):Promise.resolve(r).then(a,n)}var p,f,u=d.Z.extend({name:"tinymce",trigger:".pat-tinymce",parser:"mockup",defaults:{upload:{uploadMultiple:!1,maxFiles:1,showTitle:!1},relatedItems:{attributes:["UID","Title","portal_type","path","getURL","getIcon","is_folderish","review_state"],batchSize:20,basePath:"/",vocabularyUrl:null,width:500,maximumSelectionSize:1,placeholder:(0,m.Z)("Search for item on site...")},text:{insertBtn:(0,m.Z)("Insert"),cancelBtn:(0,m.Z)("Cancel"),insertHeading:(0,m.Z)("Insert link"),title:(0,m.Z)("Title"),internal:(0,m.Z)("Internal"),external:(0,m.Z)("External"),externalText:(0,m.Z)("External URL (can be relative within this site or absolute if it starts with http:// or https://)"),email:(0,m.Z)("Email Address"),anchor:(0,m.Z)("Anchor"),anchorLabel:(0,m.Z)("Select an anchor"),target:(0,m.Z)("Target"),subject:(0,m.Z)("Email Subject (optional)"),image:(0,m.Z)("Image"),imageAlign:(0,m.Z)("Align"),enableImageZoom:(0,m.Z)("Enable image zoom"),scale:(0,m.Z)("Size"),alt:(0,m.Z)("Alternative Text"),insertImageHelp:(0,m.Z)("Specify an image. It can be on this site already (Internal Image), an image you upload (Upload), or from an external site (External Image)."),internalImage:(0,m.Z)("Internal Image"),externalImage:(0,m.Z)("External Image"),externalImageText:(0,m.Z)("External Image URL (can be relative within this site or absolute if it starts with http:// or https://)"),upload:(0,m.Z)("Upload"),insertLinkHelp:(0,m.Z)("Specify the object to link to. It can be on this site already (Internal), an object you upload (Upload), from an external site (External), an email address (Email), or an anchor on this page (Anchor)."),captionFromDescription:(0,m.Z)("Show Image Caption from Image Description"),caption:(0,m.Z)("Image Caption")},loadingBaseUrl:"++plone++static/tinybase",prependToUrl:"",appendToUrl:"",linkAttribute:"path",prependToScalePart:"/imagescale/",appendToScalePart:"",appendToOriginalScalePart:"",defaultScale:"large",imageScales:[{title:"Mini",value:"mini"},{title:"Thumb",value:"thumb"},{title:"Listing",value:"listing"},{title:"Preview",value:"preview"},{title:"Tile",value:"tile"},{title:"Icon",value:"icon"},{title:"Large",value:"large"}],imageClasses:{"image-inline":(0,m.Z)("Inline"),"image-right":(0,m.Z)("Right"),"image-left":(0,m.Z)("Left")},targetList:[{text:(0,m.Z)("Open in this window / frame"),value:""},{text:(0,m.Z)("Open in new window"),value:"_blank"},{text:(0,m.Z)("Open in parent window / frame"),value:"_parent"},{text:(0,m.Z)("Open in top frame (replaces all frames)"),value:"_top"}],imageTypes:["Image"],folderTypes:["Folder","Plone Site"],tiny:{theme:"silver",plugins:["advlist","autolink","lists","charmap","print","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","contextmenu","paste","plonelink","ploneimage"],menubar:"edit table format tools view insert",toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | unlink plonelink ploneimage",height:400},inline:!1},init:(p=regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.e(8862).then(i.bind(i,8862));case 2:t=e.sent.default,this.instance=new t(this.el,this.options),this.instance.init();case 5:case"end":return e.stop()}}),e,this)})),f=function(){var e=this,t=arguments;return new Promise((function(i,a){var n=p.apply(e,t);function o(e){h(n,i,a,o,l,"next",e)}function l(e){h(n,i,a,o,l,"throw",e)}o(void 0)}))},function(){return f.apply(this,arguments)}),destroy:function(){this.instance.destroy()}}),g=i(89799),v=i(79472);i(41973);function y(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var b=s.Z.getLogger("pat-mosaic"),w=[],x=0,C=function(){clearTimeout(x),x=setTimeout(T,50)},T=function(){var e=n()(".mosaic-selected-tile .mosaic-rich-text-toolbar").filter(":visible");if(0!==e.length&&0!==e.find(".mce-first").length){var t=e.parent();e.removeClass("right"),t.offset().left>=n()(window).width()/2&&e.addClass("right");var i=n()(window),a=n()(".mosaic-toolbar").height();if(t.offset().top-e.height()<i.scrollTop()+a){if(!e.hasClass("sticky")){n()("body").addClass("mce-sticky"),e.addClass("sticky");var o={top:n()(".mosaic-toolbar").height()+e.height()};e.hasClass("right")?o.right=e.offset().right:o.left=e.offset().left,e.css(o)}}else e.removeClass("sticky"),e.removeAttr("style"),n()("body").removeClass("mce-sticky")}};n()(window).off("scroll",C).on("scroll",C);var k=function(){function e(t,i){var a,o,s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s=["table","numbers","bullets","text","subheading","heading"],(o="deprecatedHTMLTiles")in(a=this)?Object.defineProperty(a,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):a[o]=s;var r=this;r.tinymce=null,r.mosaic=t,r.$el=n()(i),r.$el.is(".mosaic-tile")||(r.$el=r.$el.parents(".mosaic-tile")),r.focusCheckCount=0,r.$el.children(".mosaic-tile-content").off("blur").on("blur",(function(){var e=r.getConfig();if(e&&"textapp"===e.tile_type){var t=r.getEditUrl();if(t){var i=r.getHtmlContent();if(i===r.$el.data("lastSavedData"))return;if(r.$el.data("activeSave"))return;r.$el.data("activeSave",!0);var a={_authenticator:l.Z.getAuthenticator(),"buttons.save":"Save"};a[e.name+".content"]=i,r.mosaic.queue((function(e){n().ajax({url:t,method:"POST",data:a}).always((function(){r.$el.data("lastSavedData",i),r.$el.data("activeSave",!1),e()}))}))}}}))}var t,i,a;return t=e,i=[{key:"getDataTileEl",value:function(e,t){return this.$el.find("[data-tile]")}},{key:"getContentEl",value:function(e,t){return this.$el.children(".mosaic-tile-content")}},{key:"getHtmlContent",value:function(){return this.getContentEl().html()}},{key:"getEditUrl",value:function(){var e=this.getUrl();if(e&&(e=e.replace(/@@/,"@@edit-tile/")))return e.match(/^\.\/.*/)&&(e=this.mosaic.options.context_url+e.replace(/^\./,"")),e}},{key:"getDeleteUrl",value:function(){var e=this.getUrl().split("?")[0],t=(e=e.split("@@"))[1].split("/");return(e=e[0]+"@@delete-tile/"+t[0]+"/"+t[1]).match(/^\.\/.*/)&&(e=this.mosaic.options.context_url+e.replace(/^\./,"")),e}},{key:"getUrl",value:function(){var e=this.$el.find(".tileUrl").html();if(!e){var t=this.$el.find("[data-tileUrl]");t.length>0&&(e=t.attr("data-tileUrl"))}if(e||(e=this.$el.find("[data-tile]").attr("data-tile")),e)for(e=(e=e.replace(this.mosaic.options.context_url,"./")).replace(/^\.\/\//,"./"),this.mosaic.hasContentLayout?-1===e.indexOf("X-Tile-Persistent")&&(-1===e.indexOf("?")?e+="?":e+="&",e+="X-Tile-Persistent=yes"):-1!==e.indexOf("X-Tile-Persistent")&&(e=e.replace("X-Tile-Persistent=yes","").replace("&&","&"));-1!==e.indexOf("&_layouteditor=true");)e=e.replace("&_layouteditor=true","");return e}},{key:"getType",value:function(){var e="",t=this.$el,i=[];return t.attr("class")&&(i=t.attr("class").split(" "),n()(i).each((function(){var t;null!==(t=this.match(/^mosaic-([\w.\-]+)-tile$/))&&"selected"!==t[1]&&"new"!==t[1]&&"read-only"!==t[1]&&"helper"!==t[1]&&"original"!==t[1]&&"edited"!==t[1]&&(e=t[1])}))),e||b.error("Could not find tile type on element with classes: "+i.join(", ")),e}},{key:"getConfig",value:function(){var e,t=this.getType();this.mosaic.options;for(var i=0;i<this.mosaic.options.tiles.length;i+=1){for(var a=!1,n=this.mosaic.options.tiles[i],o=0;o<n.tiles.length;o+=1){if("field"===n.tiles[o].tile_type){var l=n.tiles[o].widget.split(".");switch(l=l[l.length-1]){case"TextWidget":case"TextFieldWidget":case"TextAreaWidget":case"TextAreaFieldWidget":case"TextLinesWidget":case"TextLinesFieldWidget":case"WysiwygWidget":case"WysiwygFieldWidget":case"RichTextWidget":case"RichTextFieldWidget":n.tiles[o].settings=!1;break;default:n.tiles[o].settings=!0}}if(n.tiles[o].name===t){e=n.tiles[o],a=!0;break}}if(a)break}return e||(-1===w.indexOf(t)&&(b.error("Could not load tile config for tile type: "+t+" falling back to b/w compatible tile type."),w.push(t)),e={tile_type:"app",name:t,label:"Unknown",read_only:!0,favorite:!1,settings:!1,weight:0,rich_text:!1},-1!==this.deprecatedHTMLTiles.indexOf(t)&&(e.category="structure",e.read_only=!1,e.label=t,e.tile_type="text",e.rich_text=!0)),e}},{key:"getHtmlBody",value:function(e){var t,i,a="",o=this.$el.attr("class").split(" ");switch(t=this.getType(),o=n()(o).filter((function(){switch(this){case"mosaic-new-tile":case"mosaic-helper-tile":case"mosaic-original-tile":case"mosaic-selected-tile":case"mosaic-edited-tile":return!1;default:return!0}})).toArray(),this.getConfig().tile_type){case"text":i=c().get(this.$el.children(".mosaic-tile-content").attr("id")),a+='          <div class="'+o.join(" ")+'">\n',a+='          <div class="mosaic-tile-content">\n',a+=(i?i.getContent():this.$el.children(".mosaic-tile-content").html()).replace(/^\s+|\s+$/g,"")+"\n",a+="          </div>\n",a+="          </div>\n";break;case"app":case"textapp":var l=this.getUrl();if(e){var s=((i=c().get(this.$el.children(".mosaic-tile-content").attr("id")))?i.getContent():this.$el.children(".mosaic-tile-content").html()).replace(/^\s+|\s+$/g,"")+"\n";-1===l.indexOf("?")?l+="?":l+="&",l+="content="+encodeURI(s)}a+='          <div class="'+o.join(" ")+'">\n',a+='          <div class="mosaic-tile-content">\n',a+='          <div data-tile="'+l+'"></div>\n',a+="          </div>\n",a+="          </div>\n";break;case"field":a+='          <div class="'+o.join(" ")+'">\n',a+='          <div class="mosaic-tile-content">\n';var r="./@@plone.app.standardtiles.field?field="+t,d=this.getValueFromClasses(o,"mosaic-subfield-");d&&(r+="&subfield="+d);var m=this.getValueFromClasses(o,"mosaic-format-");m&&(r+="&format="+m),a+='          <div data-tile="'+r+'"></div>\n',a+="          </div>\n",a+="          </div>\n",this.saveForm()}return a}},{key:"isRichText",value:function(e){return void 0===e&&(e=this.getConfig()),!(!e||!1!==this.$el.hasClass("mosaic-read-only-tile")||!("text"===e.tile_type&&e.rich_text||"textapp"===e.tile_type&&e.rich_text||"app"===e.tile_type&&e.rich_text||"field"===e.tile_type&&!1===e.read_only&&("z3c.form.browser.text.TextWidget"===e.widget||"z3c.form.browser.text.TextFieldWidget"===e.widget||"z3c.form.browser.textarea.TextAreaWidget"===e.widget||"z3c.form.browser.textarea.TextAreaFieldWidget"===e.widget||"z3c.form.browser.textlines.TextLinesWidget"===e.widget||"z3c.form.browser.textlines.TextLinesFieldWidget"===e.widget||"plone.app.z3cform.widget.RichTextFieldWidget"===e.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"===e.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"===e.widget||"plone.app.widgets.dx.RichTextWidget"===e.widget)))}},{key:"initialize",value:function(){var e,t,i=this.getConfig();if(i&&i.read_only&&this.$el.addClass("mosaic-read-only-tile"),this.isRichText()&&this.setupWysiwyg(),this.$el.prepend(n()(this.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(n()(this.mosaic.document.createElement("div")).addClass("mosaic-tile-inner-border"))),i){var a=n()(this.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-tile-side-tools");if(this.$el.prepend(a.append(n()(this.mosaic.document.createElement("div")).addClass("mosaic-tile-label content").html(i.label))),!this.$el.parent().hasClass("col")){var l=this.$el.parent().attr("class").split(" "),s=this.getValueFromClasses(l,"col-"),r=void 0===s?"":" ("+s+")";a.append(n()(this.mosaic.document.createElement("div")).addClass("mosaic-tile-label reset").append((e=this.resetClicked.bind(this),(t=document.createElement("a")).href="javascript:",t.textContent="Reset"+r,n()(t).on("click",e),t)))}}this.makeMovable(),this.initializeButtons();var c=this;o.ZP.each(["top","bottom","right","left"],(function(e){c.$el.prepend(n()(c.mosaic.document.createElement("div")).addClass("mosaic-divider mosaic-divider-"+e).append(n()(c.mosaic.document.createElement("div")).addClass("mosaic-divider-dot")))}))}},{key:"resetClicked",value:function(e){e.preventDefault(),this.$el.parent().removeClass("col-1 col-2 col-3 col-4 col-5 col-6 col-7 col-8 col-9 col-10 col-11 col-12").addClass("col"),n()(e.target).closest(".reset").remove();var t=this.$el.parent().parent();t.mosaicCleanupRow(),t.mosaicSetResizeHandles()}},{key:"initializeButtons",value:function(){var e=[],t=this.getConfig();this.$el.find(".mosaic-tile-buttons").remove();var i=function(t,i,a){var o=document.createElement("button");return o.className="mosaic-btn-"+i,o.textContent=t,e.push(o),n()(o).on("click",a),o};if(t&&t.settings&&!1===this.$el.hasClass("mosaic-read-only-tile")&&i("Edit","settings",this.settingsClicked.bind(this)),!this.mosaic.hasContentLayout){i("Delete","delete",this.deleteClicked.bind(this));var a=i("Confirm delete","confirm",this.confirmClicked.bind(this));n()(a).hide();var o=i("Cancel","cancel",this.cancelClicked.bind(this));n()(o).hide()}if(e.length>0){var l=n()(this.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-tile-buttons");this.$el.prepend(l),e.forEach((function(e){l.append(e)}))}}},{key:"cancelClicked",value:function(e){e.preventDefault(),n()(".mosaic-btn-settings,.mosaic-btn-delete",this.$el).show(),n()(".mosaic-btn-cancel,.mosaic-btn-confirm",this.$el).hide()}},{key:"deleteClicked",value:function(e){e.preventDefault(),n()(".mosaic-btn-settings,.mosaic-btn-delete",this.$el).hide(),n()(".mosaic-btn-cancel,.mosaic-btn-confirm",this.$el).show()}},{key:"confirmClicked",value:function(e){e.preventDefault();var t=this,i=this.getConfig();if("app"===i.tile_type||"textapp"===i.tile_type){var a=this.getUrl();a&&"undefined"!==a&&(this.mosaic.removeHeadTags(a),this.mosaic.queue((function(e){n().ajax({type:"POST",url:t.getDeleteUrl(),data:{"buttons.delete":"Delete",_authenticator:l.Z.getAuthenticator()}}).always((function(){e()}))})))}this.mosaic.panels.find(".mosaic-empty-row").remove();var o=this.$el.parent().parent();this.saveForm(),this.$el.remove(),o.mosaicCleanupRow(),this.mosaic.panels.mosaicAddEmptyRows(),this.mosaic.toolbar.SelectedTileChange()}},{key:"settingsClicked",value:function(e){e.preventDefault();var t=this,i=t.getConfig();if("app"===i.tile_type){var a=t.getEditUrl();t.mosaic.overlay.app=new g.Z(n()(".mosaic-toolbar"),{ajaxUrl:a,loadLinksWithinModal:!0,buttons:'.formControls > button[type="submit"], .actionButtons > button[type="submit"]'}),t.mosaic.overlay.app.$el.off("after-render"),t.mosaic.overlay.app.on("after-render",(function(e){n()('input[name*="cancel"]',t.mosaic.overlay.app.$modal).off("click").on("click",(function(){t.mosaic.overlay.app.hide(),t.mosaic.overlay.app=null})),t.mosaic.hasContentLayout&&n()("form",t.mosaic.overlay.app.$modal).append(n()('<input type="hidden" name="X-Tile-Persistent" value="yes" />'))})),t.mosaic.overlay.app.show(),t.mosaic.overlay.app.$el.off("formActionSuccess"),t.mosaic.overlay.app.on("formActionSuccess",(function(e,i,a,n,o){var l=n.getResponseHeader("X-Tile-Url"),s=t.mosaic.getDomTreeFromHtml(i);if(l){t.mosaic.removeHeadTags(l),t.mosaic.addHeadTags(l,s);var r=s.find(".temp_body_tag").html();t.fillContent(r,l),t.mosaic.overlay.app.hide(),t.mosaic.overlay.app=null}}))}else t.mosaic.overlay.open("field",i)}},{key:"makeMovable",value:function(){this.$el.hasClass("movable")&&this.mosaic.options.canChangeLayout&&!this.mosaic.hasContentLayout&&this.$el.prepend(n()(this.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-drag-handle"))}},{key:"getValueFromClasses",value:function(e,t){var i;return e.forEach((function(e){-1!==e.indexOf(t)&&(i=e.replace(t,""))})),i}},{key:"initializeContent",value:function(){var e,t,i,a,o,l=this,s=n()("body",l.mosaic.document).attr("data-base-url");s||(s=n()("head > base",l.mosaic.document).attr("href"));var r=this.getUrl(),c=this.getConfig();if("field"===c.tile_type){switch(a="","IDublinCore-title"===c.name?(t='<h1 class="documentFirstHeading">',i="</h1>"):"IDublinCore-description"===c.name?(t='<p class="documentDescription">',i="</p>"):(t="<div>",i="</div>"),c.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":a=t+n()("#"+c.id).find("input").attr("value")+i;break;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":o=n()("#"+c.id).find("textarea").val().split("\n"),a+=t;for(var d=0;d<o.length;d+=1)a+=o[d]+"<br/>";a+=i;break;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":a=n()("#"+c.id).find("textarea").val();break;default:a='<div class="discreet">Placeholder for field:<br/><b>'+c.label+"</b></div>"}l.fillContent(a)}else if(c){l.$el.addClass("mosaic-tile-loading");var m=e=s?[s,r].join("/").replace(/\/+\.\//g,"/"):r;-1===e.indexOf("?")?e+="?":e+="&",-1===e.indexOf("_layouteditor")&&(e+="_layouteditor=true"),n().ajax({type:"POST",url:e,success:function(e){l.$el.removeClass("mosaic-tile-loading"),e=l.mosaic.getDomTreeFromHtml(e),l.mosaic.addHeadTags(r,e);var t=e.find(".temp_body_tag").html();l.fillContent(t,m),"plone.app.standardtiles.html"===l.getType()&&(l.$el.data("lastSavedData")||l.$el.data("lastSavedData",l.getHtmlContent()))},error:function(){l.$el.removeClass("mosaic-tile-loading"),b.error("Error getting data for the tile "+c.label+"("+c.name+"). Please read documentation on how to correctly register tiles: https://pypi.python.org/pypi/plone.tiles")}})}}},{key:"fillContent",value:function(e,t){var i,a=this.getDataTileEl();if(a.length>0?(a.parent().html(e),i=this.getContentEl()):(i=this.getContentEl()).html(e),t&&i.length>0){for(t=t.replace(/&/gim,"&amp;");-1!==t.indexOf("&amp;&amp;");)t=t.replace("&amp;&amp;","&amp;");i.attr("data-tileUrl",t)}this.cacheHtml(e),this.scanRegistry()}},{key:"cacheHtml",value:function(e){if(!this.isRichText()){var t=this.$el.children(".mosaic-tile-content");0!==t.length&&(void 0===e&&(e=t.html()),t[0]._preScanHTML=e)}}},{key:"scanRegistry",value:function(){if(!this.isRichText()){var e=this.$el.find(".mosaic-tile-content");0!==e.length&&(e[0]._preScanHTML&&e.html(e[0]._preScanHTML),v.Z.scan(e),n()("a",e).on("click",(function(e){e.preventDefault(),e.stopPropagation()})))}}},{key:"select",value:function(){if(!1===this.$el.hasClass("mosaic-selected-tile")&&!1===this.$el.hasClass("mosaic-read-only-tile")){var t=n()(".mosaic-selected-tile",this.mosaic.document);1===t.length&&new e(this.mosaic,t).trigger("blur"),this.focus()}}},{key:"_change",value:function(){this.mosaic.toolbar.SelectedTileChange(),this.saveForm()}},{key:"blur",value:function(){this.$el.removeClass("mosaic-selected-tile").children(".mosaic-tile-content").trigger("blur"),this.$el.find(".mce-edit-focus").removeClass("mce-edit-focus"),this._change()}},{key:"_focus",value:function(){var e=this;this.$el.addClass("mosaic-selected-tile"),this.$el.children(".mosaic-tile-content").focus(),this._change(),this.initializeButtons(),e.isRichText()&&e.focusCheckCount<30&&(e.focusCheckTimeout&&clearTimeout(e.focusCheckTimeout),e.focusCheckTimeout=setTimeout((function(){e.focusCheckCount+=1,e.$el.hasClass("mosaic-selected-tile")&&(e.$el.find(".mosaic-rich-text").hasClass("mce-edit-focus")||(e.$el.removeClass("mosaic-selected-tile").children(".mosaic-tile-content").trigger("blur"),e.$el.find(".mce-edit-focus").removeClass("mce-edit-focus"),e._focus()))}),150))}},{key:"focus",value:function(){this.isRichText()&&!0!==this.$el.data("tinymce-loaded")?this.$el.data("delayed-focus",!0):this._focus()}},{key:"saveForm",value:function(){var e,t,i,a=this.getType(),o=this.getConfig();if(o&&"field"===o.tile_type&&!1===o.read_only&&("z3c.form.browser.text.TextWidget"===o.widget||"z3c.form.browser.text.TextFieldWidget"===o.widget||"z3c.form.browser.textarea.TextAreaWidget"===o.widget||"z3c.form.browser.textarea.TextAreaFieldWidget"===o.widget||"z3c.form.browser.textlines.TextLinesWidget"===o.widget||"z3c.form.browser.textlines.TextLinesFieldWidget"===o.widget||"plone.app.z3cform.widget.RichTextFieldWidget"===o.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"===o.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"===o.widget||"plone.app.widgets.dx.RichTextWidget"===o.widget))switch(o.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":var l=n()(".mosaic-panel .mosaic-"+a+"-tile",this.mosaic.document);l.length>1&&(l=l.filter((function(){return n()(".mosaic-tile-control",this).length>0})));var s=l.find(".mosaic-tile-content > *").text();n()("#"+o.id).find("input").val(s);break;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":i="",n()(".mosaic-panel .mosaic-"+a+"-tile",this.mosaic.document).find(".mosaic-tile-content > *").each((function(){i+=n()(this).text()})),i=i.replace(/^\s+|\s+$/g,""),n()("#"+o.id).find("textarea").val(i);break;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":var r=n()(document.getElementById(o.id)).find("textarea");e=r.attr("id"),t=c().get(e);var d=n()(".mosaic-"+a+"-tile",this.mosaic.document).find(".mosaic-tile-content").html();r.val(d),t&&t.setContent(d)}}},{key:"setupWysiwyg",value:function(){var t=this,i=t.$el.find(".mosaic-tile-content");t.$el.data("tinymce-loaded",!1);try{i.data("pattern-tinymce").destroy(),i.removeData("pattern-tinymce")}catch(e){}for(var a=1+Math.floor(1e5*Math.random());n()("#mosaic-rich-text-init-"+a,t.mosaic.document).length>0;)a=1+Math.floor(1e5*Math.random());var o="mosaic-rich-text-init-"+a;i.attr("id",o),i.siblings(".mosaic-rich-text-toolbar").remove();var l,s,r,c,d,m,h=n()('<div class="mosaic-rich-text-toolbar" />').attr("id",o+"-toolbar");i.before(h);var p=t.getType();for(-1!==this.deprecatedHTMLTiles.indexOf(p)&&(p="plone.app.standardtiles.html"),l=t.mosaic.options.default_available_actions,r=0;r<t.mosaic.options.tiles.length;r+=1)for(s=t.mosaic.options.tiles[r],c=0;c<s.tiles.length;c+=1)s.tiles[c].name===p&&(l=l.concat(s.tiles[c].available_actions));for(d=[],r=0;r<t.mosaic.options.richtext_toolbar.length;r+=1){for(s=t.mosaic.options.richtext_toolbar[r],c=0;c<s.actions.length;c+=1)n().inArray(s.actions[c].name,l)>-1&&d.push(s.actions[c].action);d.length&&"|"!=d[d.length-1]&&d.push("|")}for(d.length&&"|"==d[d.length-1]&&d.pop(),m=[],r=0;r<t.mosaic.options.richtext_contextmenu.length;r+=1){for(s=t.mosaic.options.richtext_contextmenu[r],c=0;c<s.actions.length;c+=1)n().inArray(s.actions[c].name,l)>-1&&m.push(s.actions[c].action);m.length&&"|"!=m[m.length-1]&&m.push("|")}m.length&&"|"==m[m.length-1]&&m.pop();var f=function(){var e=i.find("p > *");(0===e.length||1===e.length&&e.is("br"))&&0===i.text().replace(/^\s+|\s+$/g,"").length?(i.addClass("mosaic-tile-content-empty"),0===i.find("p").length&&i.empty().append("<p></p>")):i.removeClass("mosaic-tile-content-empty")},g=0,v=function(){clearTimeout(g),g=setTimeout(f,100)},y=t.mosaic.options.tinymce.tiny.paste_as_text||!1;0===d.length&&(y=!0),new u(i,n().extend(!0,{},t.mosaic.options.tinymce,{inline:!1,tiny:{body_id:o,selector:"#"+o,inline:!0,paste_as_text:y,fixed_toolbar_container:"#"+h.attr("id"),ui_container:"#"+h.attr("id"),theme_advanced_toolbar_align:"right",menubar:!1,toolbar:d.join(" ")||!1,statusbar:!1,contextmenu:m.join(" ")||!1,plugins:t.mosaic.options.tinymce.tiny.plugins.concat(m.length?["contextmenu"]:[]),setup:function(i){t.tinymce=i,i.on("focus",(function(i){i.target.id&&(0===n()(".mosaic-helper-tile").length?(t.select(),C()):setTimeout((function(){n()(".mce-edit-focus").each((function(){new e(t.mosaic,n()(this).parent()).trigger("blur");var i=window.tinyMCE.get(this.getAttribute("id"));i&&i.hide()}))}),10))})),0===d.length&&i.on("keydown",(function(e){13!==e.keyCode||e.preventDefault()})),i.on("keyup change",v),v(),i.on("init",(function(){t.$el.data("tinymce-loaded",!0),!0===t.$el.data("delayed-focus")&&(t.$el.data("delayed-focus",!1),setTimeout((function(){t._focus()}),50))}))}}})),i.addClass("mosaic-rich-text")}}],a=[{key:"validTile",value:function(e){var t=n()(e);return!!t.is(".mosaic-tile")||t.parents(".mosaic-tile").length>0}}],i&&y(t.prototype,i),a&&y(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}(),$=k}}]);
//# sourceMappingURL=83364.40720a6b0c465c5cafca.min.js.map