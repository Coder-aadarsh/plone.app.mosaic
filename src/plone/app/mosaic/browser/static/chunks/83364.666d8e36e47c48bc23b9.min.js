"use strict";(self.webpackChunkplone_mosaic=self.webpackChunkplone_mosaic||[]).push([[83364,41973],{47874:function(e,t,i){var a=i(90365),n=null;t.Z=function(e,t){if(null===n){var i=new a.Z;i.loadCatalog("widgets"),n=i.MessageFactory("widgets")}return n(e,t)}},41973:function(e,t,i){i.r(t),i.d(t,{default:function(){return l}});var a=i(65311),n=i.n(a);i(3685);function o(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var l=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,this.panels=i}var t,i,a;return t=e,(i=[{key:"initialize",value:function(){var e=n()(".mosaic-original-content"),t=n()("form",e),i=n()("h1",e),a=n()('<div class="modal fade" id="mosaic-original-content-modal"><div class="modal-dialog modal-xl"><div class="modal-content"><div class="modal-header"><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body"></div><div class="modal-footer"><div class="pattern-modal-buttons"></div></div></div></div></div>');n()(".modal-header",a).prepend("<h2 class='modal-title'>"+i.text()+"</h2>"),n()(".modal-body",a).append(t),n()(document.body).append(a),this.$overlay=a,this.modal=new bootstrap.Modal(document.getElementById("mosaic-original-content-modal"),{}),e.hide()}},{key:"open",value:function(e,t){var i,a,o,l,s,r,c,d,m=this;if(m.modal.show(),i=m.$overlay.find("form"),0===n()(".mosaic-overlay-ok-button").length&&(n()(".mosaic-overlay .formControls").children("button").hide(),n()(".mosaic-overlay .pattern-modal-buttons").append(n()(document.createElement("input")).attr({type:"button",value:"Done"}).addClass("mosaic-overlay-ok-button plone-btn plone-btn-primary").on("click",(function(){m.modal.close()}))),n()(".mosaic-overlay .modal-header h2").html("Properties")),"all"===e&&m.options.overlay_hide_fields){for((a=i.find("nav")).removeClass("mosaic-hidden"),i.find("fieldset").children().removeClass("mosaic-hidden"),i.find("fieldset").removeClass("active"),a.find("a").removeClass("active"),i.find(m.options.customContentLayout_selector).addClass("mosaic-hidden"),i.find(m.options.contentLayout_selector).addClass("mosaic-hidden"),n()(".mosaic-IDublinCore-title-tile").length>0?i.find("#formfield-form-widgets-IDublinCore-title").addClass("mosaic-hidden"):i.find("#formfield-form-widgets-IDublinCore-title").removeClass("mosaic-hidden"),n()(".mosaic-IDublinCore-description-tile").length>0?i.find("#formfield-form-widgets-IDublinCore-description").addClass("mosaic-hidden"):i.find("#formfield-form-widgets-IDublinCore-description").removeClass("mosaic-hidden"),l=0;l<m.options.tiles.length;l+=1)"fields"===m.options.tiles[l].name&&(o=m.options.tiles[l]);for(l=0;l<o.tiles.length;l+=1)r=o.tiles[l],0!==m.panels.find(".mosaic-"+r.name+"-tile").length&&n()("#"+r.id).addClass("mosaic-hidden");i.find("fieldset").each((function(){0===n()(this).children("div:not(.mosaic-hidden)").length&&n()("a[href=#fieldsetlegend-"+n()(this).attr("id").split("-")[1]+"]").addClass("mosaic-hidden")})),(s=a.children(":not(.mosaic-hidden)")).eq(0).addClass("active");var h=i.find("#fieldset-"+s.eq(0).attr("href").split("-")[1]);0===h.length&&(h=i.find("fieldset:not(.mosaic-hidden)").eq(0)),h.addClass("active")}else"field"===e&&(d=(c=n()("#"+t.id)).parents("fieldset"),i.find("fieldset").removeClass("active"),d.addClass("active"),d.children().addClass("mosaic-hidden"),c.removeClass("mosaic-hidden"),i.find("nav").addClass("mosaic-hidden"))}}])&&o(t.prototype,i),a&&o(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}()},83364:function(e,t,i){i.r(t),i.d(t,{default:function(){return F}});i(35666);var a=i(65311),n=i.n(a),o=i(98860),l=i(84109),s=i(89867),r=i(47575),c=i.n(r),d=i(39191),m=(i(90365),i(47874));function h(e,t,i,a,n,o,l){try{var s=e[o](l),r=s.value}catch(e){return void i(e)}s.done?t(r):Promise.resolve(r).then(a,n)}var u,f,p=d.Z.extend({name:"tinymce",trigger:".pat-tinymce",parser:"mockup",defaults:{upload:{uploadMultiple:!1,maxFiles:1,showTitle:!1},relatedItems:{attributes:["UID","Title","portal_type","path","getURL","getIcon","is_folderish","review_state"],batchSize:20,basePath:"/",vocabularyUrl:null,width:500,maximumSelectionSize:1,placeholder:(0,m.Z)("Search for item on site...")},text:{insertBtn:(0,m.Z)("Insert"),cancelBtn:(0,m.Z)("Cancel"),insertHeading:(0,m.Z)("Insert link"),title:(0,m.Z)("Title"),internal:(0,m.Z)("Internal"),external:(0,m.Z)("External"),externalText:(0,m.Z)("External URL (can be relative within this site or absolute if it starts with http:// or https://)"),email:(0,m.Z)("Email Address"),anchor:(0,m.Z)("Anchor"),anchorLabel:(0,m.Z)("Select an anchor"),target:(0,m.Z)("Target"),subject:(0,m.Z)("Email Subject (optional)"),image:(0,m.Z)("Image"),imageAlign:(0,m.Z)("Align"),enableImageZoom:(0,m.Z)("Enable image zoom"),scale:(0,m.Z)("Size"),alt:(0,m.Z)("Alternative Text"),insertImageHelp:(0,m.Z)("Specify an image. It can be on this site already (Internal Image), an image you upload (Upload), or from an external site (External Image)."),internalImage:(0,m.Z)("Internal Image"),externalImage:(0,m.Z)("External Image"),externalImageText:(0,m.Z)("External Image URL (can be relative within this site or absolute if it starts with http:// or https://)"),upload:(0,m.Z)("Upload"),insertLinkHelp:(0,m.Z)("Specify the object to link to. It can be on this site already (Internal), an object you upload (Upload), from an external site (External), an email address (Email), or an anchor on this page (Anchor)."),captionFromDescription:(0,m.Z)("Show Image Caption from Image Description"),caption:(0,m.Z)("Image Caption")},loadingBaseUrl:"++plone++static/tinybase",prependToUrl:"",appendToUrl:"",linkAttribute:"path",prependToScalePart:"/imagescale/",appendToScalePart:"",appendToOriginalScalePart:"",defaultScale:"large",imageScales:[{title:"Mini",value:"mini"},{title:"Thumb",value:"thumb"},{title:"Listing",value:"listing"},{title:"Preview",value:"preview"},{title:"Tile",value:"tile"},{title:"Icon",value:"icon"},{title:"Large",value:"large"}],imageClasses:{"image-inline":(0,m.Z)("Inline"),"image-right":(0,m.Z)("Right"),"image-left":(0,m.Z)("Left")},targetList:[{text:(0,m.Z)("Open in this window / frame"),value:""},{text:(0,m.Z)("Open in new window"),value:"_blank"},{text:(0,m.Z)("Open in parent window / frame"),value:"_parent"},{text:(0,m.Z)("Open in top frame (replaces all frames)"),value:"_top"}],imageTypes:["Image"],folderTypes:["Folder","Plone Site"],tiny:{theme:"silver",plugins:["advlist","autolink","lists","charmap","print","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","contextmenu","paste","plonelink","ploneimage"],menubar:"edit table format tools view insert",toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | unlink plonelink ploneimage",height:400},inline:!1},init:(u=regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.e(8862).then(i.bind(i,8862));case 2:t=e.sent.default,this.instance=new t(this.el,this.options),this.instance.init();case 5:case"end":return e.stop()}}),e,this)})),f=function(){var e=this,t=arguments;return new Promise((function(i,a){var n=u.apply(e,t);function o(e){h(n,i,a,o,l,"next",e)}function l(e){h(n,i,a,o,l,"throw",e)}o(void 0)}))},function(){return f.apply(this,arguments)}),destroy:function(){this.instance.destroy()}}),g=i(89799),v=i(79472);i(41973);function y(e,t,i,a,n,o,l){try{var s=e[o](l),r=s.value}catch(e){return void i(e)}s.done?t(r):Promise.resolve(r).then(a,n)}function b(e){return function(){var t=this,i=arguments;return new Promise((function(a,n){var o=e.apply(t,i);function l(e){y(o,a,n,l,s,"next",e)}function s(e){y(o,a,n,l,s,"throw",e)}l(void 0)}))}}function w(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return x(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return x(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,s=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return l=e.done,e},e:function(e){s=!0,o=e},f:function(){try{l||null==i.return||i.return()}finally{if(s)throw o}}}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function C(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var T=s.Z.getLogger("pat-mosaic/tile"),k={},$={delete:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16"><path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"/></svg>',cancel:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/></svg>',confirm:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/></svg>',edit:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16"><path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/><path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/></svg>',settings:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-sliders" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M11.5 2a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM9.05 3a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0V3h9.05zM4.5 7a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM2.05 8a2.5 2.5 0 0 1 4.9 0H16v1H6.95a2.5 2.5 0 0 1-4.9 0H0V8h2.05zm9.45 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm-2.45 1a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0v-1h9.05z"/></svg>'},_=[],W=0,z=function(){clearTimeout(W),W=setTimeout(Z,50)},Z=function(){var e=n()(".mosaic-selected-tile .mosaic-rich-text-toolbar").filter(":visible");if(0!==e.length&&0!==e.find(".mce-first").length){var t=e.parent();e.removeClass("right"),t.offset().left>=n()(window).width()/2&&e.addClass("right");var i=n()(window),a=n()(".mosaic-toolbar").height();if(t.offset().top-e.height()<i.scrollTop()+a){if(!e.hasClass("sticky")){n()("body").addClass("mce-sticky"),e.addClass("sticky");var o={top:n()(".mosaic-toolbar").height()+e.height()};e.hasClass("right")?o.right=e.offset().right:o.left=e.offset().left,e.css(o)}}else e.removeClass("sticky"),e.removeAttr("style"),n()("body").removeClass("mce-sticky")}};n()(window).off("scroll",z).on("scroll",z);var L=function(){function e(t,i){var a,o,l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),l=["table","numbers","bullets","text","subheading","heading"],(o="deprecatedHTMLTiles")in(a=this)?Object.defineProperty(a,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):a[o]=l;var s=this;s.tinymce=null,s.mosaic=t,s.el=i,s.$el=n()(i),s.$el.is(".mosaic-tile")||(s.$el=s.$el.parents(".mosaic-tile")),s.focusCheckCount=0}var t,i,a,s,r,d;return t=e,i=[{key:"getDataTileEl",value:function(e,t){return this.$el.find("[data-tile]")}},{key:"getContentEl",value:function(e,t){return this.$el.children(".mosaic-tile-content")}},{key:"getHtmlContent",value:function(){return this.getContentEl().html()}},{key:"getEditUrl",value:function(){var e=this.getUrl();if(e&&(e=e.replace(/@@/,"@@edit-tile/")))return e.match(/^\.\/.*/)&&(e=this.mosaic.options.context_url+e.replace(/^\./,"")),e}},{key:"getDeleteUrl",value:function(){var e=this.getUrl().split("?")[0],t=(e=e.split("@@"))[1].split("/");return(e=e[0]+"@@delete-tile/"+t[0]+"/"+t[1]).match(/^\.\/.*/)&&(e=this.mosaic.options.context_url+e.replace(/^\./,"")),e}},{key:"getUrl",value:function(){var e=this.$el.find(".tileUrl").html();if(!e){var t=this.$el.find("[data-tileUrl]");t.length>0&&(e=t.attr("data-tileUrl"))}if(e||(e=this.$el.find("[data-tile]").attr("data-tile")),e)for(e=(e=e.replace(this.mosaic.options.context_url,"./")).replace(/^\.\/\//,"./"),this.mosaic.hasContentLayout?-1===e.indexOf("X-Tile-Persistent")&&(-1===e.indexOf("?")?e+="?":e+="&",e+="X-Tile-Persistent=yes"):-1!==e.indexOf("X-Tile-Persistent")&&(e=e.replace("X-Tile-Persistent=yes","").replace("&&","&"));-1!==e.indexOf("&_layouteditor=true");)e=e.replace("&_layouteditor=true","");return e}},{key:"getType",value:function(){var e=this,t=e.$el.attr("class");if(t in k)return k[t];var i,a="",n=w(t.split(" "));try{for(n.s();!(i=n.n()).done;){var o=i.value.match(/^mosaic-([\w.\-]+)-tile$/);null!==o&&"selected"!==o[1]&&"new"!==o[1]&&"read-only"!==o[1]&&"helper"!==o[1]&&"original"!==o[1]&&"edited"!==o[1]&&(a=o[1])}}catch(e){n.e(e)}finally{n.f()}return a?T.info('Found tile type "'.concat(a,'" for element ').concat(e.el)):T.error("Could not find tile type on element ".concat(e.$el," with classes: ").concat(t)),k[t]=a,a}},{key:"getConfig",value:function(){for(var e,t=this.getType(),i=0;i<this.mosaic.options.tiles.length;i+=1){for(var a=!1,n=this.mosaic.options.tiles[i],o=0;o<n.tiles.length;o+=1){if("field"===n.tiles[o].tile_type){var l=n.tiles[o].widget.split(".");switch(l=l[l.length-1]){case"TextWidget":case"TextFieldWidget":case"TextAreaWidget":case"TextAreaFieldWidget":case"TextLinesWidget":case"TextLinesFieldWidget":case"WysiwygWidget":case"WysiwygFieldWidget":case"RichTextWidget":case"RichTextFieldWidget":n.tiles[o].settings=!1;break;default:n.tiles[o].settings=!0}}if(n.tiles[o].name===t){e=n.tiles[o],a=!0;break}}if(a)break}return e||(-1===_.indexOf(t)&&(T.error("Could not load tile config for tile type: "+t+" falling back to b/w compatible tile type."),_.push(t)),e={tile_type:"app",name:t,label:"Unknown",read_only:!0,favorite:!1,settings:!1,weight:0,rich_text:!1},-1!==this.deprecatedHTMLTiles.indexOf(t)&&(e.category="structure",e.read_only=!1,e.label=t,e.tile_type="text",e.rich_text=!0)),e}},{key:"getHtmlBody",value:function(e){var t,i,a="",o=this.$el.attr("class").split(" ");switch(t=this.getType(),o=n()(o).filter((function(){switch(this){case"mosaic-new-tile":case"mosaic-helper-tile":case"mosaic-original-tile":case"mosaic-selected-tile":case"mosaic-edited-tile":return!1;default:return!0}})).toArray(),this.getConfig().tile_type){case"text":i=c().get(this.$el.children(".mosaic-tile-content").attr("id")),a+='          <div class="'+o.join(" ")+'">\n',a+='          <div class="mosaic-tile-content">\n',a+=(i?i.getContent():this.$el.children(".mosaic-tile-content").html()).replace(/^\s+|\s+$/g,"")+"\n",a+="          </div>\n",a+="          </div>\n";break;case"app":case"textapp":var l=this.getUrl();if(e){var s=((i=c().get(this.$el.children(".mosaic-tile-content").attr("id")))?i.getContent():this.$el.children(".mosaic-tile-content").html()).replace(/^\s+|\s+$/g,"")+"\n";-1===l.indexOf("?")?l+="?":l+="&",l+="content="+encodeURI(s)}a+='          <div class="'+o.join(" ")+'">\n',a+='          <div class="mosaic-tile-content">\n',a+='          <div data-tile="'+l+'"></div>\n',a+="          </div>\n",a+="          </div>\n";break;case"field":a+='          <div class="'+o.join(" ")+'">\n',a+='          <div class="mosaic-tile-content">\n';var r="./@@plone.app.standardtiles.field?field="+t,d=this.getValueFromClasses(o,"mosaic-subfield-");d&&(r+="&subfield="+d);var m=this.getValueFromClasses(o,"mosaic-format-");m&&(r+="&format="+m),a+='          <div data-tile="'+r+'"></div>\n',a+="          </div>\n",a+="          </div>\n",this.saveForm()}return a}},{key:"isRichText",value:function(e){return void 0===e&&(e=this.getConfig()),!(!e||!1!==this.$el.hasClass("mosaic-read-only-tile")||!("text"===e.tile_type&&e.rich_text||"textapp"===e.tile_type&&e.rich_text||"app"===e.tile_type&&e.rich_text||"field"===e.tile_type&&!1===e.read_only&&("z3c.form.browser.text.TextWidget"===e.widget||"z3c.form.browser.text.TextFieldWidget"===e.widget||"z3c.form.browser.textarea.TextAreaWidget"===e.widget||"z3c.form.browser.textarea.TextAreaFieldWidget"===e.widget||"z3c.form.browser.textlines.TextLinesWidget"===e.widget||"z3c.form.browser.textlines.TextLinesFieldWidget"===e.widget||"plone.app.z3cform.widget.RichTextFieldWidget"===e.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"===e.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"===e.widget||"plone.app.widgets.dx.RichTextWidget"===e.widget)))}},{key:"initialize",value:(d=b(regeneratorRuntime.mark((function e(){var t,i,a,l,s,r,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getConfig(),T.info("Setup ".concat(t)),t&&t.read_only&&this.$el.addClass("mosaic-read-only-tile"),!this.isRichText()){e.next=6;break}return e.next=6,this.setupWysiwyg();case 6:this.$el.prepend(n()(this.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(n()(this.mosaic.document.createElement("div")).addClass("mosaic-tile-inner-border"))),t&&(i=n()(this.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-tile-side-tools"),this.$el.prepend(i.append(n()(this.mosaic.document.createElement("div")).addClass("mosaic-tile-label content").html(t.label))),this.$el.parent().hasClass("col")||(a=this.$el.parent().attr("class").split(" "),l=this.getValueFromClasses(a,"col-"),s=void 0===l?"":" ("+l+")",r=function(e){var t=document.createElement("a");return t.href="javascript:",t.textContent="Reset"+s,n()(t).on("click",e),t},i.append(n()(this.mosaic.document.createElement("div")).addClass("mosaic-tile-label reset").append(r(this.resetClicked.bind(this)))))),this.makeMovable(),this.initializeButtons(),c=this,o.ZP.each(["top","bottom","right","left"],(function(e){c.$el.prepend(n()(c.mosaic.document.createElement("div")).addClass("mosaic-divider mosaic-divider-"+e).append(n()(c.mosaic.document.createElement("div")).addClass("mosaic-divider-dot")))}));case 12:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"resetClicked",value:function(e){e.preventDefault(),this.$el.parent().removeClass("col-1 col-2 col-3 col-4 col-5 col-6 col-7 col-8 col-9 col-10 col-11 col-12").addClass("col"),n()(e.target).closest(".reset").remove();var t=this.$el.parent().parent();t.mosaicCleanupRow(),t.mosaicSetResizeHandles()}},{key:"initializeButtons",value:function(){var e=[],t=this.getConfig();this.$el.find(".mosaic-tile-buttons").remove();var i=function(t,i,a){var o=document.createElement("button");return o.className="btn btn-sm btn-".concat("confirm"===i?"danger":"light"," mosaic-btn-").concat(i),o.textContent=t,e.push(o),n()(o).on("click",a),i in $?n()(o).prepend($[i]+" "):T.warn('could not find button icon "'.concat(i,'"')),o};if(t&&t.settings&&!1===this.$el.hasClass("mosaic-read-only-tile")&&i("Edit","settings",this.settingsClicked.bind(this)),!this.mosaic.hasContentLayout){i("Delete","delete",this.deleteClicked.bind(this));var a=i("Confirm delete","confirm",this.confirmClicked.bind(this));n()(a).hide();var o=i("Cancel","cancel",this.cancelClicked.bind(this));n()(o).hide()}if(e.length>0){var l,s=n()("<div />").addClass("mosaic-tile-control mosaic-tile-buttons"),r=w(e);try{for(r.s();!(l=r.n()).done;){var c=l.value;s.append(c)}}catch(e){r.e(e)}finally{r.f()}this.$el.prepend(s)}}},{key:"cancelClicked",value:function(e){e.preventDefault(),n()(".mosaic-btn-settings,.mosaic-btn-delete",this.$el).show(),n()(".mosaic-btn-cancel,.mosaic-btn-confirm",this.$el).hide()}},{key:"deleteClicked",value:function(e){e.preventDefault(),n()(".mosaic-btn-settings,.mosaic-btn-delete",this.$el).hide(),n()(".mosaic-btn-cancel,.mosaic-btn-confirm",this.$el).show()}},{key:"confirmClicked",value:function(e){e.preventDefault();var t=this,i=this.getConfig();if("app"===i.tile_type||"textapp"===i.tile_type){var a=this.getUrl();a&&"undefined"!==a&&(this.mosaic.removeHeadTags(a),this.mosaic.queue((function(e){n().ajax({type:"POST",url:t.getDeleteUrl(),data:{"buttons.delete":"Delete",_authenticator:l.Z.getAuthenticator()}}).always((function(){e()}))})))}this.mosaic.panels.find(".mosaic-empty-row").remove();var o=this.$el.parent().parent();this.saveForm(),this.$el.remove(),o.mosaicCleanupRow(),this.mosaic.panels.mosaicAddEmptyRows(),this.mosaic.toolbar.SelectedTileChange()}},{key:"settingsClicked",value:function(e){e.preventDefault();var t=this,i=t.getConfig();if("app"===i.tile_type){var a=t.getEditUrl();t.mosaic.overlay.app=new g.Z(n()(".mosaic-toolbar"),{ajaxUrl:a,loadLinksWithinModal:!0,buttons:'.formControls > button[type="submit"], .actionButtons > button[type="submit"]'}),t.mosaic.overlay.app.$el.off("after-render"),t.mosaic.overlay.app.on("after-render",(function(e){n()('input[name*="cancel"]',t.mosaic.overlay.app.$modal).off("click").on("click",(function(){t.mosaic.overlay.app.hide(),t.mosaic.overlay.app=null})),t.mosaic.hasContentLayout&&n()("form",t.mosaic.overlay.app.$modal).append(n()('<input type="hidden" name="X-Tile-Persistent" value="yes" />'))})),t.mosaic.overlay.app.show(),t.mosaic.overlay.app.$el.off("formActionSuccess"),t.mosaic.overlay.app.on("formActionSuccess",(function(e,i,a,n,o){var l=n.getResponseHeader("X-Tile-Url"),s=t.mosaic.getDomTreeFromHtml(i);if(l){t.mosaic.removeHeadTags(l),t.mosaic.addHeadTags(l,s);var r=s.find(".temp_body_tag").html();t.fillContent(r,l),t.mosaic.overlay.app.hide(),t.mosaic.overlay.app=null}}))}else t.mosaic.overlay.open("field",i)}},{key:"makeMovable",value:function(){this.$el.hasClass("movable")&&this.mosaic.options.canChangeLayout&&!this.mosaic.hasContentLayout&&this.$el.prepend(n()(this.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-drag-handle"))}},{key:"getValueFromClasses",value:function(e,t){var i;return e.forEach((function(e){-1!==e.indexOf(t)&&(i=e.replace(t,""))})),i}},{key:"initializeContent",value:(r=b(regeneratorRuntime.mark((function e(){var t,i,a,o,l,s,r,c,d,m,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this,(r=n()("body",t.mosaic.document).attr("data-base-url"))||(r=n()("head > base",t.mosaic.document).attr("href")),c=this.getUrl(),"field"!==(d=this.getConfig()).tile_type){e.next=25;break}l="","IDublinCore-title"===d.name?(a='<h1 class="documentFirstHeading">',o="</h1>"):"IDublinCore-description"===d.name?(a='<p class="documentDescription">',o="</p>"):(a="<div>",o="</div>"),e.t0=d.widget,e.next="z3c.form.browser.text.TextWidget"===e.t0||"z3c.form.browser.text.TextFieldWidget"===e.t0?11:"z3c.form.browser.textarea.TextAreaWidget"===e.t0||"z3c.form.browser.textarea.TextAreaFieldWidget"===e.t0||"z3c.form.browser.textlines.TextLinesWidget"===e.t0||"z3c.form.browser.textlines.TextLinesFieldWidget"===e.t0?13:"plone.app.z3cform.widget.RichTextFieldWidget"===e.t0||"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"===e.t0||"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"===e.t0||"plone.app.widgets.dx.RichTextWidget"===e.t0?18:20;break;case 11:return l=a+n()("#"+d.id).find("input").attr("value")+o,e.abrupt("break",22);case 13:for(s=n()("#"+d.id).find("textarea").val().split("\n"),l+=a,m=0;m<s.length;m+=1)l+=s[m]+"<br/>";return l+=o,e.abrupt("break",22);case 18:return l=n()("#"+d.id).find("textarea").val(),e.abrupt("break",22);case 20:return l='<div class="discreet">Placeholder for field:<br/><b>'+d.label+"</b></div>",e.abrupt("break",22);case 22:t.fillContent(l),e.next=26;break;case 25:d&&(t.$el.addClass("mosaic-tile-loading"),i=r?[r,c].join("/").replace(/\/+\.\//g,"/"):c,h=i,-1===i.indexOf("?")?i+="?":i+="&",-1===i.indexOf("_layouteditor")&&(i+="_layouteditor=true"),n().ajax({type:"POST",url:i,success:function(e){t.$el.removeClass("mosaic-tile-loading"),e=t.mosaic.getDomTreeFromHtml(e),t.mosaic.addHeadTags(c,e);var i=e.find(".temp_body_tag").html();t.fillContent(i,h),"plone.app.standardtiles.html"===t.getType()&&(t.$el.data("lastSavedData")||t.$el.data("lastSavedData",t.getHtmlContent()))},error:function(){t.$el.removeClass("mosaic-tile-loading"),T.error("Error getting data for the tile "+d.label+"("+d.name+"). Please read documentation on how to correctly register tiles: https://pypi.python.org/pypi/plone.tiles")}}));case 26:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"fillContent",value:function(e,t){var i,a=this.getDataTileEl();if(a.length>0?(a.parent().html(e),i=this.getContentEl()):(i=this.getContentEl()).html(e),t&&i.length>0){for(t=t.replace(/&/gim,"&amp;");-1!==t.indexOf("&amp;&amp;");)t=t.replace("&amp;&amp;","&amp;");i.attr("data-tileUrl",t)}this.cacheHtml(e),this.scanRegistry()}},{key:"cacheHtml",value:function(e){if(!this.isRichText()){var t=this.$el.children(".mosaic-tile-content");0!==t.length&&(void 0===e&&(e=t.html()),t[0]._preScanHTML=e)}}},{key:"scanRegistry",value:function(){var e=this.$el.find(".mosaic-tile-content");0!==e.length&&(e[0]._preScanHTML&&e.html(e[0]._preScanHTML),v.Z.scan(e),n()("a",e).on("click",(function(e){e.preventDefault(),e.stopPropagation()})))}},{key:"select",value:function(){var t=this;!1===t.$el.hasClass("mosaic-selected-tile")&&!1===t.$el.hasClass("mosaic-read-only-tile")&&(n()(".mosaic-selected-tile").length&&new e(t.mosaic,n()(".mosaic-selected-tile")[0]).blur(),t.focus())}},{key:"_change",value:function(){this.mosaic.toolbar.SelectedTileChange(),this.saveForm()}},{key:"blur",value:function(){T.info("Blur ".concat(this.getType())),this.$el.removeClass("mosaic-selected-tile"),this.$el.find(".mce-edit-focus").removeClass("mce-edit-focus"),this._change()}},{key:"_focus",value:function(){var e=this;this.$el.addClass("mosaic-selected-tile"),this.$el.children(".mosaic-tile-content").trigger("focus"),this._change(),this.initializeButtons(),e.isRichText()&&e.focusCheckCount<30&&(e.focusCheckTimeout&&clearTimeout(e.focusCheckTimeout),e.focusCheckTimeout=setTimeout((function(){e.focusCheckCount+=1,e.$el.hasClass("mosaic-selected-tile")&&(e.$el.find(".mosaic-rich-text").hasClass("mce-edit-focus")||(e.$el.removeClass("mosaic-selected-tile").children(".mosaic-tile-content").trigger("blur"),e.$el.find(".mce-edit-focus").removeClass("mce-edit-focus"),e._focus()))}),150))}},{key:"focus",value:function(){T.info("Focus ".concat(this.getType()));var e=this;e.isRichText()&&!0!==e.$el.attr("data-tinymce-loaded")?e.$el.attr("data-delayed-focus",!0):e._focus()}},{key:"saveForm",value:function(){var e,t,i,a=this.getType(),o=this.getConfig();if(o&&"field"===o.tile_type&&!1===o.read_only&&("z3c.form.browser.text.TextWidget"===o.widget||"z3c.form.browser.text.TextFieldWidget"===o.widget||"z3c.form.browser.textarea.TextAreaWidget"===o.widget||"z3c.form.browser.textarea.TextAreaFieldWidget"===o.widget||"z3c.form.browser.textlines.TextLinesWidget"===o.widget||"z3c.form.browser.textlines.TextLinesFieldWidget"===o.widget||"plone.app.z3cform.widget.RichTextFieldWidget"===o.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"===o.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"===o.widget||"plone.app.widgets.dx.RichTextWidget"===o.widget))switch(o.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":var l=n()(".mosaic-panel .mosaic-"+a+"-tile",this.mosaic.document);l.length>1&&(l=l.filter((function(){return n()(".mosaic-tile-control",this).length>0})));var s=l.find(".mosaic-tile-content > *").text();n()("#"+o.id).find("input").val(s);break;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":i="",n()(".mosaic-panel .mosaic-"+a+"-tile",this.mosaic.document).find(".mosaic-tile-content > *").each((function(){i+=n()(this).text()})),i=i.replace(/^\s+|\s+$/g,""),n()("#"+o.id).find("textarea").val(i);break;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":var r=n()(document.getElementById(o.id)).find("textarea");e=r.attr("id"),t=c().get(e);var d=n()(".mosaic-"+a+"-tile",this.mosaic.document).find(".mosaic-tile-content").html();r.val(d),t&&t.setContent(d)}}},{key:"setupWysiwyg",value:(s=b(regeneratorRuntime.mark((function e(){var t,i,a,o,l,s,r,c,d,m,h,u,f,g,v,y,b,x,C,k,$,_,W,Z,L,F,I,A,E,H,R;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=(t=this).$el.find(".mosaic-tile-content"),T.info("Setup wysiwyg"),t.$el.attr("data-tinymce-loaded",!1);try{i.data("pattern-tinymce").destroy(),i.removeData("pattern-tinymce")}catch(e){}for(a=1+Math.floor(1e5*Math.random());n()("#mosaic-rich-text-init-"+a,t.mosaic.document).length>0;)a=1+Math.floor(1e5*Math.random());o="mosaic-rich-text-init-"+a,i.attr("id",o),i.siblings(".mosaic-rich-text-toolbar").remove(),l=n()('<div class="mosaic-rich-text-toolbar" />').attr("id",o+"-toolbar"),i.before(l),d=t.getType(),-1!==this.deprecatedHTMLTiles.indexOf(d)&&(d="plone.app.standardtiles.html"),s=t.mosaic.options.default_available_actions,m=w(t.mosaic.options.tiles);try{for(m.s();!(h=m.n()).done;){u=h.value,f=w(u.tiles);try{for(f.s();!(g=f.n()).done;)(v=g.value).name===d&&(s=s.concat(v.available_actions))}catch(e){f.e(e)}finally{f.f()}}}catch(e){m.e(e)}finally{m.f()}r=[],y=w(t.mosaic.options.richtext_toolbar);try{for(y.s();!(b=y.n()).done;){x=b.value,C=w(x.actions);try{for(C.s();!(k=C.n()).done;)$=k.value,n().inArray($.name,s)>-1&&r.push($.action)}catch(e){C.e(e)}finally{C.f()}r.length&&"|"!=r[r.length-1]&&r.push("|")}}catch(e){y.e(e)}finally{y.f()}r.length&&"|"==r[r.length-1]&&r.pop(),c=[],_=w(t.mosaic.options.richtext_contextmenu);try{for(_.s();!(W=_.n()).done;){Z=W.value,L=w(Z.actions);try{for(L.s();!(F=L.n()).done;)(I=F.value).name in s&&c.push(I.action)}catch(e){L.e(e)}finally{L.f()}c.length&&"|"!=c[c.length-1]&&c.push("|")}}catch(e){_.e(e)}finally{_.f()}return c.length&&"|"==c[c.length-1]&&c.pop(),A=function(){var e=i.find("p > *");(0===e.length||1===e.length&&e.is("br"))&&0===i.text().replace(/^\s+|\s+$/g,"").length?(i.addClass("mosaic-tile-content-empty"),0===i.find("p").length&&i.empty().append("<p></p>")):i.removeClass("mosaic-tile-content-empty")},E=0,H=function(){clearTimeout(E),E=setTimeout(A,100)},R=t.mosaic.options.tinymce.tiny.paste_as_text||!1,0===r.length&&(R=!0),e.next=32,new p(i,n().extend(!0,{},t.mosaic.options.tinymce,{inline:!1,tiny:{body_id:o,selector:"#"+o,inline:!0,paste_as_text:R,fixed_toolbar_container:"#"+l.attr("id"),ui_container:"#"+l.attr("id"),theme_advanced_toolbar_align:"right",menubar:!1,toolbar:r.join(" ")||!1,statusbar:!1,contextmenu:c.join(" ")||!1,plugins:t.mosaic.options.tinymce.tiny.plugins.concat(c.length?["contextmenu"]:[]),setup:function(e){t.tinymce=e,e.on("focus",(function(e){e.target.id&&(0===n()(".mosaic-helper-tile").length?(t.select(),z()):setTimeout((function(){n()(".mce-edit-focus").each((function(){t.$el.trigger("blur");var e=window.tinyMCE.get(this.getAttribute("id"));e&&e.hide()}))}),10))})),0===r.length&&e.on("keydown",(function(e){13!==e.keyCode||e.preventDefault()})),e.on("keyup change",H),H(),e.on("init",(function(){t.$el.attr("data-tinymce-loaded",!0),!0===t.$el.attr("data-delayed-focus")&&(t.$el.attr("data-delayed-focus",!1),setTimeout((function(){t._focus()}),50))}))}}}));case 32:e.sent,i.addClass("mosaic-rich-text");case 34:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})}],i&&C(t.prototype,i),a&&C(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}(),F=L}}]);
//# sourceMappingURL=83364.666d8e36e47c48bc23b9.min.js.map