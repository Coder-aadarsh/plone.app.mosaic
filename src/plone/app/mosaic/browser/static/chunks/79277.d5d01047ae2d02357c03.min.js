"use strict";(self.webpackChunkplone_mosaic=self.webpackChunkplone_mosaic||[]).push([[79277,41973],{41973:function(e,t,i){i.r(t),i.d(t,{default:function(){return c}});var n=i(99269),a=i.n(n),r=i(81142);function o(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return l(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return o=e.done,e},e:function(e){s=!0,r=e},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw r}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function s(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,this.panels=i}var t,i,n;return t=e,(i=[{key:"initialize",value:function(){var e=".mosaic-original-content";document.querySelector(e).style.display="none",this.modal=new r.Z(document.querySelector("body > .outer-wrapper"),{title:document.querySelector("h1").innerText,target:e,content:"#form",modalSizeClass:"modal-xl"})}},{key:"open",value:function(e,t){var i,n,r,l,s=this;if(s.modal.show(),"all"===e&&s.options.overlay_hide_fields){(i=s.modal.$modal.find("nav")).removeClass("mosaic-hidden"),s.modal.$modal.find("fieldset").children().removeClass("mosaic-hidden"),s.modal.$modal.find("fieldset").removeClass("active"),i.find("a").removeClass("active"),s.modal.$modal.find(s.options.customContentLayout_selector).addClass("mosaic-hidden"),s.modal.$modal.find(s.options.contentLayout_selector).addClass("mosaic-hidden"),a()(".mosaic-IDublinCore-title-tile").length>0?s.modal.$modal.find("#formfield-form-widgets-IDublinCore-title").addClass("mosaic-hidden"):s.modal.$modal.find("#formfield-form-widgets-IDublinCore-title").removeClass("mosaic-hidden"),a()(".mosaic-IDublinCore-description-tile").length>0?s.modal.$modal.find("#formfield-form-widgets-IDublinCore-description").addClass("mosaic-hidden"):s.modal.$modal.find("#formfield-form-widgets-IDublinCore-description").removeClass("mosaic-hidden");var c,d={},u=o(s.options.tiles);try{for(u.s();!(c=u.n()).done;){var f=c.value;if("fields"===f.name){d=f;break}}}catch(e){u.e(e)}finally{u.f()}var h,m=o(d.tiles);try{for(m.s();!(h=m.n()).done;){var p=h.value;0!==s.panels.find(".mosaic-"+p.name+"-tile").length&&a()("#"+p.id).addClass("mosaic-hidden")}}catch(e){m.e(e)}finally{m.f()}s.modal.$modal.find("fieldset").each((function(){0===a()(this).children("div:not(.mosaic-hidden)").length&&a()("a[href=#fieldsetlegend-"+a()(this).attr("id").split("-")[1]+"]").addClass("mosaic-hidden")})),(n=i.children(":not(.mosaic-hidden)")).eq(0).addClass("active");var v=s.modal.$modal.find("#fieldset-"+n.eq(0).attr("href").split("-")[1]);0===v.length&&(v=s.modal.$modal.find("fieldset:not(.mosaic-hidden)").eq(0)),v.addClass("active")}else"field"===e&&(l=(r=a()("#"+t.id)).parents("fieldset"),s.modal.$modal.find("fieldset").removeClass("active"),l.addClass("active"),l.children().addClass("mosaic-hidden"),r.removeClass("mosaic-hidden"),s.modal.$modal.find("nav").addClass("mosaic-hidden"))}}])&&s(t.prototype,i),n&&s(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}()},79277:function(e,t,i){i.r(t);i(35666);var n=i(99269),a=i.n(n),r=i(62832),o=i(72324),l=i(89867),s=i(81142),c=i(79472);i(41973);function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function u(){u=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",r=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function l(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,i){return e[t]=i}}function s(e,t,i,n){var a=t&&t.prototype instanceof h?t:h,r=Object.create(a.prototype),o=new $(n||[]);return r._invoke=function(e,t,i){var n="suspendedStart";return function(a,r){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===a)throw r;return L()}for(i.method=a,i.arg=r;;){var o=i.delegate;if(o){var l=C(o,i);if(l){if(l===f)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===n)throw n="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n="executing";var s=c(e,t,i);if("normal"===s.type){if(n=i.done?"completed":"suspendedYield",s.arg===f)continue;return{value:s.arg,done:i.done}}"throw"===s.type&&(n="completed",i.method="throw",i.arg=s.arg)}}}(e,i,o),r}function c(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var f={};function h(){}function m(){}function p(){}var v={};l(v,a,(function(){return this}));var y=Object.getPrototypeOf,g=y&&y(y(_([])));g&&g!==t&&i.call(g,a)&&(v=g);var w=p.prototype=h.prototype=Object.create(v);function b(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(a,r,o,l){var s=c(e[a],e,r);if("throw"!==s.type){var u=s.arg,f=u.value;return f&&"object"==d(f)&&i.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,o,l)}),(function(e){n("throw",e,o,l)})):t.resolve(f).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,l)}))}l(s.arg)}var a;this._invoke=function(e,i){function r(){return new t((function(t,a){n(e,i,t,a)}))}return a=a?a.then(r,r):r()}}function C(e,t){var i=e.iterator[t.method];if(void 0===i){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,C(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var n=c(i,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,f;var a=n.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function $(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function _(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:L}}function L(){return{value:void 0,done:!0}}return m.prototype=p,l(w,"constructor",p),l(p,"constructor",m),m.displayName=l(p,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,l(e,o,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},b(x.prototype),l(x.prototype,r,(function(){return this})),e.AsyncIterator=x,e.async=function(t,i,n,a,r){void 0===r&&(r=Promise);var o=new x(s(t,i,n,a),r);return e.isGeneratorFunction(i)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(w),l(w,o,"Generator"),l(w,a,(function(){return this})),l(w,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){for(;t.length;){var n=t.pop();if(n in e)return i.value=n,i.done=!1,i}return i.done=!0,i}},e.values=_,$.prototype={constructor:$,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(i,n){return o.type="throw",o.arg=e,t.next=i,n&&(t.method="next",t.arg=void 0),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var r=this.tryEntries[a],o=r.completion;if("root"===r.tryLoc)return n("end");if(r.tryLoc<=this.prev){var l=i.call(r,"catchLoc"),s=i.call(r,"finallyLoc");if(l&&s){if(this.prev<r.catchLoc)return n(r.catchLoc,!0);if(this.prev<r.finallyLoc)return n(r.finallyLoc)}else if(l){if(this.prev<r.catchLoc)return n(r.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return n(r.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var r=a;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,f):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),T(i),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var n=i.completion;if("throw"===n.type){var a=n.arg;T(i)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:_(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),f}},e}function f(e,t,i,n,a,r,o){try{var l=e[r](o),s=l.value}catch(e){return void i(e)}l.done?t(s):Promise.resolve(s).then(n,a)}function h(e){return function(){var t=this,i=arguments;return new Promise((function(n,a){var r=e.apply(t,i);function o(e){f(r,n,a,o,l,"next",e)}function l(e){f(r,n,a,o,l,"throw",e)}o(void 0)}))}}function m(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return p(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,l=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return o=e.done,e},e:function(e){l=!0,r=e},f:function(){try{o||null==i.return||i.return()}finally{if(l)throw r}}}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function v(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var y=l.Z.getLogger("pat-mosaic/tile"),g={},w={delete:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16"><path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"/></svg>',cancel:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/></svg>',confirm:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/></svg>',edit:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16"><path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/><path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/></svg>',settings:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-sliders" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M11.5 2a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM9.05 3a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0V3h9.05zM4.5 7a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM2.05 8a2.5 2.5 0 0 1 4.9 0H16v1H6.95a2.5 2.5 0 0 1-4.9 0H0V8h2.05zm9.45 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm-2.45 1a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0v-1h9.05z"/></svg>'},b=[],x=function(){function e(t,i){var n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o=["table","numbers","bullets","text","subheading","heading"],(r="deprecatedHTMLTiles")in(n=this)?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o;var l=this;l.mosaic=t,l.el=i,l.$el=a()(i),l.$el.is(".mosaic-tile")||(l.$el=l.$el.parents(".mosaic-tile")),l.focusCheckCount=0}var t,n,l,d,f,p,x;return t=e,n=[{key:"getDataTileEl",value:function(){return this.$el.find("[data-tile]")}},{key:"getContentEl",value:function(){return this.$el.children(".mosaic-tile-content")}},{key:"getHtmlContent",value:function(){return this.getContentEl().html()}},{key:"getEditUrl",value:function(){var e=this.getUrl();if(e&&(e=e.replace(/@@/,"@@edit-tile/")))return e.match(/^\.\/.*/)&&(e=this.mosaic.options.context_url+e.replace(/^\./,"")),e}},{key:"getDeleteUrl",value:function(){var e=this.getUrl().split("?")[0],t=(e=e.split("@@"))[1].split("/");return(e=e[0]+"@@delete-tile/"+t[0]+"/"+t[1]).match(/^\.\/.*/)&&(e=this.mosaic.options.context_url+e.replace(/^\./,"")),e}},{key:"getUrl",value:function(){var e=this.$el.find(".tileUrl").html();if(!e){var t=this.$el.find("[data-tileUrl]");t.length>0&&(e=t.attr("data-tileUrl"))}if(e||(e=this.$el.find("[data-tile]").attr("data-tile")),e)for(e=(e=e.replace(this.mosaic.options.context_url,"./")).replace(/^\.\/\//,"./"),this.mosaic.hasContentLayout?-1===e.indexOf("X-Tile-Persistent")&&(-1===e.indexOf("?")?e+="?":e+="&",e+="X-Tile-Persistent=yes"):-1!==e.indexOf("X-Tile-Persistent")&&(e=e.replace("X-Tile-Persistent=yes","").replace("&&","&"));-1!==e.indexOf("&_layouteditor=true");)e=e.replace("&_layouteditor=true","");return e}},{key:"getType",value:function(){var e=this.$el.attr("class");if(e in g)return g[e];var t="";if(void 0!==e){var i,n=m(e.split(" "));try{for(n.s();!(i=n.n()).done;){var a=i.value.match(/^mosaic-([\w.\-]+)-tile$/);null!==a&&"selected"!==a[1]&&"new"!==a[1]&&"read-only"!==a[1]&&"helper"!==a[1]&&"original"!==a[1]&&"edited"!==a[1]&&(t=a[1])}}catch(e){n.e(e)}finally{n.f()}return t?y.info('Found tile type "'.concat(t,'" for in classnames "').concat(e,'"')):y.error("Could not find tile type on element ".concat(this.$el," with classes: ").concat(e)),g[e]=t,t}}},{key:"getConfig",value:function(){var e,t,i=this.getType(),n=m(this.mosaic.options.tiles);try{for(n.s();!(t=n.n()).done;){var a,r=t.value,o=!1,l=m(r.tiles);try{for(l.s();!(a=l.n()).done;){var s=a.value;if("field"===s.tile_type){var c=s.widget.split(".");switch(c=c[c.length-1]){case"TextWidget":case"TextFieldWidget":case"TextAreaWidget":case"TextAreaFieldWidget":case"TextLinesWidget":case"TextLinesFieldWidget":case"WysiwygWidget":case"WysiwygFieldWidget":case"RichTextWidget":case"RichTextFieldWidget":s.settings=!1;break;default:s.settings=!0}}if(s.name===i){e=s,o=!0;break}}}catch(e){l.e(e)}finally{l.f()}if(o)break}}catch(e){n.e(e)}finally{n.f()}return e||(-1===b.indexOf(i)&&(y.error("Could not load tile config for tile type: "+i+" falling back to b/w compatible tile type."),b.push(i)),e={tile_type:"app",name:i,label:"Unknown",read_only:!0,favorite:!1,settings:!1,weight:0,rich_text:!1},-1!==this.deprecatedHTMLTiles.indexOf(i)&&(e.category="structure",e.read_only=!1,e.label=i,e.tile_type="text",e.rich_text=!0)),e}},{key:"getHtmlBody",value:function(e){var t,i="",n=this.$el.attr("class").split(" ");switch(t=this.getType(),n=a()(n).filter((function(){switch(this){case"mosaic-new-tile":case"mosaic-helper-tile":case"mosaic-original-tile":case"mosaic-selected-tile":case"mosaic-edited-tile":return!1;default:return!0}})).toArray(),this.getConfig().tile_type){case"text":i+='<div class="'+n.join(" ")+'">\n',i+='<div class="mosaic-tile-content">\n',i+=this.$el.children(".mosaic-tile-content .mce-content-body").html()+"\n",i+="</div>\n",i+="</div>\n";break;case"app":case"textapp":var r=this.getUrl();if(e){var o=this.$el.children(".mosaic-tile-content .mce-content-body").html()+"\n";-1===r.indexOf("?")?r+="?":r+="&",r+="content="+encodeURI(o)}i+='<div class="'+n.join(" ")+'">\n',i+='<div class="mosaic-tile-content">\n',i+='<div data-tile="'+r+'"></div>\n',i+="</div>\n",i+="</div>\n";break;case"field":i+='<div class="'+n.join(" ")+'">\n',i+='<div class="mosaic-tile-content">\n';var l="./@@plone.app.standardtiles.field?field="+t,s=this.getValueFromClasses(n,"mosaic-subfield-");s&&(l+="&subfield="+s);var c=this.getValueFromClasses(n,"mosaic-format-");c&&(l+="&format="+c),i+='<div data-tile="'+l+'"></div>\n',i+="</div>\n",i+="</div>\n",this.saveForm()}return i}},{key:"isRichText",value:function(e){return!(this.$el.hasClass("mosaic-read-only-tile")||(void 0===e&&(e=this.getConfig()),!e||!("text"===e.tile_type&&e.rich_text||"textapp"===e.tile_type&&e.rich_text||"app"===e.tile_type&&e.rich_text)&&("field"!==e.tile_type||e.read_only||"plone.app.z3cform.widget.RichTextFieldWidget"!==e.widget&&"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"!==e.widget&&"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"!==e.widget&&"plone.app.widgets.dx.RichTextWidget"!==e.widget)))}},{key:"initialize",value:(x=h(u().mark((function e(){var t,i,n,r,o,l,s,c,d,f;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for((i=(t=this).getConfig())&&i.read_only&&t.$el.addClass("mosaic-read-only-tile"),t.$el.prepend(a()(t.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(a()(t.mosaic.document.createElement("div")).addClass("mosaic-tile-inner-border"))),i&&(n=a()(t.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-tile-side-tools"),t.$el.prepend(n.append(a()(t.mosaic.document.createElement("div")).addClass("mosaic-tile-label content").html(i.label))),t.$el.parent().hasClass("col")||(r=t.$el.parent().attr("class").split(" "),o=t.getValueFromClasses(r,"col-"),l=void 0===o?"":" ("+o+")",s=function(e){var t=document.createElement("a");return t.href="javascript:",t.textContent="Reset"+l,a()(t).on("click",e),t},n.append(a()(t.mosaic.document.createElement("div")).addClass("mosaic-tile-label reset").append(s(t.resetClicked.bind(this))).hide()))),t.makeMovable(),t.initializeButtons(),c=0,d=["top","bottom","right","left"];c<d.length;c++)f=d[c],t.$el.prepend(a()(t.mosaic.document.createElement("div")).addClass("mosaic-divider mosaic-divider-"+f).append(a()(t.mosaic.document.createElement("div")).addClass("mosaic-divider-dot")));t.el["mosaic-tile"]=t,t.$el.data("mosaic-tile",t);case 11:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"resetClicked",value:function(e){e.preventDefault(),this.$el.parent().removeClass("col-1 col-2 col-3 col-4 col-5 col-6 col-7 col-8 col-9 col-10 col-11 col-12").addClass("col"),a()(e.target).closest(".reset").remove();var t=this.$el.parent().parent();t.mosaicCleanupRow(),t.mosaicSetResizeHandles()}},{key:"initializeButtons",value:function(){var e=[],t=this.getConfig();this.$el.find(".mosaic-tile-buttons").remove();var i=function(t,i,n){var r=document.createElement("button");return r.className="btn btn-sm btn-".concat("confirm"===i?"danger":"light"," mosaic-btn-").concat(i),r.textContent=t,e.push(r),a()(r).on("click",n),i in w?a()(r).prepend(w[i]+" "):y.warn('could not find button icon "'.concat(i,'"')),r};if(t&&t.settings&&!1===this.$el.hasClass("mosaic-read-only-tile")&&i("Edit","settings",this.settingsClicked.bind(this)),!this.mosaic.hasContentLayout){i("Delete","delete",this.deleteClicked.bind(this));var n=i("Confirm delete","confirm",this.confirmClicked.bind(this));a()(n).hide();var r=i("Cancel","cancel",this.cancelClicked.bind(this));a()(r).hide()}if(e.length>0){var o,l=a()("<div />").addClass("mosaic-tile-control mosaic-tile-buttons"),s=m(e);try{for(s.s();!(o=s.n()).done;){var c=o.value;l.append(c)}}catch(e){s.e(e)}finally{s.f()}this.$el.prepend(l)}}},{key:"cancelClicked",value:function(e){e.preventDefault(),a()(".mosaic-btn-settings,.mosaic-btn-delete",this.$el).show(),a()(".mosaic-btn-cancel,.mosaic-btn-confirm",this.$el).hide()}},{key:"deleteClicked",value:function(e){e.preventDefault(),a()(".mosaic-btn-settings,.mosaic-btn-delete",this.$el).hide(),a()(".mosaic-btn-cancel,.mosaic-btn-confirm",this.$el).show()}},{key:"confirmClicked",value:function(e){e.preventDefault();var t=this,i=this.getConfig();if("app"===i.tile_type||"textapp"===i.tile_type){var n=this.getUrl();n&&"undefined"!==n&&(this.mosaic.removeHeadTags(n),this.mosaic.queue((function(e){a().ajax({type:"POST",url:t.getDeleteUrl(),data:{"buttons.delete":"Delete",_authenticator:r.Z.getAuthenticator()}}).always((function(){e()}))})))}this.mosaic.panels.find(".mosaic-empty-row").remove();var o=this.$el.parent().parent();this.saveForm(),this.$el.remove(),o.mosaicCleanupRow(),this.mosaic.panels.mosaicAddEmptyRows(),this.mosaic.toolbar.SelectedTileChange()}},{key:"settingsClicked",value:function(e){e.preventDefault();var t=this,i=t.getConfig();if("app"===i.tile_type){var n=t.getEditUrl(),r=new s.Z(a()(".mosaic-toolbar"),{ajaxUrl:n,loadLinksWithinModal:!0});r.$el.off("after-render"),r.on("after-render",(function(e){a()('input[name*="cancel"]',r.$modal).on("click",(function(e){e.preventDefault(),r.hide(),r=null})),t.mosaic.hasContentLayout&&a()("form",r.$modal).append(a()('<input type="hidden" name="X-Tile-Persistent" value="yes" />'))})),r.show(),r.$el.off("formActionSuccess"),r.on("formActionSuccess",(function(e,i,n,a,o){var l=a.getResponseHeader("X-Tile-Url"),s=t.mosaic.getDomTreeFromHtml(i);if(l){t.mosaic.removeHeadTags(l),t.mosaic.addHeadTags(l,s);var c=s.find(".temp_body_tag").html();t.fillContent({html:c,url:l}),r.hide(),r=null}}))}else t.mosaic.overlay.open("field",i)}},{key:"makeMovable",value:function(){this.$el.hasClass("movable")&&this.mosaic.options.canChangeLayout&&!this.mosaic.hasContentLayout&&this.$el.prepend(a()(this.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-drag-handle"))}},{key:"getValueFromClasses",value:function(e,t){var i;return e.forEach((function(e){-1!==e.indexOf(t)&&(i=e.replace(t,""))})),i}},{key:"initializeContent",value:(p=h(u().mark((function e(){var t,i,n,r,o,l,s,c,d,f,m,p;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this,(s=a()("body",t.mosaic.document).attr("data-base-url"))||(s=a()("head > base",t.mosaic.document).attr("href")),c=this.getUrl(),"field"!==(d=this.getConfig()).tile_type){e.next=35;break}l="","IDublinCore-title"===d.name?(n='<h1 class="documentFirstHeading">',r="</h1>"):"IDublinCore-description"===d.name?(n='<p class="documentDescription">',r="</p>"):(n="<div>",r="</div>"),f=!1,m=!1,e.t0=d.widget,e.next="z3c.form.browser.text.TextWidget"===e.t0||"z3c.form.browser.text.TextFieldWidget"===e.t0?13:"z3c.form.browser.textarea.TextAreaWidget"===e.t0||"z3c.form.browser.textarea.TextAreaFieldWidget"===e.t0||"z3c.form.browser.textlines.TextLinesWidget"===e.t0||"z3c.form.browser.textlines.TextLinesFieldWidget"===e.t0?18:"plone.app.z3cform.widget.RichTextFieldWidget"===e.t0||"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"===e.t0||"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"===e.t0||"plone.app.widgets.dx.RichTextWidget"===e.t0?25:29;break;case 13:return o=a()("#"+d.id).find("input").attr("value"),l="".concat(n).concat(o).concat(r),f=!0,y.info('initialized TextWidget with val "'.concat(o,'"')),e.abrupt("break",32);case 18:return o=a()("#"+d.id).find("textarea").val().split("\n"),l+=n,l+=o.join("<br/>"),l+=r,f=!0,y.info('initialized Text[Area|Lines]Widget with val "'.concat(o,'"')),e.abrupt("break",32);case 25:return l=document.querySelectorAll("#".concat(d.id," textarea"))[0].value,m=!0,y.info('initialized RichTextWidget with val "'.concat(l,'"')),e.abrupt("break",32);case 29:return l='<div class="discreet">Placeholder for field:<br/><b>'+d.label+"</b></div>",y.info("initialized fallback field"),e.abrupt("break",32);case 32:t.fillContent({html:l,editable:!d.read_only&&f,wysiwyg:m}),e.next=36;break;case 35:d&&(t.$el.addClass("mosaic-tile-loading"),i=s?[s,c].join("/").replace(/\/+\.\//g,"/"):c,p=i,-1===i.indexOf("?")?i+="?":i+="&",-1===i.indexOf("_layouteditor")&&(i+="_layouteditor=true"),a().ajax({type:"POST",url:i,success:function(){var e=h(u().mark((function e(i){var n,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.$el.removeClass("mosaic-tile-loading"),i=t.mosaic.getDomTreeFromHtml(i),t.mosaic.addHeadTags(c,i),n=i.find(".temp_body_tag").html(),a=t.getType(),t.fillContent({html:n,url:p,wysiwyg:"plone.app.standardtiles.html"===a});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),error:function(){t.$el.removeClass("mosaic-tile-loading"),y.error("Error getting data for the tile "+d.label+"("+d.name+"). Please read documentation on how to correctly register tiles: https://pypi.python.org/pypi/plone.tiles")}}));case 36:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"fillContent",value:(f=h(u().mark((function e(t){var i,n,a,r,o,l;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.html,n=t.url,a=t.editable,r=t.wysiwyg,(o=this.getDataTileEl()).length>0?(o.parent().html(i),l=this.getContentEl()):(l=this.getContentEl()).html(i),a&&l.attr("contenteditable",!0),n&&l.length>0){for(n=n.replace(/&/gim,"&amp;");-1!==n.indexOf("&amp;&amp;");)n=n.replace("&amp;&amp;","&amp;");l.attr("data-tileUrl",n)}if(!r){e.next=8;break}return e.next=8,this.setupWysiwyg();case 8:this.cacheHtml(i),this.scanRegistry();case 10:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"cacheHtml",value:function(e){if(!this.isRichText()){var t=this.$el.children(".mosaic-tile-content");0!==t.length&&(void 0===e&&(e=t.html()),t[0]._preScanHTML=e)}}},{key:"scanRegistry",value:function(){var e=this.$el.find(".mosaic-tile-content");0!==e.length&&(e[0]._preScanHTML&&e.html(e[0]._preScanHTML),c.Z.scan(e),a()("a",e).on("click",(function(e){e.preventDefault(),e.stopPropagation()})))}},{key:"select",value:function(){var e=this;!1===e.$el.hasClass("mosaic-selected-tile")&&!1===e.$el.hasClass("mosaic-read-only-tile")&&(a()(".mosaic-selected-tile").each((function(){a()(this).data("mosaic-tile").blur()})),e.focus())}},{key:"blur",value:function(){y.info("Blur ".concat(this.getType())),this.$el.removeClass("mosaic-selected-tile"),this.saveForm()}},{key:"focus",value:function(){var e=this;y.info("Focus ".concat(this.getType())),e.$el.addClass("mosaic-selected-tile"),e.$el.find(".mce-content-body").trigger("focus"),e.initializeButtons()}},{key:"saveForm",value:function(){var e=this,t=e.getType(),i=e.getConfig();if(i&&!0!==i.read_only)if(y.info("Save form ".concat(t," -> <").concat(i.tile_type," (").concat(i.widget,")>")),"field"===i.tile_type){switch(i.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":var n=a()(".mosaic-panel .mosaic-".concat(t,"-tile"),e.mosaic.document);l=n.find(".mosaic-tile-content > *").text(),a()("#"+i.id).find("input").val(l);break;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":if(l="",a()(".mosaic-panel .mosaic-".concat(t,"-tile"),e.mosaic.document).find(".mosaic-tile-content > *").each((function(){l+=a()(this).text()})),l=l.replace(/^\s+|\s+$/g,""),!(o=document.querySelector("#".concat(i.id," textarea")))){y.error('No textarea with id "'.concat(tile_condig.id,'" found'));break}o.innerText=l;break;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":var o;if(!(o=document.querySelector("#".concat(i.id," textarea")))){y.error('No textarea with id "'.concat(i.id,'" found'));break}var l=this.tinymce?this.tinymce.getContent():a()(".mosaic-".concat(t,"-tile .mosaic-tile-content"),e.mosaic.document).html();o.innerText=l,o["pattern-tinymce"].instance.tiny.setContent(l)}y.info('Saved "'.concat(l,'"'))}else if("textapp"===i.tile_type){var s=e.getEditUrl();if(s){var c=e.getHtmlContent();if(c===e.$el.data("lastSavedData"))return;if(e.$el.data("activeSave"))return;r.Z.loading.show(),e.$el.data("activeSave",!0);var d={_authenticator:r.Z.getAuthenticator(),"buttons.save":"Save"};d[i.name+".content"]=c,e.mosaic.queue((function(t){a().ajax({url:s,method:"POST",data:d}).always((function(){e.$el.data("lastSavedData",c),e.$el.data("activeSave",!1),r.Z.loading.hide(),t()}))}))}}}},{key:"setupWysiwyg",value:(d=h(u().mark((function e(){var t,n,a,r,l,s,c,d;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=(t=this).$el.find(".mosaic-tile-content")).length){e.next=5;break}return y.info("No wysiwg initializable content found!"),e.abrupt("return");case 5:return a=o.Z.generate_uid(),r="mosaic-rich-text-init-"+a,n.attr("id",r),l=t.getType(),-1!==this.deprecatedHTMLTiles.indexOf(l)&&(l="plone.app.standardtiles.html"),s=function(){var e=n.find("p > *");(0===e.length||1===e.length&&e.is("br"))&&0===n.text().replace(/^\s+|\s+$/g,"").length?(n.addClass("mosaic-tile-content-empty"),0===n.find("p").length&&n.empty().append("<p></p>")):n.removeClass("mosaic-tile-content-empty")},e.next=13,i.e(96870).then(i.bind(i,96870));case 13:c=e.sent.default,(d=JSON.parse(JSON.stringify(t.mosaic.options.tinymce))).tiny.inline=!0,d.tiny.menubar=!1,d.tiny.selector="#".concat(r),d.tiny.placeholder=s,d.tiny.toolbar="code | "+d.tiny.toolbar,t.tinymce=new c(n,d),t.tinymce.init(),y.info('Setup wysiwyg for "'.concat(r,'"')),n.addClass("mosaic-rich-text-initialized");case 24:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})}],n&&v(t.prototype,n),l&&v(t,l),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.default=x},72324:function(e,t){t.Z={generate_uid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}}}}]);
//# sourceMappingURL=79277.d5d01047ae2d02357c03.min.js.map