"use strict";(self.webpackChunkplone_mosaic=self.webpackChunkplone_mosaic||[]).push([[27700,41973],{27700:function(e,t,o){o.r(t);var n=o(99269),i=o.n(n),a=o(89867),r=o(72324),s=o(46562),l=o(62832);o(41973);function c(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return u(e,t)}(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,s=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return r=e.done,e},e:function(e){s=!0,a=e},f:function(){try{r||null==o.return||o.return()}finally{if(s)throw a}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}function f(e,t,o,n,i,a,r){try{var s=e[a](r),l=s.value}catch(e){return void o(e)}s.done?t(l):Promise.resolve(l).then(n,i)}function d(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var m=a.Z.getLogger("pat-mosaic/actions"),h=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mosaic=t,this.actions=[],this.shortcuts=[]}var t,o,n,a,u;return t=e,o=[{key:"registerAction",value:function(e,t){t=i().extend({exec:function(){},shortcut:{ctrl:!1,alt:!1,shift:!1,key:""},visible:function(e){return!0}},t),this.actions[e]=t,""!==t.shortcut.key&&(t.shortcut.charCode=t.shortcut.key.toUpperCase().charCodeAt(0),t.shortcut.action=e,this.shortcuts.push(t.shortcut))}},{key:"execAction",value:function(e,t){var o=this;if(m.info("Exec ".concat(e)),e in o.actions)return o.actions[e].exec(t);m.error("Action ".concat(e,' not in "').concat(o.actions,'"'))}},{key:"getPrefixedClassName",value:function(e){return e.indexOf("-")>-1?"mosaic-"+e:"mosaic"+e.charAt(0).toUpperCase()+e.slice(1)}},{key:"initActions",value:(a=regeneratorRuntime.mark((function e(){var t,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=(t=this).mosaic,t.registerAction("tile-toggle-class",{exec:function(){var e;arguments.length>0&&arguments[0].value&&(e=t.getPrefixedClassName(arguments[0].value),i()(".mosaic-selected-tile",o.document).toggleClass(e))}}),t.registerAction("tile-remove-format",{exec:function(){var e,n,a,r,s;for(e=0;e<o.options.formats.length;e++)for(a=o.options.formats[e],n=0;n<a.actions.length;n++)"tile"===(r=a.actions[n]).category&&(s=t.getPrefixedClassName(r.name),i()(".mosaic-selected-tile",o.document).removeClass(s))}}),t.registerAction("row-toggle-class",{exec:function(){var e;arguments.length>0&&arguments[0].value&&(e=t.getPrefixedClassName(arguments[0].value),i()(".mosaic-selected-tile",o.document).parents(".mosaic-grid-row").first().toggleClass(e))}}),t.registerAction("row-remove-format",{exec:function(){var e,n,a,r,s;for(e=0;e<o.options.formats.length;e++)for(a=o.options.formats[e],n=0;n<a.actions.length;n++)"row"===(r=a.actions[n]).category&&(s=t.getPrefixedClassName(r.name),i()(".mosaic-selected-tile",o.document).parents(".mosaic-grid-row").first().removeClass(s).removeClass(r.name))}}),t.registerAction("tile-align-block",{exec:function(){i()(".mosaic-selected-tile",o.document).removeClass("mosaic-tile-align-right").removeClass("mosaic-tile-align-left")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"b"}}),t.registerAction("tile-align-left",{exec:function(){i()(".mosaic-selected-tile",o.document).removeClass("mosaic-tile-align-right").addClass("mosaic-tile-align-left")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"l"}}),t.registerAction("tile-align-right",{exec:function(){i()(".mosaic-selected-tile",o.document).removeClass("mosaic-tile-align-left").addClass("mosaic-tile-align-right")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"r"}}),t.registerAction("save",{exec:function(){o.saving=!0,t.blurSelectedTile(),o.toolbar.SelectedTileChange(),o.queue((function(e){o.layoutManager.saveLayoutToForm(),i()("#form-buttons-save").trigger("click"),o.saving=!1,e()}))},shortcut:{ctrl:!0,alt:!1,shift:!1,key:"s"}}),t.registerAction("cancel",{exec:function(){i()("#form-buttons-cancel").trigger("click")}}),t.registerAction("preview",{exec:function(){i()("#form-widgets-ILayoutAware-customContentLayout, [name='form.widgets.ILayoutAware.customContentLayout']").trigger("focus").trigger("focusout"),setTimeout((function(){window.open(o.options.context_url+"/@@layout_preview","_blank")}),1e3)}}),t.registerAction("html",{exec:function(){var e,t,n;0===(e=i()(".mosaic-selected-tile",o.document).children(".mosaic-tile-content")).find(".mosaic-rich-text-textarea").length&&(t=e.html(),n=e.height(),e.empty(),e.prepend(i()(o.document.createElement("textarea")).addClass("mosaic-rich-text-textarea").html(i().trim(t)).height(n)))}}),t.registerAction("properties",{exec:function(){o.overlay.open("all")}}),t.registerAction("layout",{exec:function(){i()(".mosaic-button-group-layout").toggleClass("active")},visible:function(){return!0}}),t.registerAction("customizelayout",{exec:function(){o.setSelectedContentLayout(""),i()(".mosaic-toolbar-secondary-functions").removeClass("d-none"),i()(".mosaic-button-customizelayout").hide(),i()(".mosaic-button-savelayout").show(),i()(".mosaic-panel .mosaic-tile",o.document).each((function(){var e=i()(this).data("mosaic-tile");e.makeMovable(),e.$el.mosaicAddDrag()})),i()(".mosaic-button-group-layout").removeClass("active")},visible:function(){return o.options.canChangeLayout}}),t.registerAction("changelayout",{exec:function(){var e=o.hasContentLayout;e||(e=confirm("Changing your layout will destroy all existing custom layout settings you have in place. Are you sure you want to continue?")),e&&o.selectLayout(),i()(".mosaic-button-group-layout").removeClass("active")},visible:function(){return o.options.available_layouts.length>0}}),t.registerAction("savelayout",{exec:function(){o.saveLayout(),i()(".mosaic-button-group-layout").removeClass("active")},visible:function(){return!0}}),t.registerAction("add-tile",{exec:function(){new s.Z(i()(".mosaic-toolbar"),{ajaxUrl:o.options.context_url+"/@@add-tile?form.button.Create=Create"}).show()}}),t.registerAction("format",{exec:function(e){t.execAction(i()(e).val())}}),t.registerAction("insert",{exec:function(e){var n,a;if("none"===i()(e).val())return!1;a=i()(e).val(),t.blurSelectedTile(),o.toolbar.SelectedTileChange();var u,f=c(o.options.tiles);try{for(f.s();!(u=f.n()).done;){var d,m=c(u.value.tiles);try{for(m.s();!(d=m.n()).done;){var h=d.value;h.name===a&&(n=h)}}catch(e){m.e(e)}finally{m.f()}}}catch(e){f.e(e)}finally{f.f()}if("textapp"===n.tile_type){var v=r.Z.generate_uid(),g=o.options.context_url+"/@@"+a+"/"+v,p="<html><body>"+o.layoutManager.getDefaultValue(n)+"</body></html>";o.layoutManager.addAppTileHTML(a,p,g)}else if("app"===n.tile_type){var y=!0;l.Z.loading.show(),i().ajax({type:"GET",url:o.options.context_url+"/@@add-tile?tiletype="+a+"&form.button.Create=Create",success:function(e,t){var n,r,c,u;l.Z.loading.hide(),r=(n=i()(e)).find("#add_tile").attr("action"),c=n.find('[name="_authenticator"]').val(),u=function(e){o.overlay.app=new s.Z(i()(".mosaic-toolbar"),{html:e,loadLinksWithinModal:!0,buttons:'.formControls > button[type="submit"], .actionButtons > button[type="submit"]'}),o.overlay.app.$el.off("after-render"),o.overlay.app.on("after-render",(function(e){y&&(i()(".field.error",o.overlay.app.$modal).removeClass("error"),i()(".fieldErrorBox,.portalMessage",o.overlay.app.$modal).remove(),y=!1),i()('input[name*="cancel"]',o.overlay.app.$modal).off("click").on("click",(function(){o.overlay.app.hide(),o.overlay.app=null}))})),o.overlay.app.show(),o.overlay.app.$el.off("formActionSuccess"),o.overlay.app.on("formActionSuccess",(function(e,t,n,i){var r=i.getResponseHeader("X-Tile-Url");r&&(o.layoutManager.addAppTileHTML(a,t,r),o.overlay.app.hide(),o.overlay.app=null)}))},i()("form .required",n).filter((function(){var e=i()(this).parents(".field").first().find("input, select, textarea").not('[type="hidden"]').last().val();return null===e||0===e.length})).length>0?u(e):r&&i()("form",n).ajaxSubmit({type:"POST",url:r,data:{"buttons.save":"Save",_authenticator:c},success:function(e,t,n){var i=n.getResponseHeader("X-Tile-Url");i?o.layoutManager.addAppTileHTML(a,e,i):u(e)}})}})}else o.layoutManager.addTile(a,o.layoutManager.getDefaultValue(n));return!0}}),i()(document).on("keypress",(function(e){var t="";return i()(o.actionManager.shortcuts).each((function(){e.ctrlKey!==this.ctrl&&(-1===navigator.userAgent.toLowerCase().indexOf("macintosh")||e.metaKey!==this.ctrl)||e.altKey!==this.alt&&void 0!==e.altKey||e.shiftKey!==this.shift||!e.charCode||String.fromCharCode(e.charCode).toUpperCase().charCodeAt(0)!==this.charCode||(t=this.action)})),""===t||(o.actionManager.actions[t].exec(),!1)})),m.info("Initialized Actions");case 23:case"end":return e.stop()}}),e,this)})),u=function(){var e=this,t=arguments;return new Promise((function(o,n){var i=a.apply(e,t);function r(e){f(i,o,n,r,s,"next",e)}function s(e){f(i,o,n,r,s,"throw",e)}r(void 0)}))},function(){return u.apply(this,arguments)})},{key:"blurSelectedTile",value:function(){i()(".mosaic-selected-tile",this.mosaic.document).each((function(){i()(this).data("mosaic-tile").blur()}))}},{key:"mosaicExecAction",value:function(){return this.each((function(){""!==i()(this).data("action")&&i().mosaic.actionManager.actions[i()(this).data("action")].exec(this)}))}}],o&&d(t.prototype,o),n&&d(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.default=h},41973:function(e,t,o){o.r(t),o.d(t,{default:function(){return c}});var n=o(99269),i=o.n(n),a=o(46562);function r(e,t){var o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);"Object"===o&&e.constructor&&(o=e.constructor.name);if("Map"===o||"Set"===o)return Array.from(e);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,l=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return r=e.done,e},e:function(e){l=!0,a=e},f:function(){try{r||null==o.return||o.return()}finally{if(l)throw a}}}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}function l(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c=function(){function e(t,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,this.panels=o}var t,o,n;return t=e,(o=[{key:"initialize",value:function(){var e=i()(".mosaic-original-content");this.form=i()("form",e),e.hide(),this.modal=new a.Z(i()(".outer-wrapper"),{title:i()("h1",e).text(),target:".mosaic-original-content form",modalSizeClass:"modal-xl"})}},{key:"open",value:function(e,t){var o,n,a,s,l=this;if(l.modal.show(),"all"===e&&l.options.overlay_hide_fields){(o=l.form.find("nav")).removeClass("mosaic-hidden"),l.form.find("fieldset").children().removeClass("mosaic-hidden"),l.form.find("fieldset").removeClass("active"),o.find("a").removeClass("active"),l.form.find(l.options.customContentLayout_selector).addClass("mosaic-hidden"),l.form.find(l.options.contentLayout_selector).addClass("mosaic-hidden"),i()(".mosaic-IDublinCore-title-tile").length>0?l.form.find("#formfield-form-widgets-IDublinCore-title").addClass("mosaic-hidden"):l.form.find("#formfield-form-widgets-IDublinCore-title").removeClass("mosaic-hidden"),i()(".mosaic-IDublinCore-description-tile").length>0?l.form.find("#formfield-form-widgets-IDublinCore-description").addClass("mosaic-hidden"):l.form.find("#formfield-form-widgets-IDublinCore-description").removeClass("mosaic-hidden");var c,u={},f=r(l.options.tiles);try{for(f.s();!(c=f.n()).done;){var d=c.value;if("fields"===d.name){u=d;break}}}catch(e){f.e(e)}finally{f.f()}var m,h=r(u.tiles);try{for(h.s();!(m=h.n()).done;){var v=m.value;0!==l.panels.find(".mosaic-"+v.name+"-tile").length&&i()("#"+v.id).addClass("mosaic-hidden")}}catch(e){h.e(e)}finally{h.f()}l.form.find("fieldset").each((function(){0===i()(this).children("div:not(.mosaic-hidden)").length&&i()("a[href=#fieldsetlegend-"+i()(this).attr("id").split("-")[1]+"]").addClass("mosaic-hidden")})),(n=o.children(":not(.mosaic-hidden)")).eq(0).addClass("active");var g=l.form.find("#fieldset-"+n.eq(0).attr("href").split("-")[1]);0===g.length&&(g=l.form.find("fieldset:not(.mosaic-hidden)").eq(0)),g.addClass("active")}else"field"===e&&(s=(a=i()("#"+t.id)).parents("fieldset"),l.form.find("fieldset").removeClass("active"),s.addClass("active"),s.children().addClass("mosaic-hidden"),a.removeClass("mosaic-hidden"),l.form.find("nav").addClass("mosaic-hidden"))}}])&&l(t.prototype,o),n&&l(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}()},72324:function(e,t){t.Z={generate_uid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}}}}]);
//# sourceMappingURL=27700.a1871863d99643236dce.min.js.map