{"version":3,"file":"chunks/99558.2e943188a23c0a419ada.min.js","mappings":"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","sources":["webpack://plone-mosaic/./node_modules/@plone/mockup/src/pat/select2/select2.js","webpack://plone-mosaic/./node_modules/@plone/mockup/src/pat/relateditems/relateditems.js","webpack://plone-mosaic/./node_modules/@plone/mockup/src/pat/autotoc/autotoc.js","webpack://plone-mosaic/./node_modules/@plone/mockup/src/pat/tinymce/js/links.js","webpack://plone-mosaic/./node_modules/@plone/mockup/src/pat/upload/upload.js"],"sourcesContent":["import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport I18n from \"../../core/i18n\";\nimport utils from \"../../core/utils\";\n\nexport default Base.extend({\n    name: \"select2\",\n    trigger: \".pat-select2\",\n    parser: \"mockup\",\n    defaults: {\n        separator: \",\",\n    },\n    initializeValues: function () {\n        var self = this;\n        // Init Selection ---------------------------------------------\n        if (self.options.initialValues) {\n            self.options.id = function (term) {\n                return term.id;\n            };\n            self.options.initSelection = function ($el, callback) {\n                var data = [],\n                    value = $el.val(),\n                    seldefaults = self.options.initialValues;\n\n                // Create the initSelection value that contains the default selection,\n                // but in a javascript object\n                if (\n                    typeof self.options.initialValues === \"string\" &&\n                    self.options.initialValues !== \"\"\n                ) {\n                    // if default selection value starts with a '{', then treat the value as\n                    // a JSON object that needs to be parsed\n                    if (self.options.initialValues[0] === \"{\") {\n                        seldefaults = JSON.parse(self.options.initialValues);\n                    }\n                    // otherwise, treat the value as a list, separated by the defaults.separator value of\n                    // strings in the format \"id:text\", and convert it to an object\n                    else {\n                        seldefaults = {};\n                        $(self.options.initialValues.split(self.options.separator)).each(\n                            function () {\n                                var selection = this.split(\":\");\n                                var id = $.trim(selection[0]);\n                                var text = $.trim(selection[1]);\n                                seldefaults[id] = text;\n                            }\n                        );\n                    }\n                }\n\n                $(value.split(self.options.separator)).each(function () {\n                    var text = this;\n                    if (seldefaults[this]) {\n                        text = seldefaults[this];\n                    }\n                    data.push({\n                        id: utils.removeHTML(this),\n                        text: utils.removeHTML(text),\n                    });\n                });\n                callback(data);\n            };\n        }\n    },\n    initializeTags: function () {\n        var self = this;\n        if (self.options.tags && typeof self.options.tags === \"string\") {\n            if (self.options.tags.substr(0, 1) === \"[\") {\n                self.options.tags = JSON.parse(self.options.tags);\n            } else {\n                self.options.tags = self.options.tags.split(self.options.separator);\n            }\n        }\n\n        if (self.options.tags && !self.options.allowNewItems) {\n            self.options.data = $.map(self.options.tags, function (value, i) {\n                return { id: value, text: value };\n            });\n            self.options.multiple = true;\n            delete self.options.tags;\n        }\n    },\n    initializeOrdering: async function () {\n        if (!this.options.orderable) {\n            return;\n        }\n        const Sortable = (await import(\"sortablejs\")).default;\n        const _initializeOrdering = () => {\n            const sortable_el = this.$select2[0].querySelector(\".select2-choices\");\n            new Sortable(sortable_el, {\n                draggable: \"li\",\n                dragClass: \"select2-choice-dragging\",\n                chosenClass: \"dragging\",\n                onStart: () => this.$el.select2(\"onSortStart\"),\n                onEnd: () => this.$el.select2(\"onSortEnd\"),\n            });\n        };\n        this.$el.on(\"change\", _initializeOrdering.bind(this));\n        _initializeOrdering();\n    },\n    initializeSelect2: async function () {\n        import(\"select2/select2.css\");\n        import(\"./select2.scss\");\n        await import(\"select2\");\n        try {\n            await import(`select2/select2_locale_${this.options.language}`);\n        } catch {\n            console.warn(\"Language file could not be loaded\", this.options.language);\n        }\n\n        var self = this;\n        self.options.formatResultCssClass = function (ob) {\n            if (ob.id) {\n                return (\n                    \"select2-option-\" +\n                    ob.id.toLowerCase().replace(/[ \\:\\)\\(\\[\\]\\{\\}\\_\\+\\=\\&\\*\\%\\#]/g, \"-\")\n                );\n            }\n        };\n\n        function callback(action, e) {\n            if (action) {\n                if (self.options.debug) {\n                    console.debug(\"callback\", action, e);\n                }\n                if (typeof action === \"string\") {\n                    action = window[action];\n                }\n                return action(e);\n            } else {\n                return action;\n            }\n        }\n        $(self.el).select2(self.options);\n        self.$el.on(\"select2-selected\", function (e) {\n            callback(self.options.onSelected, e);\n        });\n        self.$el.on(\"select2-selecting\", function (e) {\n            callback(self.options.onSelecting, e);\n        });\n        self.$el.on(\"select2-deselecting\", function (e) {\n            callback(self.options.onDeselecting, e);\n        });\n        self.$el.on(\"select2-deselected\", function (e) {\n            callback(self.options.onDeselected, e);\n        });\n        self.$select2 = self.$el.parent().find(\".select2-container\");\n        self.$el.parent().off(\"close.plone-modal.patterns\");\n        if (self.options.orderable) {\n            self.$select2.addClass(\"select2-orderable\");\n        }\n    },\n    opened: function () {\n        var self = this;\n        var isOpen = $(\".select2-dropdown-open\", self.$el.parent()).length === 1;\n        return isOpen;\n    },\n    init: async function () {\n        var self = this;\n\n        var i18n = new I18n();\n        self.options.language = i18n.currentLanguage;\n        self.options.allowNewItems = self.options.hasOwnProperty(\"allowNewItems\")\n            ? JSON.parse(self.options.allowNewItems)\n            : true;\n\n        if (self.options.ajax || self.options.vocabularyUrl) {\n            if (self.options.vocabularyUrl) {\n                self.options.multiple =\n                    self.options.multiple === undefined ? true : self.options.multiple;\n                self.options.ajax = self.options.ajax || {};\n                self.options.ajax.url = self.options.vocabularyUrl;\n                // XXX removing the following function does'nt break tests. dead code?\n                self.options.initSelection = function ($el, callback) {\n                    var data = [],\n                        value = $el.val();\n                    $(value.split(self.options.separator)).each(function () {\n                        var val = utils.removeHTML(this);\n                        data.push({ id: val, text: val });\n                    });\n                    callback(data);\n                };\n            }\n\n            var queryTerm = \"\";\n            self.options.ajax = $.extend(\n                {\n                    quietMillis: 300,\n                    data: function (term, page) {\n                        queryTerm = term;\n                        return {\n                            query: term,\n                            page_limit: 10,\n                            page: page,\n                        };\n                    },\n                    results: function (data, page) {\n                        var results = data.results;\n                        if (self.options.vocabularyUrl) {\n                            var dataIds = [];\n                            $.each(data.results, function (i, item) {\n                                dataIds.push(item.id);\n                            });\n                            results = [];\n\n                            var haveResult =\n                                queryTerm === \"\" || $.inArray(queryTerm, dataIds) >= 0;\n                            if (self.options.allowNewItems && !haveResult) {\n                                queryTerm = utils.removeHTML(queryTerm);\n                                results.push({\n                                    id: queryTerm,\n                                    text: queryTerm,\n                                });\n                            }\n\n                            $.each(data.results, function (i, item) {\n                                results.push(item);\n                            });\n                        }\n                        return { results: results };\n                    },\n                },\n                self.options.ajax\n            );\n        } else if (self.options.multiple && self.$el.is(\"select\")) {\n            // Multiselects need to be converted to input[type=hidden]\n            // for Select2\n            var vals = self.$el.val() || [];\n            var options = $.map(self.$el.find(\"option\"), function (o) {\n                return { text: $(o).html(), id: o.value };\n            });\n            var $hidden = $('<input type=\"hidden\" />');\n            $hidden.val(vals.join(self.options.separator));\n            $hidden.attr(\"class\", self.$el.attr(\"class\"));\n            $hidden.attr(\"name\", self.$el.attr(\"name\"));\n            $hidden.attr(\"id\", self.$el.attr(\"id\"));\n            self.$orig = self.$el;\n            self.$el.replaceWith($hidden);\n            self.$el = $hidden;\n            self.options.data = options;\n        }\n\n        self.initializeValues();\n        self.initializeTags();\n        await self.initializeSelect2();\n        await self.initializeOrdering();\n    },\n});\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport _t from \"../../core/i18n-wrapper\";\nimport utils from \"../../core/utils\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\nimport Select2 from \"../select2/select2\";\n\nconst KEY = {\n    LEFT: 37,\n    RIGHT: 39,\n};\n\nexport default Base.extend({\n    name: \"relateditems\",\n    trigger: \".pat-relateditems\",\n    parser: \"mockup\",\n    currentPath: undefined,\n    selectedUIDs: [],\n    openAfterInit: undefined,\n    defaults: {\n        // main option\n        vocabularyUrl: null, // must be set to work\n\n        // more options\n        attributes: [\n            \"UID\",\n            \"Title\",\n            \"portal_type\",\n            \"path\",\n            \"getURL\",\n            \"getIcon\",\n            \"is_folderish\",\n            \"review_state\",\n        ], // used by utils.QueryHelper\n        basePath: \"\",\n        pageSize: 10,\n        browsing: undefined,\n        closeOnSelect: true,\n        contextPath: undefined,\n        dropdownCssClass: \"pat-relateditems-dropdown\",\n        favorites: [],\n        recentlyUsed: false,\n        recentlyUsedMaxItems: 20,\n        recentlyUsedKey: \"relateditems_recentlyused\",\n        maximumSelectionSize: -1,\n        minimumInputLength: 0,\n        mode: \"browse\", // possible values are 'auto', 'search' and 'browse'.\n        orderable: true, // mockup-patterns-select2\n        pathOperator: \"plone.app.querystring.operation.string.path\",\n        rootPath: \"/\",\n        rootUrl: \"\", // default to be relative.\n        scanSelection: false, // False, to no unnecessarily use CPU time on this.\n        selectableTypes: null, // null means everything is selectable, otherwise a list of strings to match types that are selectable\n        separator: \",\",\n        sortOn: null,\n        sortOrder: \"ascending\",\n        tokenSeparators: [\",\", \" \"],\n        upload: false,\n        uploadAllowView: undefined,\n\n        // templates\n        breadcrumbTemplateSelector: null,\n        favoriteTemplateSelector: null,\n        recentlyusedTemplateSelector: null,\n        resultTemplateSelector: null,\n        selectionTemplateSelector: null,\n        toolbarTemplateSelector: null,\n\n        // needed\n        multiple: true,\n    },\n\n    recentlyUsed: function (filterSelectable) {\n        var ret = utils.storage.get(this.options.recentlyUsedKey) || [];\n        // hard-limit to 1000 entries\n        ret = ret.slice(ret.length - 1000, ret.length);\n        if (filterSelectable) {\n            // Filter out only selectable items.\n            // This is used only to create the list of items to be displayed.\n            // the list to be stored is unfiltered and can be reused among\n            // different instances of this widget with different settings.\n            ret.filter(this.isSelectable.bind(this));\n        }\n        // max is applied AFTER filtering selectable items.\n        var max = parseInt(this.options.recentlyUsedMaxItems, 10);\n        if (max) {\n            // return the slice from the end, as we want to display newest items first.\n            ret = ret.slice(ret.length - max, ret.length);\n        }\n        return ret;\n    },\n\n    applyTemplate: function (tpl, item) {\n        var self = this;\n        var template;\n        if (self.options[tpl + \"TemplateSelector\"]) {\n            template = $(self.options[tpl + \"TemplateSelector\"]).html();\n        }\n        if (!template) {\n            if (self.options[tpl + \"Template\"]) {\n                template = self.options[tpl + \"Template\"];\n            } else {\n                template = self[tpl + \"Template\"];\n            }\n        }\n        // let's give all the options possible to the template generation\n        var options = $.extend(true, {}, self.options, item, {\n            browsing: self.browsing,\n            open_folder: _t(\"Open folder\"),\n            current_directory: _t(\"current directory:\"),\n            one_level_up: _t(\"Go one level up\"),\n        });\n        options._item = item;\n        return _.template(template)(options);\n    },\n\n    setAjax: function () {\n        var ajax = {\n            url: this.options.vocabularyUrl,\n            dataType: \"JSON\",\n            quietMillis: 500,\n\n            data: function (term, page) {\n                var criterias = [];\n                if (term) {\n                    term = \"*\" + term + \"*\";\n                    criterias.push({\n                        i: \"SearchableText\",\n                        o: \"plone.app.querystring.operation.string.contains\",\n                        v: term,\n                    });\n                }\n\n                // We don't restrict for selectable types while browsing...\n                if (!this.browsing && this.options.selectableTypes) {\n                    criterias.push({\n                        i: \"portal_type\",\n                        o: \"plone.app.querystring.operation.selection.any\",\n                        v: this.options.selectableTypes,\n                    });\n                }\n\n                criterias.push({\n                    i: \"path\",\n                    o: this.options.pathOperator,\n                    v:\n                        this.options.rootPath +\n                        this.currentPath +\n                        (this.browsing ? \"::1\" : \"\"),\n                });\n\n                var sort_on = this.options.sortOn;\n                var sort_order = sort_on ? this.options.sortOrder : null;\n                if (this.browsing && sort_on === null) {\n                    sort_on = \"getObjPositionInParent\";\n                    sort_order = \"ascending\";\n                }\n\n                var data = {\n                    query: JSON.stringify({\n                        criteria: criterias,\n                        sort_on: sort_on,\n                        sort_order: sort_order,\n                    }),\n                    attributes: JSON.stringify(this.options.attributes),\n                    batch: JSON.stringify({\n                        page: page ? page : 1,\n                        size: this.options.pageSize,\n                    }),\n                };\n                return data;\n            }.bind(this),\n\n            results: function (data, page) {\n                var more = page * this.options.pageSize < data.total;\n                var results = data.results;\n\n                this.selectedUIDs = ($(this.el).select2(\"data\") || []).map(function (\n                    el\n                ) {\n                    // populate current selection. Reuse in formatResult\n                    return el.UID;\n                });\n\n                // Filter out items:\n                // While browsing: always include folderish items\n                // Browsing and searching: Only include selectable items which are not already selected, and all folders\n                // even if they're selected, as we need them available for browsing/selecting their children\n                results = results.filter(\n                    function (item) {\n                        if (\n                            (this.browsing && item.is_folderish) ||\n                            (this.isSelectable(item) &&\n                                this.selectedUIDs.indexOf(item.UID) === -1)\n                        ) {\n                            return true;\n                        }\n                        return false;\n                    }.bind(this)\n                );\n\n                // Extend ``data`` with a ``oneLevelUp`` item when browsing\n                var path = this.currentPath.split(\"/\");\n                if (\n                    page === 1 && // Show level up only on top.\n                    this.browsing && // only level up when browsing\n                    path.length > 1 && // do not try to level up one level under root.\n                    this.currentPath !== \"/\" // do not try to level up beyond root\n                ) {\n                    results = [\n                        {\n                            oneLevelUp: true,\n                            Title: _t(\"One level up\"),\n                            path: path.slice(0, path.length - 1).join(\"/\") || \"/\",\n                            currentPath: this.currentPath,\n                            is_folderish: true,\n                            selectable: false,\n                        },\n                    ].concat(results);\n                }\n                return {\n                    results: results,\n                    more: more,\n                };\n            }.bind(this),\n        };\n        this.options.ajax = ajax;\n    },\n\n    renderToolbar: async function () {\n        var self = this;\n        var path = self.currentPath;\n        var html;\n\n        var paths = path.split(\"/\");\n        var itemPath = \"\";\n        var itemsHtml = \"\";\n        _.each(paths, function (node) {\n            if (node !== \"\") {\n                var item = {};\n                item.path = itemPath = itemPath + \"/\" + node;\n                item.text = node;\n                itemsHtml = itemsHtml + self.applyTemplate(\"breadcrumb\", item);\n            }\n        });\n\n        // favorites\n        var favoritesHtml = \"\";\n        _.each(self.options.favorites, function (item) {\n            var item_copy = _.clone(item);\n            item_copy.path = item_copy.path.substr(self.options.rootPath.length) || \"/\";\n            favoritesHtml = favoritesHtml + self.applyTemplate(\"favorite\", item_copy);\n        });\n\n        var recentlyUsedHtml = \"\";\n        if (self.options.recentlyUsed) {\n            var recentlyUsed = self.recentlyUsed(true); // filter out only those items which can actually be selected\n            _.each(recentlyUsed.reverse(), function (item) {\n                // reverse to get newest first.\n                recentlyUsedHtml =\n                    recentlyUsedHtml + self.applyTemplate(\"recentlyused\", item);\n            });\n        }\n\n        html = self.applyTemplate(\"toolbar\", {\n            items: itemsHtml,\n            favItems: favoritesHtml,\n            favText: _t(\"Favorites\"),\n            searchText: _t(\"Current path:\"),\n            searchModeText: _t(\"Search\"),\n            browseModeText: _t(\"Browse\"),\n            recentlyUsedItems: recentlyUsedHtml,\n            recentlyUsedText: _t(\"Recently Used\"),\n            icon_root: await utils.resolveIcon(\"house-fill\"),\n            icon_recently_used: await utils.resolveIcon(\"grid-fill\"),\n            icon_favorites: await utils.resolveIcon(\"star-fill\"),\n            icon_upload: await utils.resolveIcon(\"cloud-arrow-up\"),\n            upload: this.options.upload,\n            upload_text: _t(\"Upload\"),\n        });\n\n        self.$toolbar.html(html);\n\n        // unbind mouseup event from select2 to override the behavior:\n        $(\".pat-relateditems-dropdown\").unbind(\"mouseup\");\n        $(\".pat-relateditems-dropdown\").bind(\"mouseup\", function (e) {\n            e.stopPropagation();\n        });\n\n        $(\"button.mode.search\", self.$toolbar).on(\"click\", function (e) {\n            e.preventDefault();\n            if (self.browsing) {\n                $(\"button.mode.search\", self.$toolbar).toggleClass(\n                    \"btn-primary btn-default\"\n                );\n                $(\"button.mode.browse\", self.$toolbar).toggleClass(\n                    \"btn-primary btn-default\"\n                );\n                self.browsing = false;\n                if ($(self.el).select2(\"data\").length > 0) {\n                    // Have to call after initialization\n                    self.openAfterInit = true;\n                }\n                if (!self.openAfterInit) {\n                    $(self.el).select2(\"close\");\n                    $(self.el).select2(\"open\");\n                }\n            } else {\n                // just open result list\n                $(self.el).select2(\"close\");\n                $(self.el).select2(\"open\");\n            }\n        });\n\n        $(\"button.mode.browse\", self.$toolbar).on(\"click\", function (e) {\n            e.preventDefault();\n            if (!self.browsing) {\n                $(\"button.mode.search\", self.$toolbar).toggleClass(\n                    \"btn-primary btn-default\"\n                );\n                $(\"button.mode.browse\", self.$toolbar).toggleClass(\n                    \"btn-primary btn-default\"\n                );\n                self.browsing = true;\n                if ($(self.el).select2(\"data\").length > 0) {\n                    // Have to call after initialization\n                    self.openAfterInit = true;\n                }\n                if (!self.openAfterInit) {\n                    $(self.el).select2(\"close\");\n                    $(self.el).select2(\"open\");\n                }\n            } else {\n                // just open result list\n                $(self.el).select2(\"close\");\n                $(self.el).select2(\"open\");\n            }\n        });\n\n        $(\"a.crumb\", self.$toolbar).on(\"click\", function (e) {\n            e.preventDefault();\n            self.browseTo($(this).attr(\"href\"));\n        });\n\n        $(\"a.fav\", self.$toolbar).on(\"click\", function (e) {\n            e.preventDefault();\n            self.browseTo($(this).attr(\"href\"));\n        });\n\n        if (self.options.recentlyUsed) {\n            $(\".pat-relateditems-recentlyused-select\", self.$toolbar).on(\n                \"click\",\n                function (event) {\n                    event.preventDefault();\n                    var uid = $(this).data(\"uid\");\n                    var item = self.recentlyUsed().filter(function (it) {\n                        return it.UID === uid;\n                    });\n                    if (item.length > 0) {\n                        item = item[0];\n                    } else {\n                        return;\n                    }\n                    self.selectItem(item);\n                    if (self.options.maximumSelectionSize > 0) {\n                        var items = $(self.el).select2(\"data\");\n                        if (items.length >= self.options.maximumSelectionSize) {\n                            return;\n                        }\n                    }\n                }\n            );\n        }\n\n        async function initUploadView(disabled) {\n            let Upload = await import(\"../upload/upload\");\n            Upload = Upload.default;\n\n            const upload_button = self.$toolbar[0].querySelector(\".upload button\");\n            upload_button.disabled = disabled;\n\n            const upload_el = self.$toolbar[0].querySelector(\".upload .pat-upload\");\n\n            const upload_config = {\n                success: (e, response) => {\n                    const uid = response.UID;\n                    if (uid) {\n                        const query = new utils.QueryHelper({\n                            vocabularyUrl: self.options.vocabularyUrl,\n                            attributes: self.options.attributes,\n                        });\n                        query.search(\n                            \"UID\",\n                            \"plone.app.querystring.operation.selection.is\",\n                            uid,\n                            (e) => {\n                                var data = self.$el.select2(\"data\");\n                                data.push.apply(data, e.results);\n                                self.$el.select2(\"data\", data, true);\n                                self.emit(\"selected\");\n                                self.popover.hide();\n                            },\n                            false\n                        );\n                    }\n                },\n                uloadMultiple: true,\n                allowPathSelection: false,\n                relativePath: \"fileUpload\",\n                baseUrl: self.options.rootUrl,\n            };\n            const upload = new Upload($(upload_el), upload_config);\n\n            upload_button.addEventListener(\"show.bs.dropdown\", () => {\n                if (self.currentPath !== upload.currentPath) {\n                    upload.setPath(self.currentPath);\n                }\n            });\n        }\n\n        // upload\n        if (\n            self.options.upload &&\n            utils.featureSupport.dragAndDrop() &&\n            utils.featureSupport.fileApi()\n        ) {\n            if (self.options.uploadAllowView) {\n                // Check, if uploads are allowed in current context\n                $.ajax({\n                    url: self.options.uploadAllowView,\n                    // url: self.currentUrl() + self.options.uploadAllowView,  // not working yet\n                    dataType: \"JSON\",\n                    data: {\n                        path: self.options.rootPath + self.currentPath,\n                    },\n                    type: \"GET\",\n                    success: function (result) {\n                        initUploadView(!result.allowUpload);\n                    },\n                });\n            } else {\n                // just initialize upload view without checking, if uploads are allowed.\n                initUploadView();\n            }\n        }\n    },\n\n    browseTo: function (path) {\n        var self = this;\n        self.emit(\"before-browse\");\n        self.currentPath = path;\n        $(self.el).select2(\"close\");\n        self.renderToolbar();\n        $(self.el).select2(\"open\");\n        self.emit(\"after-browse\");\n    },\n\n    selectItem: function (item) {\n        var self = this;\n        self.emit(\"selecting\");\n        var data = $(self.el).select2(\"data\");\n        data.push(item);\n        $(self.el).select2(\"data\", data, true);\n\n        if (self.options.recentlyUsed) {\n            // add to recently added items\n            var recentlyUsed = self.recentlyUsed(); // do not filter for selectable but get all. append to that list the new item.\n            var alreadyPresent = recentlyUsed.filter(function (it) {\n                return it.UID === item.UID;\n            });\n            if (alreadyPresent.length > 0) {\n                recentlyUsed.splice(recentlyUsed.indexOf(alreadyPresent[0]), 1);\n            }\n            recentlyUsed.push(item);\n            utils.storage.set(self.options.recentlyUsedKey, recentlyUsed);\n        }\n\n        self.emit(\"selected\");\n    },\n\n    deselectItem: function (item) {\n        var self = this;\n        self.emit(\"deselecting\");\n        var data = $(self.el).select2(\"data\");\n        _.each(data, function (obj, i) {\n            if (obj.UID === item.UID) {\n                data.splice(i, 1);\n            }\n        });\n        $(self.el).select2(\"data\", data, true);\n        self.emit(\"deselected\");\n    },\n\n    isSelectable: function (item) {\n        var self = this;\n        if (item.selectable === false) {\n            return false;\n        }\n        if (self.options.selectableTypes === null) {\n            return true;\n        } else {\n            return self.options.selectableTypes.indexOf(item.portal_type) !== -1;\n        }\n    },\n\n    init: async function () {\n        (await import(\"bootstrap\")).Dropdown;\n        import(\"./relateditems.scss\");\n\n        // templates\n        this.breadcrumbTemplate = (await import(\"./templates/breadcrumb.xml\")).default; // prettier-ignore\n        this.favoriteTemplate = (await import(\"./templates/favorite.xml\")).default; // prettier-ignore\n        this.recentlyusedTemplate = (await import(\"./templates/recentlyused.xml\")).default; // prettier-ignore\n        this.resultTemplate = (await import(\"./templates/result.xml\")).default; // prettier-ignore\n        this.selectionTemplate = (await import(\"./templates/selection.xml\")).default; // prettier-ignore\n        this.toolbarTemplate = (await import(\"./templates/toolbar.xml\")).default; // prettier-ignore\n\n        var self = this;\n\n        self.browsing = self.options.mode !== \"search\";\n\n        // Remove trailing slash\n        self.options.rootPath = self.options.rootPath.replace(/\\/$/, \"\");\n        // Substract rootPath from basePath with is the relative currentPath. Has a leading slash. Or use '/'\n        self.currentPath =\n            self.options.basePath.substr(self.options.rootPath.length) || \"/\";\n\n        self.setAjax();\n\n        self.$el.wrap('<div class=\"pat-relateditems-container\" />');\n        self.$container = self.$el.parents(\".pat-relateditems-container\");\n\n        Select2.prototype.initializeValues.call(self);\n        Select2.prototype.initializeTags.call(self);\n\n        self.options.formatSelection = function (item) {\n            item = $.extend(\n                true,\n                {\n                    Title: \"\",\n                    getIcon: \"\",\n                    getURL: \"\",\n                    path: \"\",\n                    portal_type: \"\",\n                    review_state: \"\",\n                },\n                item\n            );\n\n            // activate petterns on the result set.\n            var $selection = $(self.applyTemplate(\"selection\", item));\n            if (self.options.scanSelection) {\n                registry.scan($selection);\n            }\n            if (self.options.maximumSelectionSize == 1) {\n                // If this related field accepts only 1 item, the breadcrumbs should\n                // reflect the location for this particular item\n                var itemPath = item.path;\n                var path_split = itemPath.split(\"/\");\n                path_split = path_split.slice(0, -1); // Remove last part of path, we always want the parent path\n                itemPath = path_split.join(\"/\");\n                self.currentPath = itemPath;\n                self.renderToolbar();\n            }\n            return $selection;\n        };\n\n        const icon_level_up = await utils.resolveIcon(\"arrow-left-circle\");\n        const icon_level_down = await utils.resolveIcon(\"arrow-right-circle\");\n\n        self.options.formatResult = function (item) {\n            item.selectable = self.isSelectable(item);\n            item = $.extend(\n                true,\n                {\n                    Title: \"\",\n                    getIcon: \"\",\n                    getURL: \"\",\n                    is_folderish: false,\n                    oneLevelUp: false,\n                    iconLevelUp: icon_level_up,\n                    iconLevelDown: icon_level_down,\n                    path: \"\",\n                    portal_type: \"\",\n                    review_state: \"\",\n                    selectable: false,\n                },\n                item\n            );\n\n            if (self.selectedUIDs.indexOf(item.UID) !== -1) {\n                // do not allow already selected items to be selected again.\n                item.selectable = false;\n            }\n            var result = $(self.applyTemplate(\"result\", item));\n\n            $(\".pat-relateditems-result-select\", result).on(\"click\", function (event) {\n                event.preventDefault();\n                // event.stopPropagation();\n                if ($(this).is(\".selectable\")) {\n                    var $parent = $(this).parents(\".pat-relateditems-result\");\n                    if ($parent.is(\".pat-relateditems-active\")) {\n                        $parent.removeClass(\"pat-relateditems-active\");\n                        self.deselectItem(item);\n                    } else {\n                        if (self.options.maximumSelectionSize > 0) {\n                            var items = $(self.el).select2(\"data\");\n                            if (items.length >= self.options.maximumSelectionSize) {\n                                $(self.el).select2(\"close\");\n                            }\n                        }\n                        self.selectItem(item);\n                        $parent.addClass(\"pat-relateditems-active\");\n                        if (self.options.closeOnSelect) {\n                            $(self.el).select2(\"close\");\n                        }\n                    }\n                }\n            });\n\n            $(\".pat-relateditems-result-browse\", result).on(\"click\", function (event) {\n                event.preventDefault();\n                event.stopPropagation();\n                var path = $(this).data(\"path\");\n                self.browseTo(path);\n            });\n\n            return $(result);\n        };\n\n        self.options.initSelection = function (element, callback) {\n            var value = $(element).val();\n            if (value !== \"\") {\n                var ids = value.split(self.options.separator);\n                var query = new utils.QueryHelper(\n                    $.extend(true, {}, self.options, {\n                        pattern: self,\n                    })\n                );\n                query.search(\n                    \"UID\",\n                    \"plone.app.querystring.operation.list.contains\",\n                    ids,\n                    function (data) {\n                        var results = data.results.reduce(function (prev, item) {\n                            prev[item.UID] = item;\n                            return prev;\n                        }, {});\n\n                        try {\n                            callback(\n                                ids\n                                    .map(function (uid) {\n                                        return results[uid];\n                                    })\n                                    .filter(function (item) {\n                                        return item !== undefined;\n                                    })\n                            );\n                        } catch (e) {\n                            // Select2 3.5.4 throws an error in some cases in\n                            // updateSelection, ``this.selection.find(\".select2-search-choice\").remove();``\n                            // No idea why, hard to track.\n                        }\n\n                        if (self.openAfterInit) {\n                            // open after initialization\n                            $(self.el).select2(\"open\");\n                            self.openAfterInit = undefined;\n                        }\n                    },\n                    false\n                );\n            }\n        };\n\n        self.options.tokenizer = function (input) {\n            if (this.options.mode === \"auto\") {\n                this.browsing = input ? false : true;\n            }\n        }.bind(this);\n\n        self.options.id = function (item) {\n            return item.UID;\n        };\n\n        await Select2.prototype.initializeSelect2.call(self);\n        await Select2.prototype.initializeOrdering.call(self);\n\n        self.$toolbar = $('<div class=\"toolbar d-flex\" />');\n        self.$container.prepend(self.$toolbar);\n        self.$el.on(\"select2-selecting\", function (event) {\n            if (!self.isSelectable(event.choice)) {\n                event.preventDefault();\n            }\n        });\n        self.renderToolbar();\n\n        $(document).on(\"keyup\", self.$el, function (event) {\n            var isOpen = Select2.prototype.opened.call(self);\n\n            if (!isOpen) {\n                return;\n            }\n\n            if (event.which === KEY.LEFT || event.which === KEY.RIGHT) {\n                event.stopPropagation();\n\n                var selectorContext =\n                    event.which === KEY.LEFT\n                        ? \".pat-relateditems-result.one-level-up\"\n                        : \".select2-highlighted\";\n\n                var browsableItemSelector = \".pat-relateditems-result-browse\";\n                var browsableItem = $(browsableItemSelector, selectorContext);\n\n                if (browsableItem.length !== 1) {\n                    return;\n                }\n\n                var path = browsableItem.data(\"path\");\n\n                self.browseTo(path);\n            }\n        });\n    },\n});\n","import $ from \"jquery\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\n\nexport default Base.extend({\n    name: \"autotoc\",\n    trigger: \".pat-autotoc\",\n    parser: \"mockup\",\n    defaults: {\n        section: \"section\",\n        levels: \"h1,h2,h3\",\n        IDPrefix: \"autotoc-item-\",\n        classTOCName: \"autotoc-nav\",\n        classSectionName: \"autotoc-section\",\n        classLevelPrefixName: \"autotoc-level-\",\n        classActiveName: \"active\",\n        scrollDuration: \"slow\",\n        scrollEasing: \"swing\",\n    },\n    init: function () {\n        import(\"./autotoc.scss\");\n\n        var self = this;\n\n        self.$toc = $(\"<nav/>\").addClass(self.options.classTOCName);\n\n        if (self.options.prependTo) {\n            self.$toc.prependTo(self.options.prependTo);\n        } else if (self.options.appendTo) {\n            self.$toc.appendTo(self.options.appendTo);\n        } else {\n            self.$toc.prependTo(self.$el);\n        }\n\n        if (self.options.className) {\n            self.$el.addClass(self.options.className);\n        }\n\n        $(self.options.section, self.$el).addClass(self.options.classSectionName);\n\n        var asTabs = self.$el.hasClass(\"autotabs\");\n\n        var activeId = null;\n\n        $(self.options.levels, self.$el).each(function (i) {\n            var $level = $(this),\n                id = $level.prop(\"id\")\n                    ? $level.prop(\"id\")\n                    : $level.parents(self.options.section).prop(\"id\");\n            if (!id || $(\"#\" + id).length > 0) {\n                id = self.options.IDPrefix + self.name + \"-\" + i;\n            }\n            if (window.location.hash === \"#\" + id) {\n                activeId = id;\n            }\n            if (activeId === null && $level.hasClass(self.options.classActiveName)) {\n                activeId = id;\n            }\n            $level.data(\"navref\", id);\n            $(\"<a/>\")\n                .appendTo(self.$toc)\n                .text($level.text())\n                .attr(\"id\", id)\n                .attr(\"href\", \"#\" + id)\n                .addClass(self.options.classLevelPrefixName + self.getLevel($level))\n                .on(\"click\", function (e, options) {\n                    e.stopPropagation();\n                    e.preventDefault();\n                    if (!options) {\n                        options = {\n                            doScroll: true,\n                            skipHash: false,\n                        };\n                    }\n                    var $el = $(this);\n                    self.$toc\n                        .children(\".\" + self.options.classActiveName)\n                        .removeClass(self.options.classActiveName);\n                    self.$el\n                        .children(\".\" + self.options.classActiveName)\n                        .removeClass(self.options.classActiveName);\n                    $(e.target).addClass(self.options.classActiveName);\n                    $level\n                        .parents(self.options.section)\n                        .addClass(self.options.classActiveName);\n                    if (\n                        options.doScroll !== false &&\n                        self.options.scrollDuration &&\n                        $level &&\n                        !asTabs\n                    ) {\n                        $(\"body,html\").animate(\n                            {\n                                scrollTop: $level.offset().top,\n                            },\n                            self.options.scrollDuration,\n                            self.options.scrollEasing\n                        );\n                    }\n                    if (self.$el.parents(\".plone-modal\").length !== 0) {\n                        self.$el.trigger(\"resize.plone-modal.patterns\");\n                    }\n                    $(this).trigger(\"clicked\");\n                    if (!options.skipHash) {\n                        if (window.history && window.history.pushState) {\n                            window.history.pushState({}, \"\", \"#\" + $el.attr(\"id\"));\n                        }\n                    }\n                });\n            $level.data(\"autotoc-trigger-id\", id);\n        });\n\n        if (activeId) {\n            $(\"a#\" + activeId).trigger(\"click\", {\n                doScroll: true,\n                skipHash: true,\n            });\n        } else {\n            self.$toc.find(\"a\").first().trigger(\"click\", {\n                doScroll: false,\n                skipHash: true,\n            });\n        }\n    },\n    getLevel: function ($el) {\n        var elementLevel = 0;\n        $.each(this.options.levels.split(\",\"), function (level, levelSelector) {\n            if ($el.filter(levelSelector).length === 1) {\n                elementLevel = level + 1;\n                return false;\n            }\n        });\n        return elementLevel;\n    },\n});\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport registry from \"@patternslib/patternslib/src/core/registry\";\n\nimport tinymce from \"tinymce/tinymce\";\nimport LinkTemplate from \"../templates/link.xml\";\nimport ImageTemplate from \"../templates/image.xml\";\nimport RelatedItems from \"../../relateditems/relateditems\";\nimport \"../../autotoc/autotoc\";\nimport \"../../modal/modal\";\nimport PatternUpload from \"../../upload/upload\";\n\nvar LinkType = Base.extend({\n    name: \"linktype\",\n    trigger: \".pat-linktype-dummy\",\n    defaults: {\n        linkModal: null, // required\n    },\n\n    init: function () {\n        this.linkModal = this.options.linkModal;\n        this.tinypattern = this.options.tinypattern;\n        this.tiny = this.tinypattern.tiny;\n        this.dom = this.tiny.dom;\n    },\n\n    getEl: function () {\n        return this.$el.find(\"input\");\n    },\n\n    value: function () {\n        return $.trim(this.getEl().val());\n    },\n\n    toUrl: function () {\n        return this.value();\n    },\n\n    load: function (element) {\n        let val = this.tiny.dom.getAttrib(element, \"data-val\");\n        this.getEl().attr(\"value\", val);\n    },\n\n    set: function (val) {\n        var $el = this.getEl();\n        $el.attr(\"value\", val);\n        $el.val(val);\n    },\n\n    attributes: function () {\n        return {\n            \"data-val\": this.value(),\n        };\n    },\n    updateRelatedItems: function () {},\n});\n\nvar ExternalLink = LinkType.extend({\n    name: \"externallinktype\",\n    trigger: \".pat-externallinktype-dummy\",\n    init: function () {\n        LinkType.prototype.init.call(this);\n        this.getEl().on(\"change\", function () {\n            // check here if we should automatically add in http:// to url\n            var val = $(this).val();\n            if (new RegExp(\"https?://\").test(val)) {\n                // already valid url\n                return;\n            }\n            var domain = $(this).val().split(\"/\")[0];\n            if (domain.indexOf(\".\") !== -1) {\n                $(this).val(\"http://\" + val);\n            }\n        });\n    },\n});\n\nvar InternalLink = LinkType.extend({\n    name: \"internallinktype\",\n    trigger: \".pat-internallinktype-dummy\",\n    init: function () {\n        if (!this.getEl().length) {\n            return;\n        }\n        LinkType.prototype.init.call(this);\n        this.getEl().addClass(\"pat-relateditems\");\n        this.createRelatedItems();\n    },\n\n    getEl: function () {\n        return this.$el.find(\"input:not(.select2-input)\");\n    },\n\n    createRelatedItems: function () {\n        if (!this.getEl().length) {\n            return;\n        }\n        var options = this.linkModal.options.relatedItems;\n        options.upload = false; // ensure that related items upload is off.\n        this.relatedItems = new RelatedItems(this.getEl(), options);\n    },\n\n    updateRelatedItems: function (val) {\n        if (!this.relatedItems) {\n            // prevent toolbar from being rendered twice\n            this.createRelatedItems();\n        }\n        this.relatedItems.selectItem(val);\n    },\n\n    value: function () {\n        var val = this.getEl().select2(\"data\");\n        if (val && typeof val === \"object\") {\n            val = val[0];\n        }\n        return val;\n    },\n\n    toUrl: function () {\n        var value = this.value();\n        if (value) {\n            return this.tinypattern.generateUrl(value);\n        }\n        return null;\n    },\n    load: function (element) {\n        var val = this.tiny.dom.getAttrib(element, \"data-val\");\n        if (val) {\n            this.set(val);\n        }\n    },\n\n    set: function (val) {\n        var $el = this.getEl();\n        $el.val(val).trigger(\"change\");\n        this.updateRelatedItems(val);\n    },\n\n    attributes: function () {\n        var val = this.value();\n        if (val) {\n            return {\n                \"data-val\": val.UID,\n            };\n        }\n        return {};\n    },\n});\n\nvar UploadLink = LinkType.extend({\n    name: \"uploadlinktype\",\n    trigger: \".pat-uploadlinktype-dummy\",\n    /* need to do it a bit differently here.\n       when a user uploads and tries to upload from\n       it, you need to delegate to the real insert\n       linke types */\n    getDelegatedLinkType: function () {\n        if (this.linkModal.linkType === \"uploadImage\") {\n            return this.linkModal.linkTypes.image;\n        } else {\n            return this.linkModal.linkTypes.internal;\n        }\n    },\n    toUrl: function () {\n        return this.getDelegatedLinkType().toUrl();\n    },\n    attributes: function () {\n        return this.getDelegatedLinkType().attributes();\n    },\n    set: function (val) {\n        return this.getDelegatedLinkType().set(val);\n    },\n    load: function (element) {\n        return this.getDelegatedLinkType().load(element);\n    },\n    value: function () {\n        return this.getDelegatedLinkType().value();\n    },\n});\n\nvar ImageLink = InternalLink.extend({\n    name: \"imagelinktype\",\n    trigger: \".pat-imagelinktype-dummy\",\n    toUrl: function () {\n        var value = this.value();\n        return this.tinypattern.generateImageUrl(\n            value,\n            this.linkModal.getScaleFromSrcset(this.linkModal.$scale.val())\n        );\n    },\n});\n\nvar EmailLink = LinkType.extend({\n    name: \"emaillinktype\",\n    trigger: \".pat-emaillinktype-dummy\",\n    toUrl: function () {\n        var self = this;\n        var val = self.value();\n        if (val) {\n            var subject = self.getSubject();\n            var href = \"mailto:\" + val;\n            if (subject) {\n                href += \"?subject=\" + subject;\n            }\n            return href;\n        }\n        return null;\n    },\n\n    load: function (element) {\n        LinkType.prototype.load.apply(this, [element]);\n        this.linkModal.$subject.val(this.tiny.dom.getAttrib(element, \"data-subject\"));\n    },\n\n    getSubject: function () {\n        return this.linkModal.$subject.val();\n    },\n\n    attributes: function () {\n        var attribs = LinkType.prototype.attributes.call(this);\n        attribs[\"data-subject\"] = this.getSubject();\n        return attribs;\n    },\n});\n\nvar AnchorLink = LinkType.extend({\n    name: \"anchorlinktype\",\n    trigger: \".pat-anchorlinktype-dummy\",\n    init: function () {\n        LinkType.prototype.init.call(this);\n        this.$select = this.$el.find(\"select\");\n        this.anchorNodes = [];\n        this.anchorData = [];\n        this.populate();\n    },\n\n    value: function () {\n        var val = this.$select.select2(\"data\");\n        if (val && typeof val === \"object\") {\n            val = val.id;\n        }\n        return val;\n    },\n\n    populate: function () {\n        var self = this;\n        self.$select.find(\"option\").remove();\n        self.anchorNodes = [];\n        self.anchorData = [];\n        var node, i, j, name, title;\n\n        var nodes = self.tiny.dom.select(\".mceItemAnchor,.mce-item-anchor\");\n        for (i = 0; i < nodes.length; i = i + 1) {\n            node = nodes[i];\n            name = self.tiny.dom.getAttrib(node, \"name\");\n            if (!name) {\n                name = self.tiny.dom.getAttrib(node, \"id\");\n            }\n            if (name !== \"\") {\n                self.anchorNodes.push(node);\n                self.anchorData.push({ name: name, title: name });\n            }\n        }\n\n        nodes = self.tiny.dom.select(self.linkModal.options.anchorSelector);\n        if (nodes.length > 0) {\n            for (i = 0; i < nodes.length; i = i + 1) {\n                node = nodes[i];\n                title = $(node)\n                    .text()\n                    .replace(/^\\s+|\\s+$/g, \"\");\n                if (title === \"\") {\n                    continue;\n                }\n                name = title.toLowerCase().substring(0, 1024);\n                name = name.replace(/[^a-z0-9]/g, \"-\");\n                /* okay, ugly, but we need to first check that this anchor isn't already available */\n                var found = false;\n                for (j = 0; j < self.anchorNodes.length; j = j + 1) {\n                    var anode = self.anchorData[j];\n                    if (anode.name === name) {\n                        found = true;\n                        // so it's also found, let's update the title to be more presentable\n                        anode.title = title;\n                        break;\n                    }\n                }\n                if (!found) {\n                    self.anchorData.push({\n                        name: name,\n                        title: title,\n                        newAnchor: true,\n                    });\n                    self.anchorNodes.push(node);\n                }\n            }\n        }\n        if (self.anchorNodes.length > 0) {\n            for (i = 0; i < self.anchorData.length; i = i + 1) {\n                var data = self.anchorData[i];\n                self.$select.append(\n                    '<option value=\"' + i + '\">' + data.title + \"</option>\"\n                );\n            }\n        } else {\n            self.$select.append(\"<option>No anchors found..</option>\");\n        }\n    },\n\n    getIndex: function (name) {\n        for (var i = 0; i < this.anchorData.length; i = i + 1) {\n            var data = this.anchorData[i];\n            if (data.name === name) {\n                return i;\n            }\n        }\n        return 0;\n    },\n\n    toUrl: function () {\n        var val = this.value();\n        if (val) {\n            var index = parseInt(val, 10);\n            var node = this.anchorNodes[index];\n            var data = this.anchorData[index];\n            if (data.newAnchor) {\n                node.innerHTML =\n                    '<a name=\"' +\n                    data.name +\n                    '\" class=\"mce-item-anchor\"></a>' +\n                    node.innerHTML;\n            }\n            return \"#\" + data.name;\n        }\n        return null;\n    },\n\n    set: function (val) {\n        var anchor = this.getIndex(val);\n        this.$select.select2(\"data\", \"\" + anchor);\n    },\n});\n\ntinymce.PluginManager.add(\"ploneimage\", function (editor) {\n    editor.ui.registry.addButton(\"ploneimage\", {\n        icon: \"image\",\n        text: \"Insert image\",\n        tooltip: \"Insert/edit image\",\n        onAction: editor.settings.addImageClicked,\n        // stateSelector: \"img:not([data-mce-object])\",\n    });\n});\n\n/* register the tinymce plugin */\ntinymce.PluginManager.add(\"plonelink\", function (editor) {\n    editor.ui.registry.addButton(\"plonelink\", {\n        icon: \"link\",\n        tooltip: \"Insert/edit link\",\n        shortcut: \"Ctrl+K\",\n        onAction: editor.settings.addLinkClicked,\n        stateSelector: \"a[href]\",\n    });\n\n    editor.ui.registry.addButton(\"unlink\", {\n        icon: \"unlink\",\n        tooltip: \"Remove link\",\n        onAction: function () {\n            editor.execCommand(\"unlink\");\n        },\n        stateSelector: \"a[href]\",\n    });\n\n    // editor.ui.registry.addButton(\"Ctrl+K\", \"\", editor.settings.addLinkClicked);\n\n    // editor.ui.registry.addButton(\"plonelink\", {\n    //     icon: \"link\",\n    //     text: \"Insert link\",\n    //     shortcut: \"Ctrl+K\",\n    //     onAction: editor.settings.addLinkClicked,\n    //     stateSelector: \"a[href]\",\n    //     context: \"insert\",\n    //     prependToContext: true,\n    // });\n});\n\nexport default Base.extend({\n    name: \"linkmodal\",\n    trigger: \".pat-linkmodal\",\n    defaults: {\n        anchorSelector: \"h1,h2,h3\",\n        linkTypes: [\n            /* available, none activate by default because these options\n         * only get merged, not set.\n        'internal',\n        'upload',\n        'external',\n        'email',\n        'anchor',\n        'image'\n        'externalImage'*/\n        ],\n        initialLinkType: \"internal\",\n        text: {\n            insertHeading: \"Insert Link\",\n        },\n        linkTypeClassMapping: {\n            internal: InternalLink,\n            upload: UploadLink,\n            external: ExternalLink,\n            email: EmailLink,\n            anchor: AnchorLink,\n            image: ImageLink,\n            uploadImage: UploadLink,\n            externalImage: LinkType,\n        },\n    },\n    // XXX: this is a temporary work around for having separated templates.\n    // Image modal is going to have its own modal class, funcs and template.\n    linkTypeTemplateMapping: {\n        internal: LinkTemplate,\n        upload: LinkTemplate,\n        external: LinkTemplate,\n        email: LinkTemplate,\n        anchor: LinkTemplate,\n        image: ImageTemplate,\n        uploadImage: ImageTemplate,\n        externalImage: ImageTemplate,\n    },\n\n    template: function (data) {\n        return _.template(this.linkTypeTemplateMapping[this.linkType])(data);\n    },\n\n    init: function () {\n        var self = this;\n        self.tinypattern = self.options.tinypattern;\n        if (self.tinypattern.options.anchorSelector) {\n            self.options.anchorSelector = self.tinypattern.options.anchorSelector;\n        }\n        self.tiny = self.tinypattern.tiny;\n        self.dom = self.tiny.dom;\n        self.linkType = self.options.initialLinkType;\n        self.linkTypes = {};\n        self.modal = registry.patterns[\"plone-modal\"].init(self.$el, {\n            html: self.generateModalHtml(),\n            content: null,\n            buttons: \".plone-btn\",\n            reloadWindowOnClose: false,\n            templateOptions: {\n                classDialog: \"modal-dialog modal-lg\",\n                reloadWindowOnClose: false,\n            },\n            actionOptions: { reloadWindowOnClose: false },\n            backdropOptions: {\n                zIndex: \"1340\",\n                closeOnClick: false\n            },\n        });\n        self.modal.on(\"shown\", (e) => {\n            self.modalShown.apply(self, [e]);\n        });\n    },\n\n    isOnlyTextSelected: function () {\n        /* pulled from TinyMCE link plugin */\n        var html = this.tiny.selection.getContent();\n\n        // Partial html and not a fully selected anchor element\n        if (\n            /</.test(html) &&\n            (!/^<a [^>]+>[^<]+<\\/a>$/.test(html) || html.indexOf(\"href=\") === -1)\n        ) {\n            return false;\n        }\n\n        if (this.anchorElm) {\n            var nodes = this.anchorElm.childNodes,\n                i;\n\n            if (nodes.length === 0) {\n                return false;\n            }\n\n            for (var ii = nodes.length - 1; ii >= 0; ii--) {\n                if (nodes[ii].nodeType !== 3) {\n                    return false;\n                }\n            }\n        }\n\n        return true;\n    },\n\n    generateModalHtml: function () {\n        return this.template({\n            options: this.options,\n            upload: this.options.upload,\n            text: this.options.text,\n            insertHeading: this.options.text.insertHeading,\n            insertImageHelp: this.options.text.insertImageHelp,\n            uploadText: this.options.text.upload,\n            insertLinkHelp: this.options.text.insertLinkHelp,\n            internal: this.options.text.internal,\n            external: this.options.text.external,\n            anchor: this.options.text.anchor,\n            anchorLabel: this.options.text.anchorLabel,\n            target: this.options.text.target,\n            linkTypes: this.options.linkTypes,\n            externalText: this.options.text.externalText,\n            emailText: this.options.text.email,\n            subjectText: this.options.text.subject,\n            targetList: this.options.targetList,\n            titleText: this.options.text.title,\n            internalImageText: this.options.text.internalImage,\n            externalImage: this.options.text.externalImage,\n            externalImageText: this.options.text.externalImageText,\n            altText: this.options.text.alt,\n            imageAlignText: this.options.text.imageAlign,\n            captionFromDescriptionText: this.options.text.captionFromDescription,\n            enableImageZoom: this.options.text.enableImageZoom,\n            captionText: this.options.text.caption,\n            scaleText: this.options.text.scale,\n            pictureVariants: this.options.pictureVariants,\n            imageCaptioningEnabled: this.options.imageCaptioningEnabled,\n            cancelBtn: this.options.text.cancelBtn,\n            insertBtn: this.options.text.insertBtn,\n        });\n    },\n\n    isImageMode: function () {\n        return [\"image\", \"uploadImage\", \"externalImage\"].indexOf(this.linkType) !== -1;\n    },\n\n    initElements: function () {\n        var self = this;\n        self.$target = $('select[name=\"target\"]', self.modal.$modal);\n        self.$button = $('.modal-footer input[name=\"insert\"]', self.modal.$modal);\n        self.$title = $('input[name=\"title\"]', self.modal.$modal);\n        self.$subject = $('input[name=\"subject\"]', self.modal.$modal);\n\n        self.$alt = $('input[name=\"alt\"]', self.modal.$modal);\n        self.$align = $('select[name=\"align\"]', self.modal.$modal);\n        self.$scale = $('select[name=\"scale\"]', self.modal.$modal);\n        self.$enableImageZoom = $('input[name=\"enableImageZoom\"]', self.modal.$modal);\n        self.$captionFromDescription = $(\n            'input[name=\"captionFromDescription\"]',\n            self.modal.$modal\n        );\n        self.$caption = $('textarea[name=\"caption\"]', self.modal.$modal);\n\n        /* load up all the link types */\n        _.each(self.options.linkTypes, function (type) {\n            var $container = $(\".linkType.\" + type + \" .main\", self.modal.$modal);\n            if ($container.length) {\n                self.linkTypes[type] = new self.options.linkTypeClassMapping[type](\n                    $container,\n                    {\n                        linkModal: self,\n                        tinypattern: self.tinypattern,\n                    }\n                );\n            }\n        });\n\n        $(\".autotoc-nav a\", self.modal.$modal).click(function () {\n            var $fieldset = $(\"fieldset.linkType\", self.modal.$modal).eq(\n                $(this).index()\n            );\n            var classes = $fieldset[0].className.split(/\\s+/);\n            _.each(classes, function (val) {\n                if (_.indexOf(self.options.linkTypes, val) !== -1) {\n                    self.linkType = val;\n                }\n            });\n        });\n\n        self.$captionFromDescription.change(function () {\n            if (this.checked) {\n                self.$caption.prop(\"disabled\", true);\n            } else {\n                self.$caption.prop(\"disabled\", false);\n            }\n        });\n    },\n\n    getLinkUrl: function () {\n        // get the url, only get one uid\n        return this.linkTypes[this.linkType].toUrl();\n    },\n\n    getValue: function () {\n        return this.linkTypes[this.linkType].value();\n    },\n\n    updateAnchor: function (href) {\n        var self = this;\n\n        self.tiny.focus();\n        self.tiny.selection.setRng(self.rng);\n\n        var target = self.$target.val();\n        var title = self.$title.val();\n        var linkAttrs = $.extend(\n            true,\n            self.data,\n            {\n                \"title\": title ? title : null,\n                \"target\": target ? target : null,\n                \"data-linkType\": self.linkType,\n                \"href\": href,\n            },\n            self.linkTypes[self.linkType].attributes()\n        );\n        if (self.anchorElm) {\n            if (self.onlyText && linkAttrs.text !== self.initialText) {\n                if (\"innerText\" in self.anchorElm) {\n                    self.anchorElm.innerText = self.data.text;\n                } else {\n                    self.anchorElm.textContent = self.data.text;\n                }\n            }\n\n            self.tiny.dom.setAttribs(self.anchorElm, linkAttrs);\n\n            self.tiny.selection.select(self.anchorElm);\n            self.tiny.undoManager.add();\n        } else {\n            if (self.onlyText) {\n                self.tiny.insertContent(\n                    self.tiny.dom.createHTML(\n                        \"a\",\n                        linkAttrs,\n                        self.tiny.dom.encode(self.data.text)\n                    )\n                );\n            } else {\n                self.tiny.execCommand(\"mceInsertLink\", false, linkAttrs);\n            }\n        }\n    },\n\n    focusElement: function (elm) {\n        this.tiny.focus();\n        this.tiny.selection.select(elm);\n        this.tiny.nodeChanged();\n    },\n\n    getScaleFromSrcset: function (pictureVariant) {\n        let pictureVariantsConfig = this.options.pictureVariants[pictureVariant];\n        return pictureVariantsConfig.sourceset[\n            pictureVariantsConfig.sourceset.length - 1\n        ].scale;\n    },\n\n    updateImage: function (src) {\n        var self = this;\n        var title = self.$title.val();\n        var captionFromDescription = self.$captionFromDescription.prop(\"checked\");\n        var enableImageZoom = self.$enableImageZoom.prop(\"checked\");\n        var caption = self.$caption.val();\n\n        self.tiny.focus();\n        self.tiny.selection.setRng(self.rng);\n        var cssclasses = [\n            \"image-richtext\",\n            self.$align.val(),\n            \"picture-variant-\" + self.$scale.val(),\n        ];\n        if (captionFromDescription || caption) {\n            cssclasses.push(\"captioned\");\n        }\n        if (enableImageZoom) {\n            cssclasses.push(\"zoomable\");\n        }\n        var data = $.extend(\n            true,\n            {},\n            {\n                \"src\": src,\n                \"title\": title ? title : null,\n                \"alt\": self.$alt.val(),\n                \"class\": cssclasses.join(\" \"),\n                \"data-linkType\": self.linkType,\n                \"data-picturevariant\": self.$scale.val(),\n                \"data-scale\": self.getScaleFromSrcset(self.$scale.val()),\n            },\n            self.linkTypes[self.linkType].attributes()\n        );\n        if (caption && !captionFromDescription) {\n            data[\"data-captiontext\"] = caption;\n        }\n        if (self.imgElm && !self.imgElm.getAttribute(\"data-mce-object\")) {\n            const imgWidth = self.dom.getAttrib(self.imgElm, \"width\");\n            const imgHight = self.dom.getAttrib(self.imgElm, \"height\");\n            if (imgWidth) {\n                data.width = imgWidth;\n            }\n            if (imgHight) {\n                data.height = imgHight;\n            }\n        } else {\n            self.imgElm = null;\n        }\n\n        function waitLoad(imgElm) {\n            imgElm.onload = imgElm.onerror = function () {\n                imgElm.onload = imgElm.onerror = null;\n                self.focusElement(imgElm);\n            };\n        }\n\n        if (self.imgElm) {\n            self.dom.remove(self.imgElm);\n        }\n\n        data.id = \"__mcenew\";\n        var html_inner = self.dom.createHTML(\"img\", data);\n        var html_string;\n        html_string = html_inner;\n        self.tiny.insertContent(html_string);\n        self.imgElm = self.dom.get(\"__mcenew\");\n        self.dom.setAttrib(self.imgElm, \"id\", null);\n\n        waitLoad(self.imgElm);\n        if (self.imgElm.complete) {\n            self.focusElement(self.imgElm);\n        }\n    },\n\n    modalShown: function (e) {\n        var self = this;\n        self.initElements();\n        self.initData();\n        // upload init\n        if (self.options.upload) {\n            self.$upload = $(\".uploadify-me\", self.modal.$modal);\n            self.options.upload.relatedItems = $.extend(\n                true,\n                {},\n                self.options.relatedItems\n            );\n            self.options.upload.relatedItems.selectableTypes = self.options.folderTypes;\n            self.$upload.addClass(\"pat-upload\");\n            new PatternUpload(self.$upload, self.options.upload);\n            self.$upload.on(\n                \"uploadAllCompleted\",\n                function (evt, data) {\n                    if (self.linkTypes.image) {\n                        self.linkTypes.image.set(data.data.UID);\n                        $(\n                            \"#\" + $(\"#tinylink-image\", self.modal.$modal).data(\"navref\")\n                        ).trigger(\"click\");\n                    } else {\n                        self.linkTypes.internal.set(data.data.UID);\n                        $(\n                            \"#\" +\n                                $(\"#tinylink-internal\", self.modal.$modal).data(\"navref\")\n                        ).trigger(\"click\");\n                    }\n                }.bind(self)\n            );\n        }\n\n        self.$button.off(\"click\").on(\"click\", function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            self.linkType = self.modal.$modal.find(\"fieldset.active\").data(\"linktype\");\n\n            if (self.linkType === \"uploadImage\" || self.linkType === \"upload\") {\n                var patUpload = self.$upload.data().patternUpload;\n                if (patUpload.dropzone.files.length > 0) {\n                    patUpload.processUpload();\n                    self.$upload.on(\"uploadAllCompleted\", function (evt, data) {\n                        var counter = 0;\n                        var checkUpload = function () {\n                            if (counter < 5 && !self.linkTypes[self.linkType].value()) {\n                                counter += 1;\n                                setTimeout(checkUpload, 100);\n                                return;\n                            } else {\n                                var href = self.getLinkUrl();\n                                self.updateImage(href);\n                                self.hide();\n                            }\n                        };\n                        checkUpload();\n                    });\n                }\n            }\n            var href;\n            try {\n                href = self.getLinkUrl();\n            } catch (error) {\n                return; // just cut out if no url\n            }\n            if (!href) {\n                return; // just cut out if no url\n            }\n            if (self.isImageMode()) {\n                self.updateImage(href);\n            } else {\n                /* regular anchor */\n                self.updateAnchor(href);\n            }\n            self.hide();\n        });\n        $('.modal-footer input[name=\"cancel\"]', self.modal.$modal).click(function (e) {\n            e.preventDefault();\n            self.hide();\n        });\n    },\n\n    show: function () {\n        this.modal.show();\n    },\n\n    hide: function () {\n        this.modal.hide();\n    },\n\n    initData: function () {\n        var self = this;\n\n        self.data = {};\n        // get selection BEFORE..\n        // This is pulled from TinyMCE link plugin\n        self.initialText = null;\n        var value;\n        self.rng = self.tiny.selection.getRng();\n        self.selectedElm = self.tiny.selection.getNode();\n        self.anchorElm = self.tiny.dom.getParent(self.selectedElm, \"a[href]\");\n        self.onlyText = self.isOnlyTextSelected();\n\n        self.data.text = self.initialText = self.anchorElm\n            ? self.anchorElm.innerText || self.anchorElm.textContent\n            : self.tiny.selection.getContent({ format: \"text\" });\n        self.data.href = self.anchorElm\n            ? self.tiny.dom.getAttrib(self.anchorElm, \"href\")\n            : \"\";\n\n        if (self.anchorElm) {\n            self.data.target = self.tiny.dom.getAttrib(self.anchorElm, \"target\");\n        } else if (self.tiny.settings.default_link_target) {\n            self.data.target = self.tiny.settings.default_link_target;\n        }\n\n        if ((value = self.tiny.dom.getAttrib(self.anchorElm, \"rel\"))) {\n            self.data.rel = value;\n        }\n\n        if ((value = self.tiny.dom.getAttrib(self.anchorElm, \"class\"))) {\n            self.data[\"class\"] = value;\n        }\n\n        if ((value = self.tiny.dom.getAttrib(self.anchorElm, \"title\"))) {\n            self.data.title = value;\n        }\n\n        self.tiny.focus();\n        self.anchorElm = self.dom.getParent(self.selectedElm, \"a[href]\");\n\n        var linkType;\n        if (self.isImageMode()) {\n            var img;\n            img = self.selectedElm;\n            self.imgElm = img;\n\n            var src = self.dom.getAttrib(self.imgElm, \"src\");\n            var captionText = self.dom.getAttrib(self.imgElm, \"data-captiontext\");\n            self.$title.val(self.dom.getAttrib(self.imgElm, \"title\"));\n            self.$alt.val(self.dom.getAttrib(self.imgElm, \"alt\"));\n\n            if ($(self.imgElm).hasClass(\"zoomable\")) {\n                self.$enableImageZoom.prop(\"checked\", true);\n            }\n            if ($(self.imgElm).hasClass(\"captioned\") && !captionText) {\n                self.$captionFromDescription.prop(\"checked\", true);\n                self.$caption.prop(\"disabled\", true);\n            } else if ($(self.imgElm).hasClass(\"captioned\") && captionText) {\n                self.$captionFromDescription.prop(\"checked\", false);\n            } else {\n                self.$captionFromDescription.prop(\"checked\", false);\n            }\n            if (captionText) {\n                self.$caption.val(captionText);\n            }\n\n            linkType = self.dom.getAttrib(self.imgElm, \"data-linktype\");\n            if (linkType && (linkType in self.linkTypes)) {\n                self.linkType = linkType;\n                self.linkTypes[self.linkType].load(self.imgElm);\n                // set scale selection in link modal:\n                var pictureVariant = self.dom.getAttrib(\n                    self.imgElm,\n                    \"data-picturevariant\"\n                );\n                self.$scale.val(pictureVariant);\n                $(\"#tinylink-\" + self.linkType, self.modal.$modal).trigger(\"click\");\n            } else if (src) {\n                self.guessImageLink(src);\n            }\n            var className = self.dom.getAttrib(self.imgElm, \"class\");\n            var klasses = className.split(\" \");\n            for (var i = 0; i < klasses.length; i = i + 1) {\n                var klass = klasses[i];\n                for (var availClass in self.options.imageClasses) {\n                    if (availClass.indexOf(klass) !== -1) {\n                        self.$align.val(klass);\n                    }\n                }\n            }\n        } else if (self.anchorElm) {\n            self.focusElement(self.anchorElm);\n            var href = \"\";\n            href = self.dom.getAttrib(self.anchorElm, \"href\");\n            self.$target.val(self.dom.getAttrib(self.anchorElm, \"target\"));\n            self.$title.val(self.dom.getAttrib(self.anchorElm, \"title\"));\n            linkType = self.dom.getAttrib(self.anchorElm, \"data-linktype\");\n            if (linkType) {\n                self.linkType = linkType;\n                self.linkTypes[self.linkType].load(self.anchorElm);\n                var $panel = $(\"#tinylink-\" + self.linkType, self.modal.$modal);\n                // $('#tinylink-' + self.linkType, self.modal.$modal).trigger('click');\n                if ($panel.length === 1) {\n                    $(\"#\" + $panel.data(\"autotoc-trigger-id\")).trigger(\"click\");\n                }\n            } else if (href) {\n                self.guessAnchorLink(href);\n            }\n        }\n    },\n\n    guessImageLink: function (src) {\n        if (src.indexOf(this.options.prependToScalePart) !== -1) {\n            this.linkType = \"image\";\n            // TODO: use data-scale attribute instead:\n            this.$scale.val(this.tinypattern.getScaleFromUrl(src));\n            this.linkTypes.image.set(this.tinypattern.stripGeneratedUrl(src));\n        } else {\n            this.linkType = \"externalImage\";\n            this.linkTypes.externalImage.set(src);\n        }\n    },\n\n    guessAnchorLink: function (href) {\n        if (\n            this.options.prependToUrl &&\n            href.indexOf(this.options.prependToUrl) !== -1\n        ) {\n            // XXX if using default configuration, it gets more difficult\n            // here to detect internal urls so this might need to change...\n            this.linkType = \"internal\";\n            this.linkTypes.internal.set(this.tinypattern.stripGeneratedUrl(href));\n        } else if (href.indexOf(\"mailto:\") !== -1) {\n            this.linkType = \"email\";\n            var email = href.substring(\"mailto:\".length, href.length);\n            var split = email.split(\"?subject=\");\n            this.linkTypes.email.set(split[0]);\n            if (split.length > 1) {\n                this.$subject.val(decodeURIComponent(split[1]));\n            }\n        } else if (href[0] === \"#\") {\n            this.linkType = \"anchor\";\n            this.linkTypes.anchor.set(href.substring(1));\n        } else {\n            this.linkType = \"external\";\n            this.linkTypes.external.set(href);\n        }\n    },\n\n    setSelectElement: function ($el, val) {\n        $el.find(\"option:selected\").prop(\"selected\", false);\n        if (val) {\n            // update\n            $el.find('option[value=\"' + val + '\"]').prop(\"selected\", true);\n        }\n    },\n\n    reinitialize: function () {\n        /*\n         * This will probably be called before show is run.\n         * It will overwrite the base html template given to\n         * be able to privde default values for the overlay\n         */\n        this.modal.options.html = this.generateModalHtml();\n    },\n});\n","import $ from \"jquery\";\nimport _ from \"underscore\";\nimport _t from \"../../core/i18n-wrapper\";\nimport Base from \"@patternslib/patternslib/src/core/base\";\nimport utils from \"../../core/utils\";\n\nlet Dropzone;\n\nexport default Base.extend({\n    name: \"upload\",\n    trigger: \".pat-upload\",\n    parser: \"mockup\",\n    defaults: {\n        showTitle: true,\n        url: null, // XXX MUST provide url to submit to OR be in a form\n        className: \"upload\",\n        wrap: false,\n        wrapperTemplate: '<div class=\"upload-wrapper\"/>',\n        fileaddedClassName: \"dropping\",\n        useTus: false,\n        container: \"\",\n        ajaxUpload: true,\n\n        paramName: \"file\",\n        addRemoveLinks: false,\n        autoCleanResults: true,\n        previewsContainer: \".previews\",\n        previewTemplate: null,\n        maxFiles: null,\n        maxFilesize: 99999999, // let's not have a max by default...\n\n        allowPathSelection: undefined,\n        relatedItems: {\n            // UID attribute is required here since we're working with related items\n            attributes: [\n                \"UID\",\n                \"Title\",\n                \"Description\",\n                \"getURL\",\n                \"portal_type\",\n                \"path\",\n                \"ModificationDate\",\n            ],\n            batchSize: 20,\n            basePath: \"/\",\n            vocabularyUrl: null,\n            width: 500,\n            maximumSelectionSize: 1,\n            selectableTypes: [\"Folder\"],\n        },\n    },\n\n    init: async function () {\n        import(\"dropzone/dist/dropzone.css\");\n        import(\"./upload.scss\");\n        Dropzone = (await import(\"dropzone\")).default;\n        /* we do not want this plugin to auto discover */\n        Dropzone.autoDiscover = false;\n\n        const UploadTemplate = (await import(\"./templates/upload.xml\")).default;\n\n        var self = this;\n\n        if (typeof self.options.allowPathSelection === \"undefined\") {\n            // Set allowPathSelection to true, if we can use path based urls.\n            self.options.allowPathSelection =\n                self.options.baseUrl && self.options.relativePath;\n        }\n\n        // TODO: find a way to make this work in firefox (and IE)\n        $(document).bind(\"paste\", function (e) {\n            var oe = e.originalEvent;\n            var items = oe.clipboardData.items;\n            if (items) {\n                for (var i = 0; i < items.length; i++) {\n                    if (items[i].type.indexOf(\"image\") !== -1) {\n                        var blob = items[i].getAsFile();\n                        self.dropzone.addFile(blob);\n                    }\n                }\n            }\n        });\n        // values that will change current processing\n        self.currentPath = self.options.currentPath;\n        self.currentFile = 0;\n\n        let template = _.template(UploadTemplate)({\n            _t: _t,\n            allowPathSelection: self.options.allowPathSelection,\n        });\n        self.$el.addClass(self.options.className);\n        self.$el.append(template);\n\n        self.$progress = $(\".progress-bar-success\", self.$el);\n\n        if (!self.options.showTitle) {\n            self.$el.find(\"h2.title\").hide();\n        }\n\n        if (!self.options.ajaxUpload) {\n            // no ajax upload, drop the fallback\n            $(\".fallback\", this.$el).remove();\n            if (this.$el.hasClass(\".upload-container\")) {\n                this.$el.addClass(\"no-ajax-upload\");\n            } else {\n                this.$el.closest(\".upload-container\").addClass(\"no-ajax-upload\");\n            }\n        }\n\n        if (self.options.wrap) {\n            self.$el.wrap(self.options.wrapperTemplate);\n            self.$el = self.$el.parent();\n        }\n\n        if (self.options.allowPathSelection) {\n            // only use related items if we can generate path based urls and if it's not turned off.\n            self.$pathInput = $('input[name=\"location\"]', self.$el);\n            self.relatedItems = await self.setupRelatedItems(self.$pathInput);\n        } else {\n            $('input[name=\"location\"]', self.$el).parent().remove();\n            self.relatedItems = null;\n        }\n\n        self.$dropzone = $(\".upload-area\", self.$el);\n\n        $(\"div.browse-select button.browse\", self.$el).click(function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            if (\n                !self.options.maxFiles ||\n                self.dropzone.files.length < self.options.maxFiles\n            ) {\n                self.dropzone.hiddenFileInput.click();\n            }\n        });\n\n        var dzoneOptions = await this.getDzoneOptions();\n\n        try {\n            // if init of Dropzone fails it says nothing and\n            // it fails silently. Using this block we make sure\n            // that if you break it w/ some weird or missing option\n            // you can get a proper log of it\n            //\n            self.dropzone = new Dropzone(self.$dropzone[0], dzoneOptions);\n        } catch (e) {\n            if (window.DEBUG) {\n                // log it!\n                console.log(e);\n            }\n            throw e;\n        }\n\n        self.dropzone.on(\"maxfilesreached\", function () {\n            self.showHideControls();\n        });\n\n        self.dropzone.on(\"addedfile\", function (/* file */) {\n            self.showHideControls();\n        });\n\n        self.dropzone.on(\"removedfile\", function () {\n            self.showHideControls();\n        });\n\n        self.dropzone.on(\"success\", function (e, response) {\n            // Trigger event 'uploadAllCompleted' and pass the server's reponse and\n            // the path uid. This event can be listened to by patterns using the\n            // upload pattern, e.g. the TinyMCE pattern's link plugin.\n            var data;\n            try {\n                data = $.parseJSON(response);\n            } catch (ex) {\n                data = response;\n            }\n            self.$el.trigger(\"uploadAllCompleted\", {\n                data: data,\n                path_uid: self.$pathInput ? self.$pathInput.val() : null,\n            });\n        });\n\n        if (self.options.autoCleanResults) {\n            self.dropzone.on(\"complete\", function (file) {\n                if (file.status === Dropzone.SUCCESS) {\n                    setTimeout(function () {\n                        $(file.previewElement).fadeOut();\n                    }, 3000);\n                }\n            });\n        }\n\n        self.dropzone.on(\"complete\", function (file) {\n            if (file.status === Dropzone.SUCCESS && self.dropzone.files.length === 1) {\n                self.showHideControls();\n            }\n        });\n\n        self.dropzone.on(\"error\", function (file, response, xmlhr) {\n            if (typeof xmlhr !== \"undefined\" && xmlhr.status !== 403) {\n                // If error other than 403, just print a generic message\n                $(\".dz-error-message span\", file.previewElement).html(\n                    _t(\"The file transfer failed\")\n                );\n            }\n        });\n\n        self.dropzone.on(\"totaluploadprogress\", function (pct) {\n            // need to caclulate total pct here in reality since we're manually\n            // processing each file one at a time.\n            pct =\n                (((self.currentFile - 1) * 100 + pct) /\n                    (self.dropzone.files.length * 100)) *\n                100;\n            self.$progress.attr(\"aria-valuenow\", pct).css(\"width\", pct + \"%\");\n        });\n\n        $(\".upload-all\", self.$el).click(function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            self.processUpload({\n                finished: function () {\n                    self.$progress.attr(\"aria-valuenow\", 0).css(\"width\", \"0%\");\n                },\n            });\n        });\n        if (self.options.clipboardfile) {\n            self.dropzone.addFile(self.options.clipboardfile);\n        }\n    },\n\n    showHideControls: function () {\n        /* we do this delayed because this can be called multiple times\n         AND we need to do this hide/show AFTER dropzone is done with\n         all it's own events. This is NASTY but the only way we can\n         enforce some numFiles with dropzone! */\n        var self = this;\n        if (self._showHideTimeout) {\n            clearTimeout(self._showHideTimeout);\n        }\n        self._showHideTimeout = setTimeout(function () {\n            self._showHideControls();\n        }, 50);\n    },\n\n    _showHideControls: function () {\n        var self = this;\n        var $controls = $(\".controls\", self.$el);\n        var $browse = $(\".browse-select\", self.$el);\n        var $input = $(\".dz-hidden-input\");\n\n        if (self.options.maxFiles) {\n            if (self.dropzone.files.length < self.options.maxFiles) {\n                $browse.show();\n                $input.prop(\"disabled\", false);\n            } else {\n                $browse.hide();\n                $input.prop(\"disabled\", true);\n            }\n        }\n        if (self.dropzone.files.length > 0) {\n            $controls.fadeIn(\"slow\");\n            var file = self.dropzone.files[0];\n            $(\".dz-error-message span\", file.previewElement).html(\"\");\n        } else {\n            $controls.fadeOut(\"slow\");\n        }\n    },\n\n    pathJoin: function () {\n        var parts = [];\n        _.each(arguments, function (part) {\n            if (!part) {\n                return;\n            }\n            if (part[0] === \"/\") {\n                part = part.substring(1);\n            }\n            if (part[part.length - 1] === \"/\") {\n                part = part.substring(0, part.length - 1);\n            }\n            parts.push(part);\n        });\n        return parts.join(\"/\");\n    },\n\n    getUrl: function () {\n        var self = this;\n        var url = self.options.url;\n        if (!url) {\n            if (self.options.baseUrl && self.options.relativePath) {\n                url = self.options.baseUrl;\n                if (url[url.length - 1] !== \"/\") {\n                    url = url + \"/\";\n                }\n                url = url + self.pathJoin(self.currentPath, self.options.relativePath);\n            } else {\n                var $form = self.$el.parents(\"form\");\n                if ($form.length > 0) {\n                    url = $form.attr(\"action\");\n                } else {\n                    url = window.location.href;\n                }\n            }\n        }\n        return url;\n    },\n\n    getDzoneOptions: async function () {\n        let PreviewTemplate = await import(\"./templates/preview.xml\");\n        PreviewTemplate = PreviewTemplate.default;\n\n        var self = this;\n\n        // This pattern REQUIRE dropzone to be clickable\n        self.options.clickable = true;\n\n        var options = $.extend({}, self.options);\n        options.url = self.getUrl();\n\n        options.headers = {\n            \"X-CSRF-TOKEN\": utils.getAuthenticator(),\n        };\n\n        // XXX force to only upload one to the server at a time,\n        // right now we don't support multiple for backends\n        options.uploadMultiple = false;\n\n        delete options.wrap;\n        delete options.wrapperTemplate;\n        delete options.resultTemplate;\n        delete options.autoCleanResults;\n        delete options.fileaddedClassName;\n        delete options.useTus;\n\n        if (self.options.previewsContainer) {\n            /*\n             * if they have a select but it's not an id, let's make an id selector\n             * so we can target the correct container. dropzone is weird here...\n             */\n            var $preview = self.$el.find(self.options.previewsContainer);\n            if ($preview.length > 0) {\n                options.previewsContainer = $preview[0];\n            }\n        }\n\n        // XXX: do we need to allow this?\n        options.autoProcessQueue = false;\n        // options.addRemoveLinks = true;  // we show them in the template\n        options.previewTemplate = PreviewTemplate;\n\n        // if our element is a form we should force some values\n        // https://github.com/enyo/dropzone/wiki/Combine-normal-form-with-Dropzone\n        return options;\n    },\n\n    processUpload: function (options) {\n        if (!options) {\n            options = {};\n        }\n\n        var self = this,\n            processing = false,\n            useTus = self.options.useTus,\n            fileaddedClassName = self.options.fileaddedClassName,\n            finished = options.finished;\n\n        self.currentFile = 0;\n\n        function process() {\n            processing = true;\n            if (self.dropzone.files.length === 0) {\n                processing = false;\n            }\n\n            var file = self.dropzone.files[0];\n            if (processing && file.status === Dropzone.ERROR) {\n                // Put the file back as \"queued\" for retrying\n                file.status = Dropzone.QUEUED;\n                processing = false;\n            }\n\n            if (!processing) {\n                self.$el.removeClass(fileaddedClassName);\n                if (finished !== undefined && typeof finished === \"function\") {\n                    finished();\n                }\n                return;\n            }\n\n            if ([Dropzone.SUCCESS, Dropzone.CANCELED].indexOf(file.status) !== -1) {\n                // remove it\n                self.dropzone.removeFile(file);\n                process();\n            } else if (file.status !== Dropzone.UPLOADING) {\n                // start processing file\n                if (useTus && window.tus) {\n                    // use tus upload if installed\n                    self.handleTusUpload(file);\n                } else {\n                    // otherwise, just use dropzone to process\n                    self.currentFile += 1;\n                    self.dropzone.processFile(file);\n                }\n                setTimeout(process, 100);\n            } else {\n                // currently processing\n                setTimeout(process, 100);\n            }\n        }\n        process();\n    },\n\n    handleTusUpload: function (file) {\n        /* this needs fixing... */\n        var self = this,\n            $preview = $(file.previewElement),\n            chunkSize = 1024 * 1024 * 5; // 5mb chunk size\n\n        file.status = Dropzone.UPLOADING;\n\n        window.tus\n            .upload(file, {\n                endpoint: self.dropzone.options.url,\n                headers: {\n                    \"FILENAME\": file.name,\n                    \"X-CSRF-TOKEN\": utils.getAuthenticator(),\n                },\n                chunkSize: chunkSize,\n            })\n            .fail(function () {\n                if (window.DEBUG) {\n                    console.alert(_t(\"Error uploading with TUS resumable uploads\"));\n                }\n                file.status = Dropzone.ERROR;\n            })\n            .progress(function (e, bytesUploaded, bytesTotal) {\n                var percentage = (bytesUploaded / bytesTotal) * 100;\n                self.$progress\n                    .attr(\"aria-valuenow\", percentage)\n                    .css(\"width\", percentage + \"%\");\n                self.$progress.html(\n                    _t(\"uploading...\") +\n                        \"<br />\" +\n                        self.formatBytes(bytesUploaded) +\n                        \" / \" +\n                        self.formatBytes(bytesTotal)\n                );\n            })\n            .done(function (url, file) {\n                file.status = Dropzone.SUCCESS;\n                self.dropzone.emit(\"success\", file);\n                self.dropzone.emit(\"complete\", file);\n            });\n    },\n\n    formatBytes: function (bytes) {\n        var kb = Math.round(bytes / 1024);\n        if (kb < 1024) {\n            return kb + \" KiB\";\n        }\n        var mb = Math.round(kb / 1024);\n        if (mb < 1024) {\n            return mb + \" MB\";\n        }\n        return Math.round(mb / 1024) + \" GB\";\n    },\n\n    setPath: function (path) {\n        var self = this;\n        self.currentPath = path;\n        self.options.url = null;\n        self.options.url = self.dropzone.options.url = self.getUrl();\n    },\n\n    setupRelatedItems: async function ($input) {\n        const RelatedItems = (await import(\"../relateditems/relateditems\")).default;\n\n        var self = this;\n        var options = self.options.relatedItems;\n        options.upload = false; // ensure that related items upload is off.\n        if (self.options.initialFolder) {\n            $input.attr(\"value\", self.options.initialFolder);\n        }\n        var ri = new RelatedItems($input, options);\n        ri.$el.on(\"change\", function () {\n            var result = $(this).select2(\"data\");\n            var path = null;\n            if (result.length > 0) {\n                path = result[0].path;\n            }\n            self.setPath(path);\n        });\n        return ri;\n    },\n});\n"],"names":["i","Base","name","trigger","parser","defaults","separator","initializeValues","self","this","options","initialValues","id","term","initSelection","$el","callback","data","value","val","seldefaults","JSON","parse","$","split","each","selection","text","push","utils","initializeTags","tags","substr","allowNewItems","multiple","initializeOrdering","orderable","Sortable","default","_initializeOrdering","sortable_el","$select2","querySelector","draggable","dragClass","chosenClass","onStart","select2","onEnd","on","bind","initializeSelect2","action","e","debug","console","window","language","warn","formatResultCssClass","ob","toLowerCase","replace","el","onSelected","onSelecting","onDeselecting","onDeselected","parent","find","off","addClass","opened","length","init","i18n","I18n","currentLanguage","hasOwnProperty","ajax","vocabularyUrl","undefined","url","queryTerm","quietMillis","page","query","page_limit","results","dataIds","item","haveResult","is","vals","o","html","$hidden","join","attr","$orig","replaceWith","KEY","currentPath","selectedUIDs","openAfterInit","attributes","basePath","pageSize","browsing","closeOnSelect","contextPath","dropdownCssClass","favorites","recentlyUsed","recentlyUsedMaxItems","recentlyUsedKey","maximumSelectionSize","minimumInputLength","mode","pathOperator","rootPath","rootUrl","scanSelection","selectableTypes","sortOn","sortOrder","tokenSeparators","upload","uploadAllowView","breadcrumbTemplateSelector","favoriteTemplateSelector","recentlyusedTemplateSelector","resultTemplateSelector","selectionTemplateSelector","toolbarTemplateSelector","filterSelectable","ret","slice","filter","isSelectable","max","parseInt","applyTemplate","tpl","template","open_folder","_t","current_directory","one_level_up","_item","_","setAjax","dataType","criterias","v","sort_on","sort_order","stringify","criteria","batch","size","more","total","map","UID","is_folderish","indexOf","path","oneLevelUp","Title","selectable","concat","renderToolbar","initUploadView","disabled","Upload","upload_button","$toolbar","upload_el","upload_config","success","response","uid","search","apply","emit","popover","hide","uloadMultiple","allowPathSelection","relativePath","baseUrl","addEventListener","setPath","paths","itemPath","itemsHtml","node","favoritesHtml","item_copy","recentlyUsedHtml","reverse","items","favItems","favText","searchText","searchModeText","browseModeText","recentlyUsedItems","recentlyUsedText","icon_root","icon_recently_used","icon_favorites","icon_upload","upload_text","unbind","stopPropagation","preventDefault","toggleClass","browseTo","event","it","selectItem","type","result","allowUpload","alreadyPresent","splice","deselectItem","obj","portal_type","Dropdown","breadcrumbTemplate","favoriteTemplate","recentlyusedTemplate","resultTemplate","selectionTemplate","toolbarTemplate","wrap","$container","parents","Select2","formatSelection","getIcon","getURL","review_state","$selection","registry","path_split","icon_level_up","icon_level_down","formatResult","iconLevelUp","iconLevelDown","$parent","removeClass","element","ids","pattern","reduce","prev","tokenizer","input","prepend","choice","document","which","selectorContext","browsableItem","section","levels","IDPrefix","classTOCName","classSectionName","classLevelPrefixName","classActiveName","scrollDuration","scrollEasing","$toc","prependTo","appendTo","className","asTabs","hasClass","activeId","$level","prop","location","hash","getLevel","doScroll","skipHash","children","target","animate","scrollTop","offset","top","history","pushState","first","elementLevel","level","levelSelector","LinkType","linkModal","tinypattern","tiny","dom","getEl","toUrl","load","getAttrib","set","updateRelatedItems","ExternalLink","extend","prototype","call","RegExp","test","InternalLink","createRelatedItems","relatedItems","RelatedItems","generateUrl","UploadLink","getDelegatedLinkType","linkType","linkTypes","image","internal","ImageLink","generateImageUrl","getScaleFromSrcset","$scale","EmailLink","subject","getSubject","href","$subject","attribs","AnchorLink","$select","anchorNodes","anchorData","populate","j","title","remove","nodes","select","anchorSelector","substring","found","anode","newAnchor","append","getIndex","index","innerHTML","anchor","tinymce","editor","ui","addButton","icon","tooltip","onAction","settings","addImageClicked","shortcut","addLinkClicked","stateSelector","execCommand","initialLinkType","insertHeading","linkTypeClassMapping","external","email","uploadImage","externalImage","linkTypeTemplateMapping","LinkTemplate","ImageTemplate","modal","generateModalHtml","content","buttons","reloadWindowOnClose","templateOptions","classDialog","actionOptions","backdropOptions","zIndex","closeOnClick","modalShown","isOnlyTextSelected","getContent","anchorElm","childNodes","ii","nodeType","insertImageHelp","uploadText","insertLinkHelp","anchorLabel","externalText","emailText","subjectText","targetList","titleText","internalImageText","internalImage","externalImageText","altText","alt","imageAlignText","imageAlign","captionFromDescriptionText","captionFromDescription","enableImageZoom","captionText","caption","scaleText","scale","pictureVariants","imageCaptioningEnabled","cancelBtn","insertBtn","isImageMode","initElements","$target","$modal","$button","$title","$alt","$align","$enableImageZoom","$captionFromDescription","$caption","click","classes","eq","change","checked","getLinkUrl","getValue","updateAnchor","focus","setRng","rng","linkAttrs","onlyText","initialText","innerText","textContent","setAttribs","undoManager","add","insertContent","createHTML","encode","focusElement","elm","nodeChanged","pictureVariant","pictureVariantsConfig","sourceset","updateImage","src","cssclasses","html_string","imgElm","getAttribute","imgWidth","imgHight","width","height","get","setAttrib","onload","onerror","complete","initData","$upload","folderTypes","PatternUpload","evt","patUpload","patternUpload","dropzone","files","processUpload","counter","checkUpload","setTimeout","error","show","getRng","selectedElm","getNode","getParent","format","default_link_target","rel","img","guessImageLink","klasses","klass","availClass","imageClasses","$panel","guessAnchorLink","prependToScalePart","getScaleFromUrl","stripGeneratedUrl","prependToUrl","decodeURIComponent","setSelectElement","reinitialize","Dropzone","showTitle","wrapperTemplate","fileaddedClassName","useTus","container","ajaxUpload","paramName","addRemoveLinks","autoCleanResults","previewsContainer","previewTemplate","maxFiles","maxFilesize","batchSize","autoDiscover","UploadTemplate","originalEvent","clipboardData","blob","getAsFile","addFile","currentFile","$progress","closest","$pathInput","setupRelatedItems","$dropzone","hiddenFileInput","getDzoneOptions","dzoneOptions","DEBUG","log","showHideControls","ex","path_uid","file","status","SUCCESS","previewElement","fadeOut","xmlhr","pct","css","finished","clipboardfile","_showHideTimeout","clearTimeout","_showHideControls","$controls","$browse","$input","fadeIn","pathJoin","parts","arguments","part","getUrl","$form","PreviewTemplate","clickable","headers","uploadMultiple","$preview","autoProcessQueue","processing","process","ERROR","QUEUED","CANCELED","removeFile","UPLOADING","tus","handleTusUpload","processFile","endpoint","chunkSize","fail","alert","progress","bytesUploaded","bytesTotal","percentage","formatBytes","done","bytes","kb","Math","round","mb","initialFolder","ri"],"sourceRoot":""}