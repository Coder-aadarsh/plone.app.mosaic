"use strict";(self.webpackChunkplone_mosaic=self.webpackChunkplone_mosaic||[]).push([[79277,41973],{41973:function(e,t,i){i.r(t),i.d(t,{default:function(){return c}});var a=i(99269),n=i.n(a),r=i(46562);function o(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return l(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return o=e.done,e},e:function(e){s=!0,r=e},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw r}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function s(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var c=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,this.panels=i}var t,i,a;return t=e,(i=[{key:"initialize",value:function(){var e=n()(".mosaic-original-content");this.form=n()("form",e),e.hide(),this.modal=new r.Z(n()(".outer-wrapper"),{title:n()("h1",e).text(),target:".mosaic-original-content form",modalSizeClass:"modal-xl"})}},{key:"open",value:function(e,t){var i,a,r,l,s=this;if(s.modal.show(),"all"===e&&s.options.overlay_hide_fields){(i=s.form.find("nav")).removeClass("mosaic-hidden"),s.form.find("fieldset").children().removeClass("mosaic-hidden"),s.form.find("fieldset").removeClass("active"),i.find("a").removeClass("active"),s.form.find(s.options.customContentLayout_selector).addClass("mosaic-hidden"),s.form.find(s.options.contentLayout_selector).addClass("mosaic-hidden"),n()(".mosaic-IDublinCore-title-tile").length>0?s.form.find("#formfield-form-widgets-IDublinCore-title").addClass("mosaic-hidden"):s.form.find("#formfield-form-widgets-IDublinCore-title").removeClass("mosaic-hidden"),n()(".mosaic-IDublinCore-description-tile").length>0?s.form.find("#formfield-form-widgets-IDublinCore-description").addClass("mosaic-hidden"):s.form.find("#formfield-form-widgets-IDublinCore-description").removeClass("mosaic-hidden");var c,d={},f=o(s.options.tiles);try{for(f.s();!(c=f.n()).done;){var u=c.value;if("fields"===u.name){d=u;break}}}catch(e){f.e(e)}finally{f.f()}var m,h=o(d.tiles);try{for(h.s();!(m=h.n()).done;){var p=m.value;0!==s.panels.find(".mosaic-"+p.name+"-tile").length&&n()("#"+p.id).addClass("mosaic-hidden")}}catch(e){h.e(e)}finally{h.f()}s.form.find("fieldset").each((function(){0===n()(this).children("div:not(.mosaic-hidden)").length&&n()("a[href=#fieldsetlegend-"+n()(this).attr("id").split("-")[1]+"]").addClass("mosaic-hidden")})),(a=i.children(":not(.mosaic-hidden)")).eq(0).addClass("active");var v=s.form.find("#fieldset-"+a.eq(0).attr("href").split("-")[1]);0===v.length&&(v=s.form.find("fieldset:not(.mosaic-hidden)").eq(0)),v.addClass("active")}else"field"===e&&(l=(r=n()("#"+t.id)).parents("fieldset"),s.form.find("fieldset").removeClass("active"),l.addClass("active"),l.children().addClass("mosaic-hidden"),r.removeClass("mosaic-hidden"),s.form.find("nav").addClass("mosaic-hidden"))}}])&&s(t.prototype,i),a&&s(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}()},79277:function(e,t,i){i.r(t);i(35666);var a=i(99269),n=i.n(a),r=(i(98860),i(62832)),o=i(72324),l=i(89867),s=i(46562),c=i(79472);i(41973);function d(e,t,i,a,n,r,o){try{var l=e[r](o),s=l.value}catch(e){return void i(e)}l.done?t(s):Promise.resolve(s).then(a,n)}function f(e){return function(){var t=this,i=arguments;return new Promise((function(a,n){var r=e.apply(t,i);function o(e){d(r,a,n,o,l,"next",e)}function l(e){d(r,a,n,o,l,"throw",e)}o(void 0)}))}}function u(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return m(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,l=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return o=e.done,e},e:function(e){l=!0,r=e},f:function(){try{o||null==i.return||i.return()}finally{if(l)throw r}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function h(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var p=l.Z.getLogger("pat-mosaic/tile"),v={},g={delete:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash3" viewBox="0 0 16 16"><path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5ZM11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H2.506a.58.58 0 0 0-.01 0H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1h-.995a.59.59 0 0 0-.01 0H11Zm1.958 1-.846 10.58a1 1 0 0 1-.997.92h-6.23a1 1 0 0 1-.997-.92L3.042 3.5h9.916Zm-7.487 1a.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 0 1-.998.06L5 5.03a.5.5 0 0 1 .47-.53Zm5.058 0a.5.5 0 0 1 .47.53l-.5 8.5a.5.5 0 1 1-.998-.06l.5-8.5a.5.5 0 0 1 .528-.47ZM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5Z"/></svg>',cancel:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/></svg>',confirm:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/></svg>',edit:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16"><path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/><path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/></svg>',settings:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-sliders" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M11.5 2a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM9.05 3a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0V3h9.05zM4.5 7a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM2.05 8a2.5 2.5 0 0 1 4.9 0H16v1H6.95a2.5 2.5 0 0 1-4.9 0H0V8h2.05zm9.45 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm-2.45 1a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0v-1h9.05z"/></svg>'},y=[],w=function(){function e(t,i){var a,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o=["table","numbers","bullets","text","subheading","heading"],(r="deprecatedHTMLTiles")in(a=this)?Object.defineProperty(a,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):a[r]=o;var l=this;l.mosaic=t,l.el=i,l.$el=n()(i),l.$el.is(".mosaic-tile")||(l.$el=l.$el.parents(".mosaic-tile")),l.focusCheckCount=0}var t,a,l,d,m,w,b;return t=e,a=[{key:"getDataTileEl",value:function(){return this.$el.find("[data-tile]")}},{key:"getContentEl",value:function(){return this.$el.children(".mosaic-tile-content")}},{key:"getHtmlContent",value:function(){return this.getContentEl().html()}},{key:"getEditUrl",value:function(){var e=this.getUrl();if(e&&(e=e.replace(/@@/,"@@edit-tile/")))return e.match(/^\.\/.*/)&&(e=this.mosaic.options.context_url+e.replace(/^\./,"")),e}},{key:"getDeleteUrl",value:function(){var e=this.getUrl().split("?")[0],t=(e=e.split("@@"))[1].split("/");return(e=e[0]+"@@delete-tile/"+t[0]+"/"+t[1]).match(/^\.\/.*/)&&(e=this.mosaic.options.context_url+e.replace(/^\./,"")),e}},{key:"getUrl",value:function(){var e=this.$el.find(".tileUrl").html();if(!e){var t=this.$el.find("[data-tileUrl]");t.length>0&&(e=t.attr("data-tileUrl"))}if(e||(e=this.$el.find("[data-tile]").attr("data-tile")),e)for(e=(e=e.replace(this.mosaic.options.context_url,"./")).replace(/^\.\/\//,"./"),this.mosaic.hasContentLayout?-1===e.indexOf("X-Tile-Persistent")&&(-1===e.indexOf("?")?e+="?":e+="&",e+="X-Tile-Persistent=yes"):-1!==e.indexOf("X-Tile-Persistent")&&(e=e.replace("X-Tile-Persistent=yes","").replace("&&","&"));-1!==e.indexOf("&_layouteditor=true");)e=e.replace("&_layouteditor=true","");return e}},{key:"getType",value:function(){var e=this.$el.attr("class");if(e in v)return v[e];var t="";if(void 0!==e){var i,a=u(e.split(" "));try{for(a.s();!(i=a.n()).done;){var n=i.value.match(/^mosaic-([\w.\-]+)-tile$/);null!==n&&"selected"!==n[1]&&"new"!==n[1]&&"read-only"!==n[1]&&"helper"!==n[1]&&"original"!==n[1]&&"edited"!==n[1]&&(t=n[1])}}catch(e){a.e(e)}finally{a.f()}return t?p.info('Found tile type "'.concat(t,'" for in classnames "').concat(e,'"')):p.error("Could not find tile type on element ".concat(this.$el," with classes: ").concat(e)),v[e]=t,t}}},{key:"getConfig",value:function(){var e,t,i=this.getType(),a=u(this.mosaic.options.tiles);try{for(a.s();!(t=a.n()).done;){var n,r=t.value,o=!1,l=u(r.tiles);try{for(l.s();!(n=l.n()).done;){var s=n.value;if("field"===s.tile_type){var c=s.widget.split(".");switch(c=c[c.length-1]){case"TextWidget":case"TextFieldWidget":case"TextAreaWidget":case"TextAreaFieldWidget":case"TextLinesWidget":case"TextLinesFieldWidget":case"WysiwygWidget":case"WysiwygFieldWidget":case"RichTextWidget":case"RichTextFieldWidget":s.settings=!1;break;default:s.settings=!0}}if(s.name===i){e=s,o=!0;break}}}catch(e){l.e(e)}finally{l.f()}if(o)break}}catch(e){a.e(e)}finally{a.f()}return e||(-1===y.indexOf(i)&&(p.error("Could not load tile config for tile type: "+i+" falling back to b/w compatible tile type."),y.push(i)),e={tile_type:"app",name:i,label:"Unknown",read_only:!0,favorite:!1,settings:!1,weight:0,rich_text:!1},-1!==this.deprecatedHTMLTiles.indexOf(i)&&(e.category="structure",e.read_only=!1,e.label=i,e.tile_type="text",e.rich_text=!0)),e}},{key:"getHtmlBody",value:function(e){var t,i="",a=this.$el.attr("class").split(" ");switch(t=this.getType(),a=n()(a).filter((function(){switch(this){case"mosaic-new-tile":case"mosaic-helper-tile":case"mosaic-original-tile":case"mosaic-selected-tile":case"mosaic-edited-tile":return!1;default:return!0}})).toArray(),this.getConfig().tile_type){case"text":i+='<div class="'+a.join(" ")+'">\n',i+='<div class="mosaic-tile-content">\n',i+=this.$el.children(".mosaic-tile-content .mce-content-body").html()+"\n",i+="</div>\n",i+="</div>\n";break;case"app":case"textapp":var r=this.getUrl();if(e){var o=this.$el.children(".mosaic-tile-content .mce-content-body").html()+"\n";-1===r.indexOf("?")?r+="?":r+="&",r+="content="+encodeURI(o)}i+='<div class="'+a.join(" ")+'">\n',i+='<div class="mosaic-tile-content">\n',i+='<div data-tile="'+r+'"></div>\n',i+="</div>\n",i+="</div>\n";break;case"field":i+='<div class="'+a.join(" ")+'">\n',i+='<div class="mosaic-tile-content">\n';var l="./@@plone.app.standardtiles.field?field="+t,s=this.getValueFromClasses(a,"mosaic-subfield-");s&&(l+="&subfield="+s);var c=this.getValueFromClasses(a,"mosaic-format-");c&&(l+="&format="+c),i+='<div data-tile="'+l+'"></div>\n',i+="</div>\n",i+="</div>\n",this.saveForm()}return i}},{key:"isRichText",value:function(e){return!(this.$el.hasClass("mosaic-read-only-tile")||(void 0===e&&(e=this.getConfig()),!e||!("text"===e.tile_type&&e.rich_text||"textapp"===e.tile_type&&e.rich_text||"app"===e.tile_type&&e.rich_text)&&("field"!==e.tile_type||e.read_only||"plone.app.z3cform.widget.RichTextFieldWidget"!==e.widget&&"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"!==e.widget&&"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"!==e.widget&&"plone.app.widgets.dx.RichTextWidget"!==e.widget)))}},{key:"initialize",value:(b=f(regeneratorRuntime.mark((function e(){var t,i,a,r,o,l,s,c,d,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for((i=(t=this).getConfig())&&i.read_only&&t.$el.addClass("mosaic-read-only-tile"),t.$el.prepend(n()(t.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(n()(t.mosaic.document.createElement("div")).addClass("mosaic-tile-inner-border"))),i&&(a=n()(t.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-tile-side-tools"),t.$el.prepend(a.append(n()(t.mosaic.document.createElement("div")).addClass("mosaic-tile-label content").html(i.label))),t.$el.parent().hasClass("col")||(r=t.$el.parent().attr("class").split(" "),o=t.getValueFromClasses(r,"col-"),l=void 0===o?"":" ("+o+")",s=function(e){var t=document.createElement("a");return t.href="javascript:",t.textContent="Reset"+l,n()(t).on("click",e),t},a.append(n()(t.mosaic.document.createElement("div")).addClass("mosaic-tile-label reset").append(s(t.resetClicked.bind(this))).hide()))),t.makeMovable(),t.initializeButtons(),c=0,d=["top","bottom","right","left"];c<d.length;c++)f=d[c],t.$el.prepend(n()(t.mosaic.document.createElement("div")).addClass("mosaic-divider mosaic-divider-"+f).append(n()(t.mosaic.document.createElement("div")).addClass("mosaic-divider-dot")));t.el["mosaic-tile"]=t,t.$el.data("mosaic-tile",t);case 11:case"end":return e.stop()}}),e,this)}))),function(){return b.apply(this,arguments)})},{key:"resetClicked",value:function(e){e.preventDefault(),this.$el.parent().removeClass("col-1 col-2 col-3 col-4 col-5 col-6 col-7 col-8 col-9 col-10 col-11 col-12").addClass("col"),n()(e.target).closest(".reset").remove();var t=this.$el.parent().parent();t.mosaicCleanupRow(),t.mosaicSetResizeHandles()}},{key:"initializeButtons",value:function(){var e=[],t=this.getConfig();this.$el.find(".mosaic-tile-buttons").remove();var i=function(t,i,a){var r=document.createElement("button");return r.className="btn btn-sm btn-".concat("confirm"===i?"danger":"light"," mosaic-btn-").concat(i),r.textContent=t,e.push(r),n()(r).on("click",a),i in g?n()(r).prepend(g[i]+" "):p.warn('could not find button icon "'.concat(i,'"')),r};if(t&&t.settings&&!1===this.$el.hasClass("mosaic-read-only-tile")&&i("Edit","settings",this.settingsClicked.bind(this)),!this.mosaic.hasContentLayout){i("Delete","delete",this.deleteClicked.bind(this));var a=i("Confirm delete","confirm",this.confirmClicked.bind(this));n()(a).hide();var r=i("Cancel","cancel",this.cancelClicked.bind(this));n()(r).hide()}if(e.length>0){var o,l=n()("<div />").addClass("mosaic-tile-control mosaic-tile-buttons"),s=u(e);try{for(s.s();!(o=s.n()).done;){var c=o.value;l.append(c)}}catch(e){s.e(e)}finally{s.f()}this.$el.prepend(l)}}},{key:"cancelClicked",value:function(e){e.preventDefault(),n()(".mosaic-btn-settings,.mosaic-btn-delete",this.$el).show(),n()(".mosaic-btn-cancel,.mosaic-btn-confirm",this.$el).hide()}},{key:"deleteClicked",value:function(e){e.preventDefault(),n()(".mosaic-btn-settings,.mosaic-btn-delete",this.$el).hide(),n()(".mosaic-btn-cancel,.mosaic-btn-confirm",this.$el).show()}},{key:"confirmClicked",value:function(e){e.preventDefault();var t=this,i=this.getConfig();if("app"===i.tile_type||"textapp"===i.tile_type){var a=this.getUrl();a&&"undefined"!==a&&(this.mosaic.removeHeadTags(a),this.mosaic.queue((function(e){n().ajax({type:"POST",url:t.getDeleteUrl(),data:{"buttons.delete":"Delete",_authenticator:r.Z.getAuthenticator()}}).always((function(){e()}))})))}this.mosaic.panels.find(".mosaic-empty-row").remove();var o=this.$el.parent().parent();this.saveForm(),this.$el.remove(),o.mosaicCleanupRow(),this.mosaic.panels.mosaicAddEmptyRows(),this.mosaic.toolbar.SelectedTileChange()}},{key:"settingsClicked",value:function(e){e.preventDefault();var t=this,i=t.getConfig();if("app"===i.tile_type){var a=t.getEditUrl(),r=new s.Z(n()(".mosaic-toolbar"),{ajaxUrl:a,loadLinksWithinModal:!0});r.$el.off("after-render"),r.on("after-render",(function(e){n()('input[name*="cancel"]',r.$modal).on("click",(function(e){e.preventDefault(),r.hide(),r=null})),t.mosaic.hasContentLayout&&n()("form",r.$modal).append(n()('<input type="hidden" name="X-Tile-Persistent" value="yes" />'))})),r.show(),r.$el.off("formActionSuccess"),r.on("formActionSuccess",(function(e,i,a,n,o){var l=n.getResponseHeader("X-Tile-Url"),s=t.mosaic.getDomTreeFromHtml(i);if(l){t.mosaic.removeHeadTags(l),t.mosaic.addHeadTags(l,s);var c=s.find(".temp_body_tag").html();t.fillContent({html:c,url:l}),r.hide(),r=null}}))}else t.mosaic.overlay.open("field",i)}},{key:"makeMovable",value:function(){this.$el.hasClass("movable")&&this.mosaic.options.canChangeLayout&&!this.mosaic.hasContentLayout&&this.$el.prepend(n()(this.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-drag-handle"))}},{key:"getValueFromClasses",value:function(e,t){var i;return e.forEach((function(e){-1!==e.indexOf(t)&&(i=e.replace(t,""))})),i}},{key:"initializeContent",value:(w=f(regeneratorRuntime.mark((function e(){var t,i,a,r,o,l,s,c,d,u,m,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this,(s=n()("body",t.mosaic.document).attr("data-base-url"))||(s=n()("head > base",t.mosaic.document).attr("href")),c=this.getUrl(),"field"!==(d=this.getConfig()).tile_type){e.next=35;break}l="","IDublinCore-title"===d.name?(a='<h1 class="documentFirstHeading">',r="</h1>"):"IDublinCore-description"===d.name?(a='<p class="documentDescription">',r="</p>"):(a="<div>",r="</div>"),u=!1,m=!1,e.t0=d.widget,e.next="z3c.form.browser.text.TextWidget"===e.t0||"z3c.form.browser.text.TextFieldWidget"===e.t0?13:"z3c.form.browser.textarea.TextAreaWidget"===e.t0||"z3c.form.browser.textarea.TextAreaFieldWidget"===e.t0||"z3c.form.browser.textlines.TextLinesWidget"===e.t0||"z3c.form.browser.textlines.TextLinesFieldWidget"===e.t0?18:"plone.app.z3cform.widget.RichTextFieldWidget"===e.t0||"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"===e.t0||"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"===e.t0||"plone.app.widgets.dx.RichTextWidget"===e.t0?25:29;break;case 13:return o=n()("#"+d.id).find("input").attr("value"),l="".concat(a).concat(o).concat(r),u=!0,p.info('initialized TextWidget with val "'.concat(o,'"')),e.abrupt("break",32);case 18:return o=n()("#"+d.id).find("textarea").val().split("\n"),l+=a,l+=o.join("<br/>"),l+=r,u=!0,p.info('initialized Text[Area|Lines]Widget with val "'.concat(o,'"')),e.abrupt("break",32);case 25:return l=document.querySelectorAll("#".concat(d.id," textarea"))[0].value,m=!0,p.info('initialized RichTextWidget with val "'.concat(l,'"')),e.abrupt("break",32);case 29:return l='<div class="discreet">Placeholder for field:<br/><b>'+d.label+"</b></div>",p.info("initialized fallback field"),e.abrupt("break",32);case 32:t.fillContent({html:l,editable:!d.read_only&&u,wysiwyg:m}),e.next=36;break;case 35:d&&(t.$el.addClass("mosaic-tile-loading"),i=s?[s,c].join("/").replace(/\/+\.\//g,"/"):c,h=i,-1===i.indexOf("?")?i+="?":i+="&",-1===i.indexOf("_layouteditor")&&(i+="_layouteditor=true"),n().ajax({type:"POST",url:i,success:function(){var e=f(regeneratorRuntime.mark((function e(i){var a,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.$el.removeClass("mosaic-tile-loading"),i=t.mosaic.getDomTreeFromHtml(i),t.mosaic.addHeadTags(c,i),a=i.find(".temp_body_tag").html(),n=t.getType(),t.fillContent({html:a,url:h,wysiwyg:"plone.app.standardtiles.html"===n});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),error:function(){t.$el.removeClass("mosaic-tile-loading"),p.error("Error getting data for the tile "+d.label+"("+d.name+"). Please read documentation on how to correctly register tiles: https://pypi.python.org/pypi/plone.tiles")}}));case 36:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"fillContent",value:(m=f(regeneratorRuntime.mark((function e(t){var i,a,n,r,o,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.html,a=t.url,n=t.editable,r=t.wysiwyg,(o=this.getDataTileEl()).length>0?(o.parent().html(i),l=this.getContentEl()):(l=this.getContentEl()).html(i),n&&l.attr("contenteditable",!0),a&&l.length>0){for(a=a.replace(/&/gim,"&amp;");-1!==a.indexOf("&amp;&amp;");)a=a.replace("&amp;&amp;","&amp;");l.attr("data-tileUrl",a)}if(!r){e.next=8;break}return e.next=8,this.setupWysiwyg();case 8:this.cacheHtml(i),this.scanRegistry();case 10:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"cacheHtml",value:function(e){if(!this.isRichText()){var t=this.$el.children(".mosaic-tile-content");0!==t.length&&(void 0===e&&(e=t.html()),t[0]._preScanHTML=e)}}},{key:"scanRegistry",value:function(){var e=this.$el.find(".mosaic-tile-content");0!==e.length&&(e[0]._preScanHTML&&e.html(e[0]._preScanHTML),c.Z.scan(e),n()("a",e).on("click",(function(e){e.preventDefault(),e.stopPropagation()})))}},{key:"select",value:function(){var e=this;!1===e.$el.hasClass("mosaic-selected-tile")&&!1===e.$el.hasClass("mosaic-read-only-tile")&&(n()(".mosaic-selected-tile").each((function(){n()(this).data("mosaic-tile").blur()})),e.focus())}},{key:"blur",value:function(){p.info("Blur ".concat(this.getType())),this.$el.removeClass("mosaic-selected-tile"),this.saveForm()}},{key:"focus",value:function(){var e=this;p.info("Focus ".concat(this.getType())),e.$el.addClass("mosaic-selected-tile"),e.$el.find(".mce-content-body").trigger("focus"),e.initializeButtons()}},{key:"saveForm",value:function(){var e=this,t=e.getType(),i=e.getConfig();if(i&&!0!==i.read_only)if(p.info("Save form ".concat(t," -> <").concat(i.tile_type," (").concat(i.widget,")>")),"field"===i.tile_type){switch(i.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":var a=n()(".mosaic-panel .mosaic-".concat(t,"-tile"),e.mosaic.document);l=a.find(".mosaic-tile-content > *").text(),n()("#"+i.id).find("input").val(l);break;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":if(l="",n()(".mosaic-panel .mosaic-".concat(t,"-tile"),e.mosaic.document).find(".mosaic-tile-content > *").each((function(){l+=n()(this).text()})),l=l.replace(/^\s+|\s+$/g,""),!(o=document.querySelector("#".concat(i.id," textarea")))){p.error('No textarea with id "'.concat(tile_condig.id,'" found'));break}o.innerText=l;break;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":var o;if(!(o=document.querySelector("#".concat(i.id," textarea")))){p.error('No textarea with id "'.concat(i.id,'" found'));break}var l=this.tinymce?this.tinymce.getContent():n()(".mosaic-".concat(t,"-tile .mosaic-tile-content"),e.mosaic.document).html();o.innerText=l,o["pattern-tinymce"].instance.tiny.setContent(l)}p.info('Saved "'.concat(l,'"'))}else if("textapp"===i.tile_type){var s=e.getEditUrl();if(s){var c=e.getHtmlContent();if(c===e.$el.data("lastSavedData"))return;if(e.$el.data("activeSave"))return;r.Z.loading.show(),e.$el.data("activeSave",!0);var d={_authenticator:r.Z.getAuthenticator(),"buttons.save":"Save"};d[i.name+".content"]=c,e.mosaic.queue((function(t){n().ajax({url:s,method:"POST",data:d}).always((function(){e.$el.data("lastSavedData",c),e.$el.data("activeSave",!1),r.Z.loading.hide(),t()}))}))}}}},{key:"setupWysiwyg",value:(d=f(regeneratorRuntime.mark((function e(){var t,a,n,r,l,s,c,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=(t=this).$el.find(".mosaic-tile-content")).length){e.next=5;break}return p.info("No wysiwg initializable content found!"),e.abrupt("return");case 5:return n=o.Z.generate_uid(),r="mosaic-rich-text-init-"+n,a.attr("id",r),l=t.getType(),-1!==this.deprecatedHTMLTiles.indexOf(l)&&(l="plone.app.standardtiles.html"),s=function(){var e=a.find("p > *");(0===e.length||1===e.length&&e.is("br"))&&0===a.text().replace(/^\s+|\s+$/g,"").length?(a.addClass("mosaic-tile-content-empty"),0===a.find("p").length&&a.empty().append("<p></p>")):a.removeClass("mosaic-tile-content-empty")},e.next=13,i.e(96870).then(i.bind(i,96870));case 13:c=e.sent.default,(d=JSON.parse(JSON.stringify(t.mosaic.options.tinymce))).tiny.inline=!0,d.tiny.menubar=!1,d.tiny.selector="#".concat(r),d.tiny.placeholder=s,t.tinymce=new c(a,d),t.tinymce.init(),p.info('Setup wysiwyg for "'.concat(r,'"')),a.addClass("mosaic-rich-text-initialized");case 23:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})}],a&&h(t.prototype,a),l&&h(t,l),Object.defineProperty(t,"prototype",{writable:!1}),e}();t.default=w},72324:function(e,t){t.Z={generate_uid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}}}}]);
//# sourceMappingURL=79277.388a3701c0c66fb56d2b.min.js.map